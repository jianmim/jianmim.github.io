import{aq as e,ar as o,as as s,e as a,h as t,at as r,s as n,au as c}from"./index-0wprmZGF.js";let i={target:null,count:0};function u(){i.count>0&&i.count--,0===i.count&&t()}const g=new e({baseURL:o,timeout:8e3,method:"GET",header:{Accept:"text/json","Content-Type":"application/json;charset=UTF-8"},withCredentials:!1,custom:{showSuccess:!1,successMsg:"",showError:!0,errorMsg:"",showLoading:!0,loadingMsg:"加载中",auth:!1}});g.interceptors.request.use((e=>{if(e.custom.auth&&!s("user").isLogin)return Promise.reject();e.custom.showLoading&&(i.count++,1===i.count&&a({title:e.custom.loadingMsg,mask:!0,fail:()=>{t()}}));const o=r("token");return o&&(e.header.Authorization=o),e}),(e=>Promise.reject(e))),g.interceptors.response.use((e=>((e.header.authorization||e.header.Authorization)&&s("user").setToken(e.header.authorization||e.header.Authorization),e.config.custom.showLoading&&u(),0===e.data.error&&""!==e.data.msg&&e.config.custom.showSuccess&&n({title:e.config.custom.successMsg||e.data.msg,icon:"none"}),Promise.resolve(e.data))),(e=>{var o;const a=s("user"),t=a.isLogin;let r="网络请求出错";if(console.log("errorMessage: ",r),void 0!==e){switch(e.statusCode){case 400:r="请求错误";break;case 401:r=t?"您的登陆已过期":"请先登录",a.logout(!0);break;case 403:r="拒绝访问";break;case 404:r="请求出错";break;case 408:r="请求超时";break;case 429:r="请求频繁, 请稍后再访问";break;case 500:r="服务器开小差啦,请稍后再试~";break;case 501:r="服务未实现";break;case 502:r="网络错误";break;case 503:r="服务不可用";break;case 504:r="网络超时";break;case 505:r="HTTP版本不受支持"}e.errMsg.includes("timeout")&&(r="请求超时"),e.errMsg.includes("Network")&&(r=window.navigator.onLine?"服务器异常":"请检查您的网络连接")}return e&&e.config&&(!1===e.config.custom.showError&&n({title:(null==(o=e.data)?void 0:o.msg)||r,icon:"none",mask:!0}),e.config.custom.showLoading&&u()),!1}));const d=e=>("/"!==e.url[0]&&(e.url=c+e.url),g.middleware(e)),l={accountLogin:e=>d({url:"/Login/Login",method:"GET",data:e,custom:{showSuccess:!0,loadingMsg:"登录中"}}),profile:()=>d({url:"/user/api/user/profile",method:"GET",custom:{showLoading:!1,auth:!0}}),logout:e=>d({url:"/user/api/user/logout",method:"POST",data:e})};export{l as default};

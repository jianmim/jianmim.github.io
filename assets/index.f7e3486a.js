var e=Object.defineProperty,r=(r,t,s)=>(((r,t,s)=>{t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s})(r,"symbol"!=typeof t?t+"":t,s),s);import{aq as t,aC as s,aD as a,aE as n,aF as i,aG as l,aH as o,aI as u,aJ as d,aK as f,aa as c,c as p,y as m,b as y,aL as g,d as h,a3 as v,a4 as b,V as q,r as F,x as w,u as $,Z as x,N as j,w as A,H as O,aM as E,a as S,I as P,z as I,a5 as k,o as C,e as V,f as _,a1 as z,K as R,k as L,_ as D,am as M,L as N,aN as T,h as B,g as W,C as J,m as K,t as Z}from"./index-80b03063.js";import{a as H,w as G}from"./install.171bae2e.js";import{a as U,b as Y}from"./index.b621671f.js";import{u as Q}from"./index.38361e72.js";import{d as X}from"./debounce.73e35894.js";import{c as ee}from"./clone-deep.2124c060.js";function re(e,r){if(Array.isArray(e))return!1;const n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!t(e))||(s.test(e)||!a.test(e)||null!=r&&e in Object(r))}function te(e){return null==e?"":n(e)}const se=function(e){e=te(e);const r=[];return i.test(e)&&r.push(""),e.replace(l,((e,t,s,a)=>(r.push(s?a.replace(o,"$1"):t||e),""))),r};function ae(e){return Array.isArray(e)?e:se(e)}function ne(e){if("string"==typeof e||t(e))return e;const r=`${e}`;return"0"==r&&1/e==-u?"-0":r}function ie(e,r,t){const s=null==e?void 0:function(e,r){let t=0;const s=(r=re(r,e)?[r]:ae(r)).length;for(;null!=e&&t<s;)e=e[ne(r[t++])];return t&&t==s?e:void 0}(e,r);return void 0===s?t:s}function le(e,r){return!!(r=null==r?f:r)&&("number"==typeof e||d.test(e))&&e>-1&&e%1==0&&e<r}const oe=Object.prototype.hasOwnProperty;function ue(e,r,t){const s=e[r];oe.call(e,r)&&function(e,r){return e===r||e!=e&&r!=r}(s,t)&&(void 0!==t||r in e)||(e[r]=t)}function de(e,r,t){return null==e?e:function(e,r,t,s){if(!c(e))return e;let a=-1;const n=(r=re(r,e)?[r]:ae(r)).length,i=n-1;let l=e;for(;null!=l&&++a<n;){const e=ne(r[a]);let n=t;if(a!=i){const t=l[e];n=s?s(t,e,l):void 0,void 0===n&&(n=c(t)?t:le(r[a+1])?[]:{})}ue(l,e,n),l=l[e]}return e}(e,r,t)}function fe(e){return!e||Array.isArray(e)&&!e.length?[]:Array.isArray(e)?e:[e]}const ce=(e,r,t)=>({get value(){return ie(e,r,t)},set value(t){de(e,r,t)}}),pe=e=>{const r=m();return p((()=>{var t;return U(null==(t=null==r?void 0:r.proxy)?void 0:t.$props)[e]}))},me=Symbol("formContextKey"),ye=Symbol("formItemContextKey"),ge=y({size:{type:String,values:g},disabled:Boolean}),he=y({...ge,model:Object,rules:{type:h([Object,Array])},labelPosition:{type:String,values:["left","right","top"],default:"right"},requireAsteriskPosition:{type:String,values:["left","right"],default:"left"},labelWidth:{type:[String,Number],default:""},labelSuffix:{type:String,default:""},statusIcon:Boolean,showMessage:{type:Boolean,default:!0},validateOnRuleChange:{type:Boolean,default:!0},hideRequiredAsterisk:Boolean}),ve={validate:(e,r,t)=>(v(e)||b(e))&&Y(r)&&b(t)},be=(e,r={})=>{const t=F(void 0),s=r.prop?t:pe("size"),a=r.form?{size:void 0}:w(me,void 0),n=r.formItem?{size:void 0}:w(ye,void 0);return p((()=>s.value||$(e)||(null==n?void 0:n.size)||(null==a?void 0:a.size)||""))},qe=e=>{const r=pe("disabled"),t=w(me,void 0);return p((()=>r.value||$(e)||(null==t?void 0:t.disabled)||!1))},Fe=()=>({form:w(me,void 0),formItem:w(ye,void 0)}),we=/%[sdj%]/g;let $e=()=>{};function xe(e){if(!e||!e.length)return null;const r={};return e.forEach((e=>{const t=e.field;r[t]=r[t]||[],r[t].push(e)})),r}function je(e,...r){let t=0;const s=r.length;if("function"==typeof e)return e.apply(null,r);if("string"==typeof e){return e.replace(we,(e=>{if("%%"===e)return"%";if(t>=s)return e;switch(e){case"%s":return String(r[t++]);case"%d":return Number(r[t++]);case"%j":try{return JSON.stringify(r[t++])}catch(a){return"[Circular]"}break;default:return e}}))}return e}function Ae(e,r){return null==e||(!("array"!==r||!Array.isArray(e)||e.length)||!(!function(e){return"string"===e||"url"===e||"hex"===e||"email"===e||"date"===e||"pattern"===e}(r)||"string"!=typeof e||e))}function Oe(e,r,t){let s=0;const a=e.length;!function n(i){if(i&&i.length)return void t(i);const l=s;s+=1,l<a?r(e[l],n):t([])}([])}"undefined"!=typeof process&&process.env;class Ee extends Error{constructor(e,t){super("Async Validation Error"),r(this,"errors"),r(this,"fields"),this.errors=e,this.fields=t}}function Se(e,r,t,s,a){if(r.first){const r=new Promise(((r,n)=>{const i=function(e){const r=[];return Object.keys(e).forEach((t=>{r.push(...e[t]||[])})),r}(e);Oe(i,t,(e=>(s(e),e.length?n(new Ee(e,xe(e))):r(a))))}));return r.catch((e=>e)),r}const n=!0===r.firstFields?Object.keys(e):r.firstFields||[],i=Object.keys(e),l=i.length;let o=0;const u=[],d=new Promise(((r,d)=>{const f=e=>{if(u.push.apply(u,e),o++,o===l)return s(u),u.length?d(new Ee(u,xe(u))):r(a)};i.length||(s(u),r(a)),i.forEach((r=>{const s=e[r];-1!==n.indexOf(r)?Oe(s,t,f):function(e,r,t){const s=[];let a=0;const n=e.length;function i(e){s.push(...e||[]),a++,a===n&&t(s)}e.forEach((e=>{r(e,i)}))}(s,t,f)}))}));return d.catch((e=>e)),d}function Pe(e,r){return t=>{let s;return s=e.fullFields?function(e,r){let t=e;for(let s=0;s<r.length;s++){if(null==t)return t;t=t[r[s]]}return t}(r,e.fullFields):r[t.field||e.fullField],(a=t)&&void 0!==a.message?(t.field=t.field||e.fullField,t.fieldValue=s,t):{message:"function"==typeof t?t():t,fieldValue:s,field:t.field||e.fullField};var a}}function Ie(e,r){if(r)for(const t in r)if(r.hasOwnProperty(t)){const s=r[t];"object"==typeof s&&"object"==typeof e[t]?e[t]={...e[t],...s}:e[t]=s}return e}const ke=(e,r,t,s,a,n)=>{!e.required||t.hasOwnProperty(e.field)&&!Ae(r,n||e.type)||s.push(je(a.messages.required,e.fullField))};let Ce;const Ve=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,_e=/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i,ze={integer:e=>ze.number(e)&&parseInt(e,10)===e,float:e=>ze.number(e)&&!ze.integer(e),array:e=>Array.isArray(e),regexp(e){if(e instanceof RegExp)return!0;try{return!!new RegExp(e)}catch(r){return!1}},date:e=>"function"==typeof e.getTime&&"function"==typeof e.getMonth&&"function"==typeof e.getYear&&!isNaN(e.getTime()),number:e=>!isNaN(e)&&"number"==typeof e,object:e=>"object"==typeof e&&!ze.array(e),method:e=>"function"==typeof e,email:e=>"string"==typeof e&&e.length<=320&&!!e.match(Ve),url:e=>"string"==typeof e&&e.length<=2048&&!!e.match((()=>{if(Ce)return Ce;const e="[a-fA-F\\d:]",r=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${e})|(?<=${e})(?=\\s|$))`:"",t="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",s="[a-fA-F\\d]{1,4}",a=`\n(?:\n(?:${s}:){7}(?:${s}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${s}:){6}(?:${t}|:${s}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${s}:){5}(?::${t}|(?::${s}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${s}:){4}(?:(?::${s}){0,1}:${t}|(?::${s}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${s}:){3}(?:(?::${s}){0,2}:${t}|(?::${s}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${s}:){2}(?:(?::${s}){0,3}:${t}|(?::${s}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${s}:){1}(?:(?::${s}){0,4}:${t}|(?::${s}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${s}){0,5}:${t}|(?::${s}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),n=new RegExp(`(?:^${t}$)|(?:^${a}$)`),i=new RegExp(`^${t}$`),l=new RegExp(`^${a}$`),o=e=>e&&e.exact?n:new RegExp(`(?:${r(e)}${t}${r(e)})|(?:${r(e)}${a}${r(e)})`,"g");o.v4=e=>e&&e.exact?i:new RegExp(`${r(e)}${t}${r(e)}`,"g"),o.v6=e=>e&&e.exact?l:new RegExp(`${r(e)}${a}${r(e)}`,"g");const u=o.v4().source,d=o.v6().source;return Ce=new RegExp(`(?:^(?:(?:(?:[a-z]+:)?//)|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|${u}|${d}|(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#][^\\s"]*)?$)`,"i"),Ce})()),hex:e=>"string"==typeof e&&!!e.match(_e)},Re="enum",Le={required:ke,whitespace:(e,r,t,s,a)=>{(/^\s+$/.test(r)||""===r)&&s.push(je(a.messages.whitespace,e.fullField))},type:(e,r,t,s,a)=>{if(e.required&&void 0===r)return void ke(e,r,t,s,a);const n=e.type;["integer","float","array","regexp","object","method","email","number","date","url","hex"].indexOf(n)>-1?ze[n](r)||s.push(je(a.messages.types[n],e.fullField,e.type)):n&&typeof r!==e.type&&s.push(je(a.messages.types[n],e.fullField,e.type))},range:(e,r,t,s,a)=>{const n="number"==typeof e.len,i="number"==typeof e.min,l="number"==typeof e.max,o=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;let u=r,d=null;const f="number"==typeof r,c="string"==typeof r,p=Array.isArray(r);if(f?d="number":c?d="string":p&&(d="array"),!d)return!1;p&&(u=r.length),c&&(u=r.replace(o,"_").length),n?u!==e.len&&s.push(je(a.messages[d].len,e.fullField,e.len)):i&&!l&&u<e.min?s.push(je(a.messages[d].min,e.fullField,e.min)):l&&!i&&u>e.max?s.push(je(a.messages[d].max,e.fullField,e.max)):i&&l&&(u<e.min||u>e.max)&&s.push(je(a.messages[d].range,e.fullField,e.min,e.max))},enum:(e,r,t,s,a)=>{e[Re]=Array.isArray(e[Re])?e[Re]:[],-1===e[Re].indexOf(r)&&s.push(je(a.messages[Re],e.fullField,e[Re].join(", ")))},pattern:(e,r,t,s,a)=>{if(e.pattern)if(e.pattern instanceof RegExp)e.pattern.lastIndex=0,e.pattern.test(r)||s.push(je(a.messages.pattern.mismatch,e.fullField,r,e.pattern));else if("string"==typeof e.pattern){new RegExp(e.pattern).test(r)||s.push(je(a.messages.pattern.mismatch,e.fullField,r,e.pattern))}}},De=(e,r,t,s,a)=>{const n=e.type,i=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r,n)&&!e.required)return t();Le.required(e,r,s,i,a,n),Ae(r,n)||Le.type(e,r,s,i,a)}t(i)},Me={string:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r,"string")&&!e.required)return t();Le.required(e,r,s,n,a,"string"),Ae(r,"string")||(Le.type(e,r,s,n,a),Le.range(e,r,s,n,a),Le.pattern(e,r,s,n,a),!0===e.whitespace&&Le.whitespace(e,r,s,n,a))}t(n)},method:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a),void 0!==r&&Le.type(e,r,s,n,a)}t(n)},number:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(""===r&&(r=void 0),Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a),void 0!==r&&(Le.type(e,r,s,n,a),Le.range(e,r,s,n,a))}t(n)},boolean:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a),void 0!==r&&Le.type(e,r,s,n,a)}t(n)},regexp:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a),Ae(r)||Le.type(e,r,s,n,a)}t(n)},integer:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a),void 0!==r&&(Le.type(e,r,s,n,a),Le.range(e,r,s,n,a))}t(n)},float:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a),void 0!==r&&(Le.type(e,r,s,n,a),Le.range(e,r,s,n,a))}t(n)},array:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(null==r&&!e.required)return t();Le.required(e,r,s,n,a,"array"),null!=r&&(Le.type(e,r,s,n,a),Le.range(e,r,s,n,a))}t(n)},object:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a),void 0!==r&&Le.type(e,r,s,n,a)}t(n)},enum:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a),void 0!==r&&Le.enum(e,r,s,n,a)}t(n)},pattern:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r,"string")&&!e.required)return t();Le.required(e,r,s,n,a),Ae(r,"string")||Le.pattern(e,r,s,n,a)}t(n)},date:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r,"date")&&!e.required)return t();if(Le.required(e,r,s,n,a),!Ae(r,"date")){let t;t=r instanceof Date?r:new Date(r),Le.type(e,t,s,n,a),t&&Le.range(e,t.getTime(),s,n,a)}}t(n)},url:De,hex:De,email:De,required:(e,r,t,s,a)=>{const n=[],i=Array.isArray(r)?"array":typeof r;Le.required(e,r,s,n,a,i),t(n)},any:(e,r,t,s,a)=>{const n=[];if(e.required||!e.required&&s.hasOwnProperty(e.field)){if(Ae(r)&&!e.required)return t();Le.required(e,r,s,n,a)}t(n)}};function Ne(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone(){const e=JSON.parse(JSON.stringify(this));return e.clone=this.clone,e}}}const Te=Ne(),Be=class{constructor(e){r(this,"rules",null),r(this,"_messages",Te),this.define(e)}define(e){if(!e)throw new Error("Cannot configure a schema with no rules");if("object"!=typeof e||Array.isArray(e))throw new Error("Rules must be an object");this.rules={},Object.keys(e).forEach((r=>{const t=e[r];this.rules[r]=Array.isArray(t)?t:[t]}))}messages(e){return e&&(this._messages=Ie(Ne(),e)),this._messages}validate(e,r={},t=(()=>{})){let s=e,a=r,n=t;if("function"==typeof a&&(n=a,a={}),!this.rules||0===Object.keys(this.rules).length)return n&&n(null,s),Promise.resolve(s);if(a.messages){let e=this.messages();e===Te&&(e=Ne()),Ie(e,a.messages),a.messages=e}else a.messages=this.messages();const i={};(a.keys||Object.keys(this.rules)).forEach((r=>{const t=this.rules[r];let a=s[r];t.forEach((t=>{let n=t;"function"==typeof n.transform&&(s===e&&(s={...s}),a=s[r]=n.transform(a)),n="function"==typeof n?{validator:n}:{...n},n.validator=this.getValidationMethod(n),n.validator&&(n.field=r,n.fullField=n.fullField||r,n.type=this.getType(n),i[r]=i[r]||[],i[r].push({rule:n,value:a,source:s,field:r}))}))}));const l={};return Se(i,a,((e,r)=>{var t;const n=e.rule;let i,o=!("object"!==n.type&&"array"!==n.type||"object"!=typeof n.fields&&"object"!=typeof n.defaultField);function u(e,r){return{...r,fullField:`${n.fullField}.${e}`,fullFields:n.fullFields?[...n.fullFields,e]:[e]}}function d(t=[]){let i=Array.isArray(t)?t:[t];!a.suppressWarning&&i.length&&Be.warning("async-validator:",i),i.length&&void 0!==n.message&&(i=[].concat(n.message));let d=i.map(Pe(n,s));if(a.first&&d.length)return l[n.field]=1,r(d);if(o){if(n.required&&!e.value)return void 0!==n.message?d=[].concat(n.message).map(Pe(n,s)):a.error&&(d=[a.error(n,je(a.messages.required,n.field))]),r(d);let t={};n.defaultField&&Object.keys(e.value).map((e=>{t[e]=n.defaultField})),t={...t,...e.rule.fields};const i={};Object.keys(t).forEach((e=>{const r=t[e],s=Array.isArray(r)?r:[r];i[e]=s.map(u.bind(null,e))}));const l=new Be(i);l.messages(a.messages),e.rule.options&&(e.rule.options.messages=a.messages,e.rule.options.error=a.error),l.validate(e.value,e.rule.options||a,(e=>{const t=[];d&&d.length&&t.push(...d),e&&e.length&&t.push(...e),r(t.length?t:null)}))}else r(d)}if(o=o&&(n.required||!n.required&&e.value),n.field=e.field,n.asyncValidator)i=n.asyncValidator(n,e.value,d,e.source,a);else if(n.validator){try{i=n.validator(n,e.value,d,e.source,a)}catch(f){null==(t=console.error)||t.call(console,f),a.suppressValidatorError||setTimeout((()=>{throw f}),0),d(f.message)}!0===i?d():!1===i?d("function"==typeof n.message?n.message(n.fullField||n.field):n.message||`${n.fullField||n.field} fails`):i instanceof Array?d(i):i instanceof Error&&d(i.message)}i&&i.then&&i.then((()=>d()),(e=>d(e)))}),(e=>{!function(e){let r=[],t={};for(let s=0;s<e.length;s++)a=e[s],Array.isArray(a)?r=r.concat(...a):r.push(a);var a;r.length?(t=xe(r),n(r,t)):n(null,s)}(e)}),s)}getType(e){if(void 0===e.type&&e.pattern instanceof RegExp&&(e.type="pattern"),"function"!=typeof e.validator&&e.type&&!Me.hasOwnProperty(e.type))throw new Error(je("Unknown rule type %s",e.type));return e.type||"string"}getValidationMethod(e){if("function"==typeof e.validator)return e.validator;const r=Object.keys(e),t=r.indexOf("message");return-1!==t&&r.splice(t,1),1===r.length&&"required"===r[0]?Me.required:Me[this.getType(e)]||void 0}};let We=Be;r(We,"register",(function(e,r){if("function"!=typeof r)throw new Error("Cannot register a validator by type, validator is not a function");Me[e]=r})),r(We,"warning",$e),r(We,"messages",Te),r(We,"validators",Me);const Je=(e,r)=>{const t=w(me,void 0);let s,a=!1;const n=F(""),i=F(""),l=F(""),o=p((()=>!(!e.label&&!r.label))),u=p((()=>`${e.label||""}${(null==t?void 0:t.labelSuffix)||""}`)),d=p((()=>{const r=null==t?void 0:t.model;if(r&&e.prop)return ce(r,e.prop).value})),f=p((()=>e.prop?b(e.prop)?e.prop:e.prop.join("."):"")),c=p((()=>{const r=[];e.rules&&r.push(...fe(e.rules));const s=null==t?void 0:t.rules;if(s&&e.prop){const t=ce(s,e.prop).value;t&&r.push(...fe(t))}if(void 0!==e.required){const t=r.map(((e,r)=>[e,r])).filter((([e])=>Object.keys(e).includes("required")));if(t.length)for(const[s,a]of t)s.required!==e.required&&(r[a]={...s,required:e.required});else r.push({required:e.required})}return r})),m=p((()=>c.value.length>0)),y=p((()=>c.value.some((e=>e.required)))),g=p((()=>"error"===i.value&&e.showMessage&&U(null==t?void 0:t.showMessage,!0))),h=e=>{n.value=e},v=async r=>{const s=f.value;return new We({[s]:r}).validate({[s]:d.value},{firstFields:!0}).then((()=>(h("success"),l.value="",null==t||t.emits("validate",e.prop,!0,""),!0))).catch((r=>((r=>{var s;const{errors:a,fields:n}=r;a&&n||console.error(r),h("error"),l.value=a?U(null==(s=null==a?void 0:a[0])?void 0:s.message,`${e.prop} 为必填项`):"",null==t||t.emits("validate",e.prop,!1,l.value)})(r),Promise.reject(r))))},q=()=>{h(""),l.value="",a=!1},$=X((()=>{i.value=n.value}),100);return A((()=>n.value),(()=>$())),A((()=>e.error),(e=>{l.value=e||"",h(e?"error":"")}),{immediate:!0}),A((()=>e.validateStatus),(e=>{h(e||"")})),{formContext:t,hasLabel:o,currentLabel:u,validateState:n,validateMessage:l,isRequired:y,shouldShowError:g,doValidate:v,validate:async(r,t)=>{if(a||!e.prop)return!1;const s=E(t);if(!m.value)return null==t||t(!1),!1;const n=(e=>c.value.filter((r=>!r.trigger||!e||(Array.isArray(r.trigger)?r.trigger.includes(e):r.trigger===e))).map((({trigger:e,...r})=>r)))(r);return 0===n.length?(null==t||t(!0),!0):(h("validating"),v(n).then((()=>(null==t||t(!0),!0))).catch((e=>{const{fields:r}=e;return null==t||t(!1,r),!s&&Promise.reject(r)})))},clearValidate:q,resetField:async()=>{const r=null==t?void 0:t.model;if(!r||!e.prop)return;const n=ce(r,e.prop);a=!0,n.value=ee(s),await O(),q(),a=!1},initFieldValue:()=>{s=ee(d.value)}}},Ke=(e,r)=>{const t=fe(r);return t.length>0?e.filter((e=>e.prop&&t.includes(e.prop))):e},Ze=e=>{const r=[],t=p((()=>{const r=!!e.model;return r||console.warn("[TnForm] model参数未定义"),r})),s=async e=>{if(!t.value)return!1;const s=(e=>{if(0===r.length)return[];const t=Ke(r,e);return t.length?t:(console.warn("[TnForm] 未找到需要校验的字段"),[])})(e);if(0===s.length)return!1;let a={};for(const r of s)try{await r.validate("")}catch(n){a={...a,...n}}return 0===Object.keys(a).length||Promise.reject(a)},a=async(e=[],r)=>{const t=!E(r);try{const t=await s(e);return!0===t&&(null==r||r(!0)),t}catch(a){if(a instanceof Error)throw a;const e=a;return null==r||r(!1,e),t&&Promise.reject(e)}};return{addField:e=>{r.push(e)},removeField:e=>{e.prop&&r.splice(r.indexOf(e),1)},resetFields:(t=[])=>{if(!e.model)return console.warn("[TnForm] model参数未定义");Ke(r,t).forEach((e=>e.resetField()))},clearValidate:(e=[])=>{Ke(r,e).forEach((e=>e.clearValidate()))},validate:async e=>a(void 0,e),validateField:a}},He=D(S({__name:"form",props:he,emits:ve,setup(e,{expose:r,emit:t}){const s=e,{formClass:a}=(()=>{const e=q("form");return{formClass:p((()=>[e.b()].join(" ")))}})(),{addField:n,removeField:i,resetFields:l,clearValidate:o,validate:u,validateField:d}=Ze(s);return A((()=>s.rules),(()=>{s.validateOnRuleChange&&u()}),{deep:!0}),P(me,I({...k(s),emits:t,resetFields:l,clearValidate:o,validateField:d,addField:n,removeField:i})),r({validate:u,validateField:d,resetFields:l,clearValidate:o}),(e,r)=>{const t=L;return C(),V(t,{class:R([$(a)])},{default:_((()=>[z(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])}}}),[["__scopeId","data-v-04292c98"]]),Ge=D(S({__name:"form-item",props:y({label:String,labelWidth:{type:[String,Number],default:""},labelPosition:{type:String,values:["left","right","top"],default:""},prop:{type:h([String,Array])},required:{type:Boolean,default:void 0},rules:{type:h([Object,Array])},error:String,validateStatus:{type:String,values:["","error","validating","success"]},showMessage:{type:Boolean,default:!0},size:{type:String,values:g}}),setup(e,{expose:r}){const t=e,s=M(),{formContext:a,validateState:n,validateMessage:i,hasLabel:l,currentLabel:o,shouldShowError:u,isRequired:d,resetField:f,clearValidate:c,validate:m,initFieldValue:y}=Je(t,s),{ns:g,labelId:h,formItemClass:v,formItemLabelClass:b,formItemLabelStyle:A,formItemErrorMessageStyle:E,initLabelContainerWidth:S}=((e,r,t)=>{const s=w(me,void 0),a=q("form-item"),n=be(void 0,{formItem:!1}),{getSelectorNodeInfo:i}=Q(),l=p((()=>x(e.labelWidth||(null==s?void 0:s.labelWidth)||""))),o=p((()=>e.labelPosition||(null==s?void 0:s.labelPosition)||"right")),u=p((()=>(null==s?void 0:s.hideRequiredAsterisk)||!1)),d=p((()=>(null==s?void 0:s.requireAsteriskPosition)||"left")),f=F(0),c=`label-${j()}`,m=p((()=>{const e=[a.b()];return n.value&&e.push(a.m(n.value)),o.value&&e.push(a.m(`label-${o.value}`)),e.join(" ")})),y=p((()=>{const e=[a.e("label")];return!u.value&&t.value&&e.push(a.em("label","required"),a.em("label",`asterisk-${d.value}`)),e.join(" ")})),g=p((()=>{const e={};return"top"!==o.value&&l.value&&(e.width=l.value),e})),h=p((()=>{const e={};return"top"!==o.value&&r.value&&(e.paddingLeft=`${f.value}px`),e}));return{ns:a,labelId:c,formItemClass:m,formItemLabelClass:y,formItemLabelStyle:g,formItemErrorMessageStyle:h,initLabelContainerWidth:()=>{r.value&&i(`#${c}`).then((e=>{f.value=(null==e?void 0:e.width)||0}))}}})(t,l,d),D=be(void 0,{formItem:!1}),H=I({...k(t),size:D,validateState:n,hasLabel:l,resetField:f,clearValidate:c,validate:m});return N((()=>{t.prop&&(null==a||a.addField(H),y()),O((()=>{S()}))})),T((()=>{null==a||a.removeField(H)})),P(ye,H),r({size:D,validateMessage:i,validateState:n,validate:m,resetField:f,clearValidate:c}),(e,r)=>{const t=L;return C(),V(t,{class:R([$(v)])},{default:_((()=>[B(t,{class:R([$(g).e("wrapper")])},{default:_((()=>[W(" label "),$(l)?(C(),V(t,{key:0,id:$(h),class:R([$(b)]),style:J($(A))},{default:_((()=>[z(e.$slots,"label",{},(()=>[K(Z($(o)),1)]),!0)])),_:3},8,["id","class","style"])):W("v-if",!0),W(" 表单组件 "),B(t,{class:R([$(g).e("content")])},{default:_((()=>[z(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])])),_:3},8,["class"]),W(" 错误信息 "),$(u)?(C(),V(t,{key:0,class:R(["tn-red_text",[$(g).e("error-message")]]),style:J($(E))},{default:_((()=>[K(Z($(i)),1)])),_:1},8,["class","style"])):W("v-if",!0)])),_:3},8,["class"])}}}),[["__scopeId","data-v-ccf8675d"]]);H(He,{FormItem:Ge}),G(Ge);export{He as T,Ge as a,Fe as b,qe as c,te as t,be as u};

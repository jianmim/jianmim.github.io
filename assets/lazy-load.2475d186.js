import{b as a,as as e,V as s,c as o,Z as t,r as l,L as r,H as n,M as i,y as d,N as c,a as m,o as u,e as g,f as h,g as f,u as p,K as y,a1 as v,h as _,a2 as S,C as w,k as I,p as b,_ as L}from"./index-80b03063.js";import{a as x}from"./index.b621671f.js";import{u as $}from"./index.38361e72.js";import{u as j}from"./index.ae0678d3.js";const k=a({src:String,height:String,width:String,mode:{type:String,values:e,default:"aspectFill"},threshold:{type:Number,default:100},transition:{type:Boolean,default:!0}}),z=L(m({__name:"lazy-load",props:k,emits:{loaded:()=>!0,error:()=>!0},setup(a){const e=a,{componentId:m,imageStatus:L,showImage:k,handleImageLoadedSuccess:z,handleImageLoadedFailed:F}=(a=>{const e=d(),{emit:s}=e,{getSelectorNodeInfo:t}=$(e),{connectObserver:m,disconnectObserver:u}=j(e),g=`tll-${c()}`,h=o((()=>x(a.threshold,100))),f=l("waiting"),p=l(!1);let y=0;const v=async()=>{u();try{await t(`#${g}`),y=0;const a=h.value<0?-Math.abs(h.value):Math.abs(h.value);m(`#${g}`,(a=>{a.intersectionRatio>0&&(p.value=!0,f.value="loading",u())}),{type:"relativeToViewport",margins:{bottom:a}})}catch(a){if(y>10)return void(y=0);y++,setTimeout((()=>{v()}),150)}};return r((()=>{n((()=>{v()}))})),i((()=>{u()})),{componentId:g,imageStatus:f,showImage:p,handleImageLoadedSuccess:()=>{f.value="loaded",s("loaded")},handleImageLoadedFailed:a=>{f.value="error",s("error")}}})(e),{ns:M,lazyLoadStyle:N}=(a=>({ns:s("lazy-load"),lazyLoadStyle:o((()=>{const e={};return a.width&&(e.width=t(a.width)),a.height&&(e.height=t(a.height)),e}))}))(e);return(a,e)=>{const s=I,o=b;return u(),g(s,{id:p(m),class:y([p(M).b(),p(M).is("show-image",p(k)&&"loaded"===p(L))]),style:w(p(N))},{default:h((()=>[f(" 加载中 "),"loading"===p(L)?(u(),g(s,{key:0,class:y([p(M).e("container")])},{default:h((()=>[v(a.$slots,"loading",{},(()=>[_(s,{class:y([p(M).e("loading")])},{default:h((()=>[_(s,{class:y([p(M).e("loading__icon")])},{default:h((()=>[_(S,{name:"loading"})])),_:1},8,["class"])])),_:1},8,["class"])]),!0)])),_:3},8,["class"])):f("v-if",!0),f(" 正式显示的图片 "),p(k)&&"error"!==p(L)?(u(),g(s,{key:1,class:y([p(M).e("container")])},{default:h((()=>[_(o,{class:y([p(M).e("image"),p(M).is("animation","loaded"===p(L)&&a.transition),p(M).is("no-animation","loaded"===p(L)&&!a.transition)]),src:a.src,mode:a.mode,onLoad:p(z),onError:p(F)},null,8,["class","src","mode","onLoad","onError"])])),_:1},8,["class"])):f("v-if",!0),f(" 图片加载失败 "),"error"===p(L)?(u(),g(s,{key:2,class:y([p(M).e("container")])},{default:h((()=>[v(a.$slots,"error",{},(()=>[_(s,{class:y([p(M).e("error")])},{default:h((()=>[_(S,{name:"image-fill"})])),_:1},8,["class"])]),!0)])),_:3},8,["class"])):f("v-if",!0)])),_:3},8,["id","class","style"])}}}),[["__scopeId","data-v-5fe6a4eb"]]);export{z as T};

import{d as e,i as l,r as a,a as t,s,b as c,c as o,e as r,h as i,f as d,g as n,o as u,j as g,w as x,k as f,u as h,l as p,m as y,n as _,p as m,F as k,q as w,t as v,I as b,v as C,x as P,y as I,z as S,A as T,B as D}from"./index-0wprmZGF.js";import{d as Y,m as z,_ as j,a as N}from"./md5.DgN9f3C1.js";import{o as M,a as A,b as B,c as H,_ as $}from"./_plugin-vue_export-helper.Cg_lsX-a.js";const E=$(e({__name:"index",setup(e){const $=l("$api"),E=a("maixin");a("");const F=a(""),G=a("");a("");const L=a("");a("");const V=a("");a(!1),a(!1),a(!0),a(["防疫电话","综治电话"]),a(""),a(""),a([]),a(!1),a(!1),a(1),a([]),a(!0);const U=a("");a("5aekiETS5845215sdfasED"),a("");const W=a(20),q=a(1),O=a("more"),J=a([]);a([]);const K=a([]),Q=a([]),R=a(""),X=a("");a([{ID:1,gw1:"gw1",gw2:"gw2",Name:"防疫电话",Tel:"0595-22486484"},{ID:2,gw1:"gw6",gw2:"gw6",Name:"综治电话",Tel:"0595-22486485"}]),M((()=>{ce()})),A((()=>{ce()})),B((e=>{console.log("options: ",e),L.value=e.caller,U.value=e.called,V.value=e.type,X.value=parseInt(e.timestamp),F.value=e.username,G.value=e.token})),H((()=>{const e=parseInt(Y().subtract(4,"hour").unix()),l=parseInt(Y().add(4,"hour").unix());if(console.log("maxTimestamp",l,e,X.value),!X.value||X.value<e||X.value>l)return console.log("传入Timestamp失效"),void t({url:"./error?err=已超期"});let a=z(`${X.value}|${F.value}|${E.value}`);if(console.log("urlToken: ",a,G.value),G.value!==a)return console.log("传入token失效"),s({title:"Token错误！",icon:"none",duration:5e3}),void t({url:"./error?err=Token错误"});console.log("传入token有效"),Z()}));const Z=async()=>{let e={UserName:F.value,Password:E.value};try{const l=await $.post("/token",e);if(console.log("res",l.data),0!==l.code)return void t({url:"./error?err=用户名不存在"});c("token",l.token),ce(),ee(),le()}catch(l){console.log(l)}},ee=async()=>{let e={PageIndex:1,PageSize:1};try{const l=await $.get("/TelSet/List",e);console.log("res",l.data),0===l.code&&Object.assign(K.value,l.data.list[0])}catch(l){console.log(l)}},le=async()=>{let e={PageIndex:1,PageSize:1};try{const l=await $.get("/PhoneSet/PhoneList",e);0===l.code&&(Q.value=l.data)}catch(l){console.log(l)}},ae=async e=>{console.log("item: ",e);var l=Y().format("YYYY-MM-DD");let a={cityname:e.CityName,caller_gateway:e.CallerGateway,called_gateway:e.CalledGateway,prefix:e.Prefix,caller:L.value,called:U.value,crmdialid:L.value,sendtime:l+" 00:00:00",overtime:l+" 23:59:59",effectstarttime:"00:00:00",effectendtime:"12:00:00",effectstarttime2:"12:00:00",effectendtime2:"23:59:59"};try{const e=await $.get("/Sys_calllog/SendWebCall",a);i(),1===e.code&&s({title:"双呼电话成功！",icon:"none",duration:5e3})}catch(t){console.log(t)}},te=async e=>{console.log("add AtoB",e),Y().add(20,"second").format("HH:mm:ss"),R.value=Y().add(Q.value[0].T,"day").format("YYYY-MM-DD HH:mm:ss");let l={city:Q.value[0].CityName,prefix:Q.value[0].Prefix,prefix2:Q.value[0].Prefix2,caller:L,called:e,EndDate:R,gateway:Q.value[0].AtoBGateway};try{const e=await $.get("/Sys_calllog/SendWebCallAtoB",l);i(),1===e.code&&se(Q.value[0].Phone)}catch(a){console.log(a)}},se=async e=>{console.log("Mobile: ",e),w({phoneNumber:e,success:function(){console.log("直呼电话成功"),s({title:"直呼电话成功",icon:"none",duration:5e3})},fail(e){console.log("直呼电话失败",e)}})},ce=async()=>{if(""==O.value)return;O.value="more",o(),r({title:"加载中",mask:!0});let e={webcallphone:L.value,page_size:W.value,page_index:q.value};console.log("data",e);try{const l=await $.get("/Sys_calllog/getCalllogData",e);console.log("res",l),i(),1==l.code&&(J.value=l.data.list,W.value+=20,l.data.pager.PageIndex>=l.data.pager.PageCount&&(O.value=""))}catch(l){console.log(l)}d(),n()},oe=e=>{console.log(e),U.value=e,ae(ttelList.value)},re=e=>{e.value=de(e),oe()},ie=e=>{let l=e;return l=l.substring(0,3)+" "+l.substring(3,7)+" "+l.substring(7,11),l},de=e=>{if(e.length>11){return e.substr(e.length-11,11)}return e};return(e,l)=>{const a=v,t=b,s=C,c=D;return u(),g(a,null,{default:x((()=>[f(a,{class:"cu-bar search bg-white",style:{position:"fixed","z-index":"55",width:"750rpx",height:"160rpx","line-height":"160rpx",top:"0"}},{default:x((()=>[f(a,{class:"search-form flex",style:{height:"120rpx","line-height":"120rpx","border-radius":"30rpx"}},{default:x((()=>[f(a,{style:{width:"30rpx"}}),f(t,{modelValue:h(U),"onUpdate:modelValue":l[0]||(l[0]=e=>p(U)?U.value=e:null),"adjust-position":!1,type:"text",placeholder:"请输入手机号",maxlength:"11","confirm-type":"search","placeholder-style":"font-size: 70rpx;",style:{"font-size":"70rpx"}},null,8,["modelValue"])])),_:1}),0==h(V)?(u(),g(a,{key:0,class:"action",style:{"flex-direction":"column"}},{default:x((()=>[f(s,{class:"cu-btn bg-cyan shadow-blur",style:{width:"150rpx",height:"60rpx","border-radius":"10rpx"},onClick:l[1]||(l[1]=e=>ae(h(K)))},{default:x((()=>[y("双呼")])),_:1}),f(s,{class:"cu-btn bg-cyan shadow-blur",style:{width:"150rpx",height:"60rpx","border-radius":"10rpx","margin-top":"10rpx"},onClick:l[2]||(l[2]=e=>te(h(U)))},{default:x((()=>[y("直呼")])),_:1})])),_:1})):1==h(V)?(u(),g(a,{key:1,class:"action",style:{"flex-direction":"column"}},{default:x((()=>[f(s,{class:"cu-btn bg-cyan shadow-blur",style:{width:"150rpx",height:"100rpx","border-radius":"10rpx"},onClick:l[3]||(l[3]=e=>ae(h(K)))},{default:x((()=>[y("双呼")])),_:1})])),_:1})):(u(),g(a,{key:2,class:"action",style:{"flex-direction":"column"}},{default:x((()=>[f(s,{class:"cu-btn bg-cyan shadow-blur",style:{width:"150rpx",height:"100rpx","border-radius":"10rpx","margin-top":"10rpx"},onClick:l[4]||(l[4]=e=>te(h(U)))},{default:x((()=>[y("直呼")])),_:1})])),_:1}))])),_:1}),f(a,{style:{"margin-top":"160rpx"}},{default:x((()=>[f(a,{style:{"background-color":"#f9f9f9",width:"750rpx",padding:"10rpx 20rpx"}},{default:x((()=>[(u(!0),_(k,null,m(h(J),((e,l)=>(u(),g(a,{key:l,class:"text-gray",style:{"border-radius":"20rpx","line-height":"60rpx","background-color":"#fff",padding:"20rpx","margin-top":"20rpx",width:"710rpx"}},{default:x((()=>[f(a,{class:"flex_sb_c",style:{height:"70rpx"}},{default:x((()=>[f(a,{class:"flex_c"},{default:x((()=>[h(L)==e.crmdialid?(u(),g(a,{key:0,class:"flex_c",onClick:l=>re(e.called)},{default:x((()=>[f(c,{src:j,mode:"aspectFill",style:{width:"40rpx",height:"40rpx"}})])),_:2},1032,["onClick"])):P("",!0),h(L)==e.crmdialid?(u(),g(a,{key:1,class:I(["text-xl",0==e.timelong&&h(L)!=e.crmdialid?"text-red":"text-black"])},{default:x((()=>[y(S(ie(de(e.called))),1)])),_:2},1032,["class"])):P("",!0),h(L)!=e.crmdialid?(u(),g(a,{key:2,class:"flex_c",onClick:l=>re(e.crmdialid)},{default:x((()=>[f(c,{src:N,mode:"aspectFill",style:{width:"40rpx",height:"40rpx"}})])),_:2},1032,["onClick"])):P("",!0),h(L)!=e.crmdialid?(u(),g(a,{key:3,class:I(["text-xl",0==e.timelong&&h(L)!=e.crmdialid?"text-red":"text-black"])},{default:x((()=>[y(S(ie(de(e.crmdialid))),1)])),_:2},1032,["class"])):P("",!0)])),_:2},1024),f(a,{class:"flex_c"},{default:x((()=>[h(L)==e.crmdialid?(u(),g(a,{key:0},{default:x((()=>[0==h(V)?(u(),g(a,{key:0,class:"flex"},{default:x((()=>[f(a,{onClick:l=>oe(de(e.called)),class:"flex_c_c radius bg-cyan shadow margin-right-xs",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("双呼")])),_:2},1032,["onClick"]),f(a,{onClick:l=>te(de(e.called)),class:"flex_c_c radius bg-cyan shadow",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("直呼")])),_:2},1032,["onClick"])])),_:2},1024)):1==h(V)?(u(),g(a,{key:1},{default:x((()=>[f(a,{onClick:l=>oe(de(e.called)),class:"flex_c_c radius bg-cyan shadow",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("双呼")])),_:2},1032,["onClick"])])),_:2},1024)):(u(),g(a,{key:2},{default:x((()=>[f(a,{onClick:l=>te(de(e.called)),class:"flex_c_c radius bg-cyan shadow",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("直呼")])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1024)):P("",!0),h(L)!=e.crmdialid?(u(),g(a,{key:1},{default:x((()=>[0==h(V)?(u(),g(a,{key:0,class:"flex"},{default:x((()=>[f(a,{onClick:l=>oe(de(e.crmdialid)),class:"flex_c_c radius bg-cyan shadow margin-right-xs",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("双呼")])),_:2},1032,["onClick"]),f(a,{onClick:l=>te(de(e.crmdialid)),class:"flex_c_c radius bg-cyan shadow",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("直呼")])),_:2},1032,["onClick"])])),_:2},1024)):1==h(V)?(u(),g(a,{key:1},{default:x((()=>[f(a,{onClick:l=>oe(de(e.crmdialid)),class:"flex_c_c radius bg-cyan shadow",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("双呼")])),_:2},1032,["onClick"])])),_:2},1024)):(u(),g(a,{key:2},{default:x((()=>[f(a,{onClick:l=>te(de(e.crmdialid)),class:"flex_c_c radius bg-cyan shadow",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("直呼")])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1024)):P("",!0)])),_:2},1024)])),_:2},1024),f(a,{class:"flex_sb_c",style:{height:"70rpx"}},{default:x((()=>[f(a,{class:"flex_c",style:{"margin-left":"45rpx"}},{default:x((()=>[f(a,null,{default:x((()=>[y(S(e.start_stamp),1)])),_:2},1024)])),_:2},1024),f(a,{class:"flex_c"},{default:x((()=>[f(a,{class:"flex_c"},{default:x((()=>[f(a,{class:"flex_c_c",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y(S(e.timelong)+"秒",1)])),_:2},1024),0!=e.timelong?(u(),g(a,{key:0,onClick:l=>{return a=e.id,void(0!=e.timelong&&T({url:"./detail?id="+a}));var a},class:"flex_c_c radius bg-cyan shadow",style:{width:"110rpx",height:"55rpx"}},{default:x((()=>[y("录音")])),_:2},1032,["onClick"])):P("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-f398a589"]]);export{E as default};

import{b as e,d as a,a4 as l,a3 as t,V as n,W as o,X as s,c as r,r as c,w as i,H as u,y as p,aa as d,a as v,o as m,e as f,f as y,h,g,K as k,u as x,C,n as P,a1 as b,m as V,t as w,i as I,j as _,F as K,U as j,k as O,aT as S,aU as T,_ as D}from"./index-80b03063.js";import{T as B}from"./popup.cb51da11.js";import{U as E,C as z}from"./event.5568c9d8.js";import{Z as A,b as U,f as W,a as N}from"./index.b621671f.js";import{i as $}from"./is-number.acae358a.js";import{c as q}from"./clone-deep.2124c060.js";const F=e({showCancel:{type:Boolean,default:!0},cancelText:{type:String,default:"取 消"},cancelColor:String,showConfirm:{type:Boolean,default:!0},confirmText:{type:String,default:"确 定"},confirmColor:String,mask:Boolean,zIndex:{type:Number,default:A.popup}}),H=e({...F,modelValue:{type:a([String,Number,Array]),default:""},open:Boolean,data:{type:a([Array]),default:()=>[]},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"},childrenKey:{type:String,default:"children"}}),J=e=>{const{emit:a}=p(),l=c(!1),n=c(!0);i((()=>e.open),(e=>{l.value=e}));const o=()=>{a("update:open",!1)};let s="signle";const r=a=>{if(d(a)){const l=q(a);return Object.prototype.hasOwnProperty.call(l,e.childrenKey)&&delete l[e.childrenKey],{label:a[e.labelKey],value:a[e.valueKey],originalData:l}}return{label:a,value:a,originalData:a}},v=(a,l=1,t=[])=>{m.value.length<l&&m.value.push(...Array.from({length:l-m.value.length},(()=>[]))),m.value[l-1]=[...a.map((e=>r(e)))];let n=0;t.length&&(n=m.value[l-1].findIndex((e=>e.value===t[l-1])),n=~n?n:0),a[n]&&Object.prototype.hasOwnProperty.call(a[n],e.childrenKey)&&v(a[n][e.childrenKey],l+1,t)},m=c([]),f=c([]),y=()=>{let a=[];if(void 0===e.modelValue||t(e.modelValue)&&!e.modelValue.length)a=Array.from({length:m.value.length},(()=>0));else if(t(e.modelValue))a=m.value.map(((a,l)=>{let t=0;return t=e.modelValue[l]?a.findIndex((a=>a.value===e.modelValue[l])):0,~t?t:0}));else{const l=m.value[0].findIndex((a=>a.value===e.modelValue));a=[-1===l?0:l]}f.value=a};i((()=>e.data),(()=>{(()=>{const{data:a}=e;a&&(t(a)||W("TnPicker","picker选择器数据不正确，请传递数组格式的数据"),0!==a.length&&(t(a[0])?(s="multiple",m.value=a.reduce(((e,a)=>(e.push(a.map((e=>r(e)))),e)),[])):!t(a[0])&&d(a[0])&&Object.prototype.hasOwnProperty.call(a[0],e.childrenKey)?(s="cascade",v(a,1,e.modelValue)):(s="signle",m.value=[a.map((e=>r(e)))]),u((()=>{y()}))))})()}),{immediate:!0});const h=()=>{if("signle"!==s||t(e.data[0])){const e=q(f.value);return e.splice(m.value.length),e.map(((e,a)=>{var l;return N(null==(l=m.value[a][e])?void 0:l.value,0)}))}return m.value[0][f.value[0]].value},g=()=>{if("signle"!==s||t(e.data[0])){const e=q(f.value);return e.splice(m.value.length),e.map(((e,a)=>{var l;return N(null==(l=m.value[a][e])?void 0:l.originalData,void 0)}))}return m.value[0][f.value[0]].originalData},k=a=>{"cascade"===s&&v(e.data,1,a),u((()=>{y()}))};let x=!1;i((()=>e.modelValue),(e=>{x?x=!1:k(e)}),{deep:!0});let C=null,P=!1;return{openPopup:l,showPicker:n,pickerData:m,currentPickerIndex:f,closePopupEvent:()=>{o(),k(e.modelValue),a("close")},pickerViewChangeEvent:l=>{if(P)return;C=setTimeout((()=>{P=!1,C&&clearTimeout(C),C=null}),300),P=!0;let t=f.value.findIndex(((e,a)=>e!==l.detail.value[a]));if(t=~t?t:0,f.value=l.detail.value,"cascade"===s){let a=e.data;for(let n=0;n<t;n++)a=a[f.value[n]][e.childrenKey];const l=f.value[t];m.value.splice(t+1),a[l]&&Object.prototype.hasOwnProperty.call(a[l],e.childrenKey)&&(v(a[l][e.childrenKey],t+2),f.value=m.value.map(((e,a)=>a<=t?f.value[a]:0)))}x=!0;const n=h(),o=g();a(z,n,t,o)},confirmEvent:()=>{const e=h(),l=g();x=!0,a(E,e),u((()=>{a("confirm",e,l)})),o()},cancelEvent:()=>{k(e.modelValue),a("cancel"),o()},initDefaultPickerIndex:y,resetPickerIndexWithPosition:(e,a)=>{f.value=f.value.map(((l,t)=>t>=e&&(!a||t<=a)?0:l))}}},X=D(v({__name:"picker",props:H,emits:{[E]:e=>l(e)||$(e)||t(e),"update:open":e=>U(e),[z]:(e,a,l)=>!0,confirm:(e,a)=>!0,cancel:()=>!0,close:()=>!0},setup(e,{expose:a}){const l=e,{openPopup:t,showPicker:c,pickerData:i,currentPickerIndex:u,closePopupEvent:p,pickerViewChangeEvent:d,confirmEvent:v,cancelEvent:D,initDefaultPickerIndex:E,resetPickerIndexWithPosition:z}=J(l),{ns:A,overlayOpacity:U,operationBtnClass:W,operationBtnStyle:N}=(e=>{const a=n("picker"),[l,t]=o(s(e,"cancelColor"),"text"),[c,i]=o(s(e,"confirmColor"),"text"),u=r((()=>e.mask?.5:0)),p=r((()=>e=>{const t=[a.e("operation-btn"),a.em("operation-btn",e)];return"cancel"===e?l.value&&t.push(l.value):"confirm"===e&&c.value&&t.push(c.value),t.join(" ")})),d=r((()=>e=>{const a={};return"cancel"===e?l.value||(a.color=t.value||"var(--tn-color-danger)"):"confirm"===e&&(c.value||(a.color=i.value||"var(--tn-color-primary)")),a}));return{ns:a,overlayOpacity:u,operationBtnClass:p,operationBtnStyle:d}})(l);return a({resetPickerViewIndex:()=>{E()},resetPickerIndexWithPosition:z}),(e,a)=>{const n=O,o=T,s=S;return m(),f(B,{modelValue:x(t),"onUpdate:modelValue":a[0]||(a[0]=e=>j(t)?t.value=e:null),"open-direction":"bottom",overlay:!0,"overlay-opacity":x(U),radius:0,"safe-area-inset-bottom":!1,"z-index":e.zIndex,onClose:x(p)},{default:y((()=>[h(n,{class:k(["tn-u-safe-area",[x(A).b()]])},{default:y((()=>[g(" 操作按钮 "),h(n,{class:k([x(A).e("operation"),x(A).is("only-confirm",!e.showCancel)])},{default:y((()=>[e.showCancel?(m(),f(n,{key:0,class:k([x(W)("cancel")]),style:C(x(N)("cancel")),onClick:P(x(D),["stop"])},{default:y((()=>[b(e.$slots,"cancel",{},(()=>[V(w(l.cancelText),1)]),!0)])),_:3},8,["class","style","onClick"])):g("v-if",!0),h(n,{class:k([x(W)("confirm")]),style:C(x(N)("confirm")),onClick:P(x(v),["stop"])},{default:y((()=>[b(e.$slots,"confirm",{},(()=>[V(w(l.confirmText),1)]),!0)])),_:3},8,["class","style","onClick"])])),_:3},8,["class"]),g(" 内容区域 "),h(n,{class:k([x(A).e("content")])},{default:y((()=>[x(c)?(m(),f(s,{key:0,class:k([x(A).e("picker-view")]),value:x(u),onChange:x(d)},{default:y((()=>[(m(!0),I(K,null,_(x(i),((e,a)=>(m(),f(o,{key:a,class:k([x(A).e("picker-view-column")])},{default:y((()=>[(m(!0),I(K,null,_(e,((e,a)=>(m(),f(n,{key:a,class:k(x(A).e("content-item"))},{default:y((()=>[h(n,{class:k(["tn-text-ellipsis-1",x(A).em("content-item","data")])},{default:y((()=>[V(w(e.label),1)])),_:2},1032,["class"])])),_:2},1032,["class"])))),128))])),_:2},1032,["class"])))),128))])),_:1},8,["class","value","onChange"])):g("v-if",!0)])),_:1},8,["class"])])),_:3},8,["class"])])),_:3},8,["modelValue","overlay-opacity","z-index","onClose"])}}}),[["__scopeId","data-v-cd22dc75"]]);export{X as T,F as p};

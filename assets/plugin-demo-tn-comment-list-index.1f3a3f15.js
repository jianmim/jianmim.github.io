import{b as e,d as l,a4 as i,aa as t,r as a,w as o,a as n,V as s,c,o as d,e as k,f as r,h as m,K as u,u as p,m as v,t as f,g as C,n as h,a2 as y,k as w,_,i as D,j as I,F as g,l as A,C as R,v as b,s as x,T as j,D as L,E as H,U as $}from"./index-80b03063.js";import{T as S}from"./avatar.714c39a9.js";import"./index.b621671f.js";import{i as M}from"./is-number.acae358a.js";import{T as N}from"./input.58395e85.js";import{T as V}from"./popup.cb51da11.js";import{T as E}from"./button.89b66e38.js";import{C as T}from"./custom-page.333ee63a.js";import{u as B}from"./index.e83e3f39.js";import"./badge.9856adf0.js";import"./index.38361e72.js";import"./event.5568c9d8.js";import"./index.f7e3486a.js";import"./install.171bae2e.js";import"./debounce.73e35894.js";import"./clone-deep.2124c060.js";import"./index.0751853a.js";import"./overlay.66eb0f69.js";import"./loading.d4613e36.js";const O=e({showLike:{type:Boolean,default:!0},showDislike:{type:Boolean,default:!0},likeIcon:{type:String,default:"like"},activeLikeIcon:{type:String,default:"like-fill"},likeIconColor:{type:String,default:"tn-gray-dark"},activeLikeIconColor:{type:String,default:"tn-red"},dislikeIcon:{type:String,default:"like-break"},activeDislikeIcon:{type:String,default:"like-fill"},dislikeIconColor:{type:String,default:"tn-gray-dark"},activeDislikeIconColor:{type:String,default:"tn-gray-dark"}}),W=e({...O,data:{type:l(Array),default:()=>[]}}),P={like:e=>M(e)||i(e),dislike:e=>M(e)||i(e),reply:e=>t(e),delete:e=>M(e)||i(e),"show-more":e=>t(e)},U=(e,l)=>{const i=a([]);o((()=>e.data),(()=>(()=>{const{data:l}=e,t=[];l.forEach((e=>{const{id:l,avatar:i,nickname:a,date:o,position:n,content:s,likeActive:c,likeCount:d,dislikeActive:k,disabledReply:r,commentCount:m,allowDelete:u}=e,p={id:l,avatar:i,nickname:a,date:o,position:n,content:s,likeActive:c,likeCount:d,dislikeActive:k,disabledReply:r,allowDelete:u,hidden:!1,commentCount:m||0,comment:[]};t.push(p)})),i.value=t})()),{immediate:!0});const t=e=>{let l=-1,t=-1;return i.value.forEach(((i,a)=>{var o;null==(o=null==i?void 0:i.comment)||o.forEach(((i,o)=>{if(i.id===e)return l=a,void(t=o)}))})),{index:l,subIndex:t}};return{listData:i,likeClickHandle:(e,t,a)=>{let o=null;o=void 0===a?i.value[t]:i.value[t].comment[a],o.likeActive=!o.likeActive,o.likeActive?o.likeCount++:o.likeCount--,o.dislikeActive&&(o.dislikeActive=!1),l("like",e)},dislikeClickHandle:(e,t,a)=>{let o=null;o=void 0===a?i.value[t]:i.value[t].comment[a],o.dislikeActive=!o.dislikeActive,o.likeActive&&(o.likeActive=!1,o.likeCount--),l("dislike",e)},replyClickHandle:e=>{e.disabledReply||l("reply",{id:e.id,nickname:e.nickname})},deleteClickHandle:e=>{l("delete",e)},replyOperationClickHandle:e=>{var t;const a=i.value.find((l=>l.id===e));a.comment.length>=a.commentCount?a.hidden=!a.hidden:l("show-more",{id:e,currentCommentCount:(null==(t=i.value.find((l=>l.id===e)))?void 0:t.comment.length)||0})},addCommentData:(e,l)=>{const t=(e,l)=>{const i=[];return l.forEach((l=>{const{id:a,avatar:o,nickname:n,date:s,position:c,content:d,likeActive:k,likeCount:r,dislikeActive:m,disabledReply:u,allowDelete:p,comment:v}=l,f={id:a,avatar:o,nickname:n,authorNickname:e,date:s,position:c,content:d,likeActive:k,likeCount:r,dislikeActive:m,disabledReply:u,allowDelete:p};i.push(f),(null==v?void 0:v.length)&&i.push(...t(n,v))})),i},a=i.value.findIndex((l=>l.id===e));-1!==a&&i.value[a].comment.push(...t("",l))},addCommentReplyWithId:(e,l)=>{let a=i.value.findIndex((l=>l.id===e)),o=-1;if(-1===a){const{index:l,subIndex:i}=t(e);a=l,o=i}if(-1!==a||-1!==o){if(-1===o)i.value[a].comment.unshift({id:l.id,avatar:l.avatar,nickname:l.nickname,authorNickname:"",date:l.date,position:l.position,content:l.content,allowDelete:l.allowDelete,likeActive:!1,likeCount:0,dislikeActive:!1,disabledReply:l.disabledReply});else{const e=i.value[a].comment[o].nickname;i.value[a].comment.splice(o+1,0,{id:l.id,avatar:l.avatar,nickname:l.nickname,authorNickname:e,date:l.date,position:l.position,content:l.content,allowDelete:l.allowDelete,likeActive:!1,likeCount:0,dislikeActive:!1,disabledReply:!1})}i.value[a].commentCount++}else i.value.unshift({id:l.id,avatar:l.avatar,nickname:l.nickname,authorNickname:"",date:l.date,position:l.position,content:l.content,allowDelete:l.allowDelete,likeActive:!1,likeCount:0,dislikeActive:!1,disabledReply:l.disabledReply,hidden:!1,commentCount:0,comment:[]})},deleteCommentReplyWithId:e=>{let l=i.value.findIndex((l=>l.id===e)),a=-1;if(-1===l){const{index:i,subIndex:o}=t(e);l=i,a=o}-1===l&&-1===a||(-1===a?i.value.splice(l,1):(i.value[l].comment.splice(a,1),i.value[l].commentCount--))}}},z=_(n({__name:"comment-bottom-operation",props:e({...O,data:{type:l(Object),default:()=>({date:"",position:"",likeActive:!1,likeCount:0,dislikeActive:!1})},showDelete:Boolean,showReply:Boolean}),emits:{like:()=>!0,dislike:()=>!0,delete:()=>!0},setup(e,{emit:l}){const i=e,t=s("tn-comment-bottom-operation"),a=c((()=>void 0!==i.likeIconColor?i.likeIconColor:"tn-gray-dark")),o=c((()=>void 0!==i.activeLikeIconColor?i.activeLikeIconColor:"tn-red")),n=c((()=>void 0!==i.dislikeIconColor?i.dislikeIconColor:"tn-gray-dark")),_=c((()=>void 0!==i.activeDislikeIconColor?i.activeDislikeIconColor:"tn-gray-dark")),D=()=>{l("like")},I=()=>{l("dislike")},g=()=>{l("delete")};return(e,l)=>{const i=w;return d(),k(i,{class:u([p(t).b()])},{default:r((()=>[m(i,{class:u([p(t).e("left")])},{default:r((()=>[m(i,{class:u([p(t).e("date")])},{default:r((()=>[v(f(e.data.date),1)])),_:1},8,["class"]),e.data.position?(d(),k(i,{key:0,class:u([p(t).e("position")])},{default:r((()=>[v(f(e.data.position),1)])),_:1},8,["class"])):C("v-if",!0),e.showReply?(d(),k(i,{key:1,class:u([p(t).e("reply")])},{default:r((()=>[v("回复")])),_:1},8,["class"])):C("v-if",!0),e.showDelete?(d(),k(i,{key:2,class:u(p(t).e("delete")),onClick:h(g,["stop"])},{default:r((()=>[v(" 删除 ")])),_:1},8,["class","onClick"])):C("v-if",!0)])),_:1},8,["class"]),m(i,{class:u([p(t).e("right")]),onClick:h((e=>null),["stop"])},{default:r((()=>[e.showLike?(d(),k(i,{key:0,class:u([p(t).e("like-container")]),onClick:h(D,["stop"])},{default:r((()=>[m(i,{class:u(["like",[p(t).e("icon")]])},{default:r((()=>[m(y,{name:e.data.likeActive?e.activeLikeIcon:e.likeIcon,color:e.data.likeActive?p(o):p(a)},null,8,["name","color"])])),_:1},8,["class"]),m(i,{class:u([p(t).e("like-value")])},{default:r((()=>[v(f(e.data.likeCount),1)])),_:1},8,["class"])])),_:1},8,["class","onClick"])):C("v-if",!0),e.showDislike?(d(),k(i,{key:1,class:u(["dislike",[p(t).e("icon")]]),onClick:h(I,["stop"])},{default:r((()=>[m(y,{name:e.data.dislikeActive?e.activeDislikeIcon:e.dislikeIcon,color:e.data.dislikeActive?p(_):p(n)},null,8,["name","color"])])),_:1},8,["class","onClick"])):C("v-if",!0)])),_:1},8,["class","onClick"])])),_:1},8,["class"])}}}),[["__scopeId","data-v-eb6ac837"]]),K=_(n({__name:"index",props:W,emits:P,setup(e,{expose:l,emit:i}){const t=e,a=s("tn-comment-list"),{listData:o,likeClickHandle:n,dislikeClickHandle:c,replyClickHandle:y,deleteClickHandle:_,replyOperationClickHandle:x,addCommentData:j,addCommentReplyWithId:L,deleteCommentReplyWithId:H}=U(t,i);return l({addCommentData:j,addCommentReply:L,deleteCommentReply:H}),(e,l)=>{const i=w,t=b,s=A("TnIcon");return d(),k(i,{class:u([p(a).b()])},{default:r((()=>[(d(!0),D(g,null,I(p(o),((l,o)=>(d(),k(i,{key:o,class:u([p(a).e("item")])},{default:r((()=>[m(i,{class:u([p(a).e("item-data")])},{default:r((()=>[m(i,{class:u([p(a).em("item-data","left")])},{default:r((()=>[m(i,{class:u([p(a).e("avatar")])},{default:r((()=>[m(S,{url:l.avatar,size:"70"},null,8,["url"])])),_:2},1032,["class"])])),_:2},1032,["class"]),m(i,{class:u([p(a).em("item-data","right")])},{default:r((()=>[m(i,{class:u([p(a).e("main-data")]),onClick:h((e=>p(y)(l)),["stop"])},{default:r((()=>[m(i,{class:u([p(a).e("nickname")])},{default:r((()=>[v(f(l.nickname),1)])),_:2},1032,["class"]),m(i,{class:u([p(a).e("content")])},{default:r((()=>[v(f(l.content),1)])),_:2},1032,["class"]),m(i,{class:u([p(a).e("bottom-operation")])},{default:r((()=>[m(z,{data:{date:l.date,position:l.position,likeActive:l.likeActive,likeCount:l.likeCount,dislikeActive:l.dislikeActive},"show-like":e.showLike,"show-dislike":e.showDislike,"like-icon":e.likeIcon,"active-like-icon":e.activeLikeIcon,"dislike-icon":e.dislikeIcon,"like-icon-color":e.likeIconColor,"active-like-icon-color":e.activeLikeIconColor,"dislike-icon-color":e.dislikeIconColor,"show-delete":l.allowDelete,"show-reply":!l.disabledReply,onLike:()=>p(n)(l.id,o),onDislike:()=>p(c)(l.id,o),onDelete:()=>p(_)(l.id)},null,8,["data","show-like","show-dislike","like-icon","active-like-icon","dislike-icon","like-icon-color","active-like-icon-color","dislike-icon-color","show-delete","show-reply","onLike","onDislike","onDelete"])])),_:2},1032,["class"])])),_:2},1032,["class","onClick"]),m(i,{class:u([p(a).e("reply-data")]),style:R({height:""+(l.hidden?"0px":"auto")})},{default:r((()=>[(d(!0),D(g,null,I(l.comment,((l,t)=>(d(),k(i,{key:t,class:u([p(a).e("reply-item")])},{default:r((()=>[m(i,{class:u([p(a).em("reply-item","left")])},{default:r((()=>[m(i,{class:u([p(a).e("avatar")])},{default:r((()=>[m(S,{url:l.avatar,size:"40"},null,8,["url"])])),_:2},1032,["class"])])),_:2},1032,["class"]),m(i,{class:u([p(a).em("reply-item","right")]),onClick:h((e=>p(y)(l)),["stop"])},{default:r((()=>[m(i,{class:u([p(a).e("reply-nickname"),p(a).e("nickname")])},{default:r((()=>[m(i,{class:"nickname"},{default:r((()=>[v(f(l.nickname),1)])),_:2},1024),l.authorNickname?(d(),k(i,{key:0,class:"author-nickname"},{default:r((()=>[v(f(l.authorNickname),1)])),_:2},1024)):C("v-if",!0)])),_:2},1032,["class"]),m(i,{class:u([p(a).e("content")])},{default:r((()=>[v(f(l.content),1)])),_:2},1032,["class"]),m(i,{class:u([p(a).e("bottom-operation")])},{default:r((()=>[m(z,{data:{date:l.date,position:l.position,likeActive:l.likeActive,likeCount:l.likeCount,dislikeActive:l.dislikeActive},"show-like":e.showLike,"show-dislike":e.showDislike,"like-icon":e.likeIcon,"active-like-icon":e.activeLikeIcon,"dislike-icon":e.dislikeIcon,"like-icon-color":e.likeIconColor,"active-like-icon-color":e.activeLikeIconColor,"dislike-icon-color":e.dislikeIconColor,"show-delete":l.allowDelete,"show-reply":!l.disabledReply,onLike:()=>p(n)(l.id,o,t),onDislike:()=>p(c)(l.id,o,t),onDelete:()=>p(_)(l.id)},null,8,["data","show-like","show-dislike","like-icon","active-like-icon","dislike-icon","like-icon-color","active-like-icon-color","dislike-icon-color","show-delete","show-reply","onLike","onDislike","onDelete"])])),_:2},1032,["class"])])),_:2},1032,["class","onClick"])])),_:2},1032,["class"])))),128))])),_:2},1032,["class","style"]),l.commentCount>0?(d(),k(i,{key:0,class:u([p(a).e("show-more-operation")]),onClick:h((e=>p(x)(l.id)),["stop"])},{default:r((()=>[m(i,{class:u([p(a).em("show-more-operation","tips")])},{default:r((()=>{var e;return[!(null==(e=null==l?void 0:l.comment)?void 0:e.length)||l.hidden?(d(),k(t,{key:0},{default:r((()=>[v(" 查看"+f(l.commentCount)+"条回复 ",1)])),_:2},1024)):l.commentCount>l.comment.length?(d(),k(t,{key:1},{default:r((()=>[v(" 加载更多回复 ")])),_:1})):l.commentCount===l.comment.length?(d(),k(t,{key:2},{default:r((()=>[v(" 收起 ")])),_:1})):C("v-if",!0)]})),_:2},1032,["class"]),m(i,{class:u([p(a).em("show-more-operation","icon")])},{default:r((()=>[m(s,{name:l.commentCount>l.comment.length||l.hidden?"down":"up"},null,8,["name"])])),_:2},1032,["class"])])),_:2},1032,["class","onClick"])):C("v-if",!0)])),_:2},1032,["class"])])),_:2},1032,["class"])])),_:2},1032,["class"])))),128))])),_:1},8,["class"])}}}),[["__scopeId","data-v-43e74f60"]]),q=_(n({__name:"index",setup(e){L((()=>({}))),H((()=>({})));const{isDemoH5Page:l}=B(),{commentListRef:i,commentData:t,openReplyPopup:o,replyContent:n,replyCommentNickname:s,showMoreClickHandle:c,replyClickHandle:k,replyDeleteHandle:u,replyCommentClickHandle:f}=(()=>{const e=a(),l={},i=a([]),t=Array.from({length:20}).map(((e,l)=>`https://resource.tuniaokj.com/images/avatar/default/${l+1}.png`)),o=()=>{const e=Math.floor(Math.random()*t.length);return t[e]},n=()=>Math.floor(1e3*Math.random()),s=(e,l)=>{const i=[];for(let t=l;t<5;t++){const l=`${e}${t+1}`;i.push({id:l,avatar:o(),nickname:`图鸟用户${n()}`,date:"07-25",position:"广东",content:`这是一条回复${e}的回复-${l}-${n()}`,likeActive:!1,likeCount:n(),dislikeActive:!1,disabledReply:!1,allowDelete:!1,comment:s(l,t+1)})}return i};(()=>{for(let e=0;e<10;e++){const t=String(e);i.value.push({id:t,avatar:"https://resource.tuniaokj.com/images/xiongjie/xiong-3d-new.jpg",nickname:`图鸟-凶姐${e}`,date:"07-24",position:"广东",content:`这是一条来自凶姐${e}的评论`,likeActive:Math.random()>.5,likeCount:n(),dislikeActive:!1,disabledReply:!1,allowDelete:!1,commentCount:31}),l[t]={currentCommentIndex:0,data:s(t,0)}}})();const c=a(!1),d=a(""),k=a("");let r="";return{commentListRef:e,commentData:i,openReplyPopup:c,replyContent:k,replyCommentNickname:d,showMoreClickHandle:({id:i})=>{var t;null==(t=e.value)||t.addCommentData(i,[l[i].data[l[i].currentCommentIndex++]])},replyClickHandle:({id:e,nickname:l})=>{k.value="",c.value=!0,d.value=l,r=e},replyCommentClickHandle:()=>{var l;if(!k.value||!r)return void x({icon:"none",title:"请输入回复内容"});const i=`${r}${n()}`;null==(l=e.value)||l.addCommentReply(r,{id:i,avatar:o(),nickname:`图鸟用户${i}`,date:"07-25",position:"广东",content:k.value,allowDelete:!0,disabledReply:!1}),c.value=!1,k.value=""},replyDeleteHandle:l=>{j({title:"提示",content:"确定删除该评论吗？",showCancel:!0,success:i=>{var t;i.confirm&&(null==(t=e.value)||t.deleteCommentReply(l))}})}}})();return(e,a)=>{const C=w;return d(),D(g,null,[m(T,{title:"评论列表","is-h5-demo-page":p(l),padding:"0rpx"},{default:r((()=>[m(C,{class:"tn-comment-list-container"},{default:r((()=>[m(K,{ref_key:"commentListRef",ref:i,data:p(t),onShowMore:p(c),onReply:p(k),onDelete:p(u)},null,8,["data","onShowMore","onReply","onDelete"])])),_:1})])),_:1},8,["is-h5-demo-page"]),m(V,{modelValue:p(o),"onUpdate:modelValue":a[1]||(a[1]=e=>$(o)?o.value=e:null),"open-direction":"center",width:"90%"},{default:r((()=>[m(C,{class:"reply-container"},{default:r((()=>[m(N,{modelValue:p(n),"onUpdate:modelValue":a[0]||(a[0]=e=>$(n)?n.value=e:null),type:"textarea",placeholder:`回复${p(s)}:`,height:"230",focus:p(o)},null,8,["modelValue","placeholder","focus"]),m(C,{class:"tn-flex justify-end tn-mt"},{default:r((()=>[m(E,{onClick:p(f)},{default:r((()=>[v("回 复")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-88de2d53"]]);export{q as default};

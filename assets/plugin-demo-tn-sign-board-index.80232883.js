import{b as e,V as t,c as a,Z as s,r as l,L as n,w as o,y as r,N as c,aV as i,ax as u,H as d,a as h,o as x,i as y,h as f,f as v,K as g,u as m,C as p,g as b,F as _,ay as w,k as T,_ as F,D as C,E as I,e as S,m as k,s as j,p as E}from"./index-80b03063.js";import{T as N}from"./button.89b66e38.js";import"./index.b621671f.js";import{u as D}from"./index.38361e72.js";import{C as P}from"./custom-page.333ee63a.js";import{D as z}from"./demo-container.59d4003d.js";import{u as M}from"./index.e83e3f39.js";import"./loading.d4613e36.js";import"./debounce.73e35894.js";import"./title.e0fd12f0.js";const $=e({width:{type:String,default:"100%"},height:{type:String,default:"100%"},textColor:{type:String,default:"#080808"},disabled:Boolean}),q=(e,t)=>{const s=r(),h=`tsb-${c()}`,x=`${h}-canvas`,y=`${h}-ghost`;let f=null,v=null;const{getSelectorNodeInfo:g}=D(s),m=a((()=>e.textColor||"#080808")),{setCanvasContext:p,calcDistance:b,drawLine:_}=(e=>{let t=null,a=1;const s=(e,t)=>{const a=t.x-e.x,s=t.y-e.y;return Math.sqrt(a*a+s*s)},l=(e,t,a,s,l,n,o,r,c)=>{let i=s-e,u=l-t,d=s-o,h=l-r,x=2*Math.sqrt(i*i+u*u+1e-4);i=i/x*a,u=u/x*a,x=2*Math.sqrt(d*d+h*h+1e-4),d=d/x*c,h=h/x*c;const y=u,f=-i,v=-h,g=d,m=Number.parseFloat((e+y).toFixed(1)),p=Number.parseFloat((t+f).toFixed(1)),b=[{c1x:s+y,c1y:l+f,c2x:s+v,c2y:l+g,ex:o+v,ey:r+g},{c1x:o+v-d,c1y:r+g-h,c2x:o-v-d,c2y:r-g-h,ex:o-v,ey:r-g},{c1x:s-v,c1y:l-g,c2x:s-y,c2y:l-f,ex:e-y,ey:t-f},{c1x:e-y-i,c1y:t-f-u,c2x:e+y-i,c2y:t+f-u,ex:e+y,ey:t+f}];for(const _ of b)_.c1x=Number.parseFloat(_.c1x.toFixed(1)),_.c1y=Number.parseFloat(_.c1y.toFixed(1)),_.c2x=Number.parseFloat(_.c2x.toFixed(1)),_.c2y=Number.parseFloat(_.c2y.toFixed(1)),_.ex=Number.parseFloat(_.ex.toFixed(1)),_.ey=Number.parseFloat(_.ey.toFixed(1));return{mx:m,my:p,a:b}},n=(a,s,l,n)=>{null==t||t.beginPath(),null==t||t.moveTo(a,s),null==t||t.setFillStyle(e.value),null==t||t.setStrokeStyle(e.value);for(const e of l)null==t||t.bezierCurveTo(e.c1x,e.c1y,e.c2x,e.c2y,e.ex,e.ey);null==t||t.stroke(),n&&(null==t||t.fill()),null==t||t.draw(!0)};return{setCanvasContext:e=>{t=e},calcDistance:s,drawLine:e=>{if(e.length<=1)return e[0].r=a,e;let t,o,r,c,i,u,d=0,h=0;const x=.5;e.length<=2?(t=e[1].x,c=e[1].y,r=e[1].x+(e[0].x-e[1].x)*x,u=e[1].y+(e[0].y-e[1].y)*x,o=t+(r-t)*x,i=c+(u-c)*x):(t=e[2].x+(e[1].x-e[2].x)*x,c=e[2].y+(e[1].y-e[2].y)*x,o=e[1].x,i=e[1].y,r=o+(e[0].x-o)*x,u=i+(e[0].y-i)*x);const y=s({x:r,y:u},{x:t,y:c}),f=a;for(let a=0;a<e.length-1&&(d+=e[a].distance,h+=e[a].time-e[a+1].time,!(d>60));a++);a=1.5*Math.min(h/y*1+.5,4),e[0].r=a;let v=[];for(let s=0;s<5;s++){const e=s/4,d=(1-e)*(1-e)*t+2*e*(1-e)*o+e*e*r,h=(1-e)*(1-e)*c+2*e*(1-e)*i+e*e*u,x=f+(a-f)/5*s;if(v.push({x:d,y:h,r:x}),3===v.length){const e=l(v[0].x,v[0].y,v[0].r,v[1].x,v[1].y,v[1].r,v[2].x,v[2].y,v[2].r);n(e.mx,e.my,e.a,!0),v=[{x:d,y:h,r:x}]}}return e}}})(m),w=l({left:0,right:0,top:0,bottom:0,width:0,height:0});let T=0;const F=async()=>{try{const e=await g(`#${h}`);if(!e){if(T>10)throw new Error("获取组件信息失败");return void setTimeout((()=>{T++,F()}),50)}T=0,w.value.left=e.left||0,w.value.right=e.right||0,w.value.top=e.top||0,w.value.bottom=e.bottom||0,w.value.width=e.width||0,w.value.height=e.height||0,f||(f=u(x,s),p(f)),C()}catch(e){T=0}},C=()=>{I()},I=()=>{null==f||f.clearRect(0,0,w.value.width,w.value.height),null==f||f.draw(),null==v||v.clearRect(0,0,w.value.height,w.value.width),null==v||v.draw(),E=[],N=[]};let S=!0;const k={x:0,y:0},j={x:0,y:0};let E=[],N=[];const P=e=>(v||(v=u(y,s)),new Promise(((t,a)=>{null==v||v.restore(),null==v||v.save(),null==v||v.translate(w.value.height/2,w.value.width/2),null==v||v.rotate(Math.PI/180*-90),null==v||v.translate(-w.value.width/2,-w.value.height/2),null==v||v.drawImage(e,0,0,w.value.width,w.value.height),null==v||v.draw(!1,(()=>{i({canvasId:y,fileType:"png",quality:1,success:e=>t(e.tempFilePath),fail:e=>a(e)},s)}))}))),z=()=>{d((()=>{F()}))};return n((()=>{z()})),o((()=>[e.width,e.height]),(()=>{z()})),{componentId:h,canvasId:x,ghostCanvasId:y,rectInfo:w,canvasTouchStart:a=>{if(e.disabled||!a.changedTouches[0])return;const s=a.changedTouches[0];null==f||f.setFillStyle(m.value),E.unshift({x:s.x,y:s.y,r:0,time:Date.now(),distance:0}),k.x=s.x,k.y=s.y,S&&(S=!1,s.y,s.x,s.y,s.x),E=_(E),t("touch-start")},canvasTouchMove:t=>{if(e.disabled||!t.changedTouches[0])return;t.cancelable&&(t.defaultPrevented||t.preventDefault());const a=t.changedTouches[0],s={x:a.x,y:a.y};s.x<0&&(s.x=0),s.x>w.value.right&&(s.x=w.value.right),s.y<0&&(s.y=0),s.y>w.value.bottom&&(s.y=w.value.bottom),j.x=k.x,j.y=k.y,k.x=s.x,k.y=s.y,E.unshift({x:s.x,y:s.y,r:0,time:Date.now(),distance:b(k,j)}),E=_(E)},canvasTouchEnd:a=>{if(e.disabled||!a.changedTouches[0])return;const s=a.changedTouches[0],l={x:s.x,y:s.y};j.x=k.x,j.y=k.y,k.x=l.x,k.y=l.y,E.unshift({x:l.x,y:l.y,r:0,time:Date.now(),distance:b(k,j)}),E=_(E),N.unshift(...E),E=[],t("touch-end")},canvasErrorEvent:e=>{},saveImage:(e=!1)=>new Promise(((t,a)=>{if(!N.length||!f)return a("没有笔迹，无法保存");i({canvasId:x,fileType:"png",quality:1,success:s=>{const l=s.tempFilePath;e?P(l).then((e=>{t(e)})).catch((e=>{a(e)})):t(l)},fail:e=>a(e)},s)})),clearCanvas:I}},B=F(h({__name:"index",props:$,emits:{"touch-start":()=>!0,"touch-end":()=>!0},setup(e,{expose:l,emit:n}){const o=e,{ns:r,signBoardStyle:c}=(e=>({ns:t("sign-board"),signBoardStyle:a((()=>{const t={};return e.width&&(t.width=s(e.width)),e.height&&(t.height=s(e.height)),t}))}))(o),{componentId:i,canvasId:u,ghostCanvasId:d,rectInfo:h,canvasTouchStart:F,canvasTouchMove:C,canvasTouchEnd:I,canvasErrorEvent:S,saveImage:k,clearCanvas:j}=q(o,n);return l({save:k,clear:j}),(e,t)=>{const a=w,s=T;return x(),y(_,null,[f(s,{id:m(i),class:g([m(r).b(),m(r).is("disabled",e.disabled)]),style:p(m(c))},{default:v((()=>[f(s,{class:g([m(r).e("wrapper")])},{default:v((()=>[f(a,{id:m(u),class:g([m(r).e("canvas")]),"canvas-id":m(u),"disable-scroll":"",onTouchstart:m(F),onTouchmove:m(C),onTouchend:m(I),onError:m(S)},null,8,["id","class","canvas-id","onTouchstart","onTouchmove","onTouchend","onError"])])),_:1},8,["class"])])),_:1},8,["id","class","style"]),b(" 伪全屏生成旋转图片canvas容器，不展示在页面上 "),f(s,{class:g([m(r).e("ghost-wrapper")])},{default:v((()=>[f(a,{id:m(d),class:g([m(r).e("ghost-canvas")]),style:p({width:`${m(h).height}px`,height:`${m(h).width}px`}),"canvas-id":m(d)},null,8,["id","class","style","canvas-id"])])),_:1},8,["class"])],64)}}}),[["__scopeId","data-v-93ad4ea9"]]),L=F(h({__name:"index",setup(e){C((()=>({}))),I((()=>({})));const{isDemoH5Page:t}=M(),a=l(),s=l(""),n=l("#080808"),o=(e=!1)=>{var t;null==(t=a.value)||t.save(e).then((e=>{s.value=e})).catch((e=>{console.error("保存签名失败",e),j({title:"保存签名失败",icon:"none"})}))},r=()=>{var e;null==(e=a.value)||e.clear(),s.value="",n.value="#080808"},c=e=>{n.value=e};return(e,l)=>{const i=E,u=T;return x(),S(P,{title:"签名板","is-h5-demo-page":m(t)},{default:v((()=>[f(z,{title:"您的签名 - 保存后结果"},{default:v((()=>[f(u,{class:"tn-sign-board-container"},{default:v((()=>[f(u,{class:"tn-sign-board-item"},{default:v((()=>[f(u,{class:"preview-sign"},{default:v((()=>[f(i,{class:"image",src:s.value,mode:"aspectFit"},null,8,["src"])])),_:1})])),_:1})])),_:1})])),_:1}),f(z,{title:"基础使用 - 签名框"},{default:v((()=>[f(u,{class:"tn-sign-board-container"},{default:v((()=>[f(u,{class:"tn-sign-board-item"},{default:v((()=>[f(u,{class:"sign-board-wrapper"},{default:v((()=>[f(B,{ref_key:"signBoardRef",ref:a,"text-color":n.value},null,8,["text-color"])])),_:1}),f(u,{class:"sign-board-operation"},{default:v((()=>[f(u,{class:"btn"},{default:v((()=>[f(N,{size:"lg",onClick:o},{default:v((()=>[k("保存")])),_:1})])),_:1}),f(u,{class:"btn"},{default:v((()=>[f(N,{size:"lg",onClick:l[0]||(l[0]=e=>o(!0))},{default:v((()=>[k("旋转并保存")])),_:1})])),_:1}),f(u,{class:"btn"},{default:v((()=>[f(N,{type:"danger",size:"lg",onClick:r},{default:v((()=>[k(" 重新签名 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),f(z,{title:"修改签名颜色"},{default:v((()=>[f(u,{class:"tn-sign-board-container"},{default:v((()=>[f(u,{class:"tn-sign-board-item"},{default:v((()=>[f(u,{class:"sign-board-operation no-center"},{default:v((()=>[f(u,{class:"btn"},{default:v((()=>[f(N,{size:"lg",onClick:l[1]||(l[1]=e=>c("#080808"))},{default:v((()=>[k(" 默认颜色 ")])),_:1})])),_:1}),f(u,{class:"btn"},{default:v((()=>[f(N,{size:"lg",onClick:l[2]||(l[2]=e=>c("#01beff"))},{default:v((()=>[k(" 修改颜色为#01beff ")])),_:1})])),_:1}),f(u,{class:"btn"},{default:v((()=>[f(N,{size:"lg",onClick:l[3]||(l[3]=e=>c("rgb(255, 68, 79)"))},{default:v((()=>[k(" 修改颜色为rgb(255, 68, 79) ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["is-h5-demo-page"])}}}),[["__scopeId","data-v-3eead34e"]]);export{L as default};

import{b as e,d as t,V as a,Y as o,c as n,Z as s,r as l,W as i,X as c,w as r,L as u,H as v,y as m,N as d,a as p,o as f,e as h,f as y,g as I,h as T,i as g,j as C,u as x,F as S,K as _,C as b,n as j,k as w,a2 as z,_ as N}from"./index-80b03063.js";import{U as M,C as D}from"./event.5568c9d8.js";import{i as E}from"./is-number.acae358a.js";import{a as V}from"./index.b621671f.js";import{u as H}from"./index.38361e72.js";import{u as $}from"./index.a1af8551.js";import{b as k}from"./index.f7e3486a.js";const B=e({modelValue:{type:Number,default:0},min:{type:Number,default:0},max:{type:Number,default:5},allowHalf:Boolean,readonly:Boolean,size:String,inactiveIcon:{type:String,default:"star"},activeIcon:{type:String,default:"star-fill"},inactiveColor:String,activeColor:String,gutter:String,customData:{type:t(Object),default:()=>({})},validateEvent:{type:Boolean,default:!0}}),W=(e,t)=>{const a=m(),o=`tr-${d()}`,{getSelectorNodeInfo:n}=H(a),{formItem:s}=k(),{rateItemData:p}=(e=>{const t=l([]);return(()=>{const{max:a,inactiveIcon:o,activeIcon:n,inactiveColor:s,activeColor:l,customData:r}=e,u={inactiveIcon:o,activeIcon:n,inactiveColor:s,activeColor:l},v=[];for(let e=0;e<a;e++){const t={...u,...V(null==r?void 0:r[e],{})},[a,o]=i(c(t,"inactiveColor"),"text"),[n,s]=i(c(t,"activeColor"),"text");v.push({active:{icon:t.activeIcon,color:{class:n.value,style:s.value}},inactive:{icon:t.inactiveIcon,color:{class:a.value,style:o.value}}})}t.value=v})(),{rateItemData:t}})(e),{currentX:f,updateOptions:h,onTouchStart:y,onTouchMove:I,onTouchEnd:T}=$(),g=a=>{Number.isNaN(a)&&(a=0),t(M,a),v((()=>{t(D,a),e.validateEvent&&(null==s||s.validate("change").catch((e=>{})))}))};let C=0;const x=l(0);r((()=>e.modelValue),(t=>{e.allowHalf||(t=Math.ceil(t)),x.value=t*C}));let S=0;const _=async()=>{try{const t=await n(`#${o} .tn-rate__item`);if(!(null==t?void 0:t.width))throw new Error("获取组件容器宽度失败");C=t.width||0;const a=t.left||0;h({left:a,right:C*e.max+a,top:t.top,bottom:t.bottom});let s=e.modelValue||0;e.modelValue&&e.modelValue<e.min&&(s=e.min),x.value=s*C,g(s)}catch(t){if(S>10)return void(S=0);S++,setTimeout((()=>{_()}),300)}};return u((()=>{v((()=>{_()}))})),{componentId:o,rateItemData:p,activeItemWidth:x,onTouchStart:e=>{y(e)},onTouchMove:t=>{I(t),e.readonly||(x.value=f.value)},onTouchEnd:t=>{if(T(t),!e.readonly)if(e.allowHalf){const t=C/2;let a=Math.ceil(f.value/t);a%2!=0?f.value<t*(a-1)+t/2&&(a-=1):f.value<t*(a-1)+t/3&&(a-=1),f.value<t*(a-1)+t/2&&a%2!=0&&(a-=1),a<2*e.min&&(a=2*e.min),x.value=t*a,g(a/2)}else{let t=Math.ceil(f.value/C);t>1&&f.value<C*(t-1)&&(t-=1),t<e.min&&(t=e.min),x.value=C*t,g(t)}}}},O=N(p({__name:"rate",props:B,emits:{[M]:e=>E(e),[D]:e=>E(e)},setup(e,{emit:t}){const l=e,{componentId:i,rateItemData:c,activeItemWidth:r,onTouchStart:u,onTouchMove:v,onTouchEnd:m}=W(l,t),{ns:d,rateClass:p,itemClass:N,itemStyle:M}=(e=>{const t=a("rate"),{sizeType:l}=o(e.size),i=n((()=>{const a=[t.b()];return e.size&&"inner"===l.value&&a.push(t.m(e.size)),e.readonly&&a.push(t.is("readonly")),a.join(" ")})),c=n((()=>(e,a)=>{const o=[t.e("item"),t.is(e)];return a.color.class&&o.push(a.color.class),o.join(" ")})),r=n((()=>(t,a)=>{const o={};return e.size&&"custom"===l.value&&(o.fontSize=s(e.size)),e.gutter&&(o.padding=`0rpx calc(${s(e.gutter)} / 2)`),"active"===t&&(a.color.class||(o.color=a.color.style||"var(--tn-color-primary)")),"inactive"===t&&(a.color.class||(o.color=a.color.style||"var(--tn-color-gray)")),o}));return{ns:t,rateClass:i,itemStyle:r,itemClass:c}})(l);return(e,t)=>{const a=w;return f(),h(a,{id:x(i),class:_([x(p)]),onTouchstart:j(x(u),["stop","prevent"]),onTouchmove:j(x(v),["stop","prevent"]),onTouchend:j(x(m),["stop","prevent"])},{default:y((()=>[I(" 默认显示的图标 "),T(a,{class:_([x(d).e("container"),x(d).e("inactive-container")])},{default:y((()=>[(f(!0),g(S,null,C(x(c),((e,t)=>(f(),h(a,{key:t,class:_([x(N)("inactive",e.inactive)]),style:b(x(M)("inactive",e.inactive))},{default:y((()=>[T(z,{name:e.inactive.icon},null,8,["name"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class"]),I(" 选中显示的图标 "),T(a,{class:_([x(d).e("container"),x(d).e("active-container")]),style:b({width:`${x(r)}px`})},{default:y((()=>[(f(!0),g(S,null,C(x(c),((e,t)=>(f(),h(a,{key:t,class:_([x(N)("active",e.active)]),style:b(x(M)("active",e.active))},{default:y((()=>[T(z,{name:e.active.icon},null,8,["name"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","style"])])),_:1},8,["id","class","onTouchstart","onTouchmove","onTouchend"])}}}),[["__scopeId","data-v-846f6c2e"]]);export{O as T};

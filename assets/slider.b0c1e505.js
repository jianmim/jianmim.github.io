import{b as e,d as a,aO as t,a3 as l,c as i,r as s,w as r,H as n,y as o,z as u,N as d,V as m,W as c,X as h,Z as v,a as p,L as g,o as f,e as S,f as b,g as y,h as x,K as C,u as M,C as T,n as B,k as N,_ as w}from"./index-80b03063.js";import{i as V}from"./is-number.acae358a.js";import{U as j,C as k,I}from"./event.5568c9d8.js";import{u as E,c as z,b as _}from"./index.f7e3486a.js";import{u as $}from"./index.38361e72.js";import{u as F}from"./index.a1af8551.js";import{a as H}from"./index.b621671f.js";const O=e({modelValue:{type:a([Number,Array]),default:0},size:t,sliderBarSize:{type:[String,Number]},sliderHeight:{type:[String,Number]},activeColor:{type:String,default:""},inactiveColor:{type:String,default:""},disabled:Boolean,step:{type:Number,default:1},min:{type:Number,default:0},max:{type:Number,default:100},validateEvent:{type:Boolean,default:!0}}),X=e=>({size:E(e.size),disabled:z(e.disabled)}),q=e=>{const{emit:a}=o(),{formItem:t}=_(),u=i((()=>!!t)),d=s(H(e.modelValue,0));(()=>{let t=e.modelValue;t=l(t)?0===t.length?[0,0]:1===t.length?[0,Math.min(t[0],e.max)]:[Math.max(Math.min(t[0],t[1]),e.min),Math.min(Math.max(t[0],t[1],e.min),e.max)]:Math.min(Math.max(H(t,0),e.min),e.max),n((()=>{a(j,t)}))})(),r((()=>e.modelValue),(e=>{d.value=e}));const m=i((()=>l(d.value)?"range":"single")),c=i((()=>{const a=[e.min,e.max,e.step].map((e=>{const a=`${e}`.split(".")[1];return a?a.length:0}));return Math.max.apply(null,a)})),h=(a,t)=>{if("single"===m.value)return a;{const l=d.value[0],i=d.value[1];return"min"===t?[Math.min(Math.max(e.min,a),i),d.value[1]]:[d.value[0],Math.max(Math.min(a,e.max),l)]}};return{isFormItem:u,sliderValue:d,mode:m,precision:c,updateSliderValue:(l,i)=>{const s=h(l,i);a(j,s),n((()=>{a(I,s)})),e.validateEvent&&(null==t||t.validate("input").catch((e=>{})))},changeSliderValue:(l,i)=>{const s=h(l,i);a(k,s),e.validateEvent&&(null==t||t.validate("change").catch((e=>{})))}}},A=w(p({__name:"slider",props:O,emits:{[j]:e=>l(e)||V(e),[k]:e=>l(e)||V(e),[I]:e=>l(e)||V(e)},setup(e){const a=e,{isFormItem:t,sliderValue:l,mode:s}=q(a),{sliderId:o,initSliderNodeInfo:p,onSliderBarTouchStart:w,onSliderBarTouchMove:V,onSliderBarTouchEnd:j,sliderClickEvent:k}=(e=>{const a=`slider-${d()}`,{getSelectorNodeInfo:t}=$(),{disabled:l}=X(e),{mode:i,sliderValue:s,precision:n,updateSliderValue:o,changeSliderValue:m}=q(e),c=u({left:0,top:0,right:0,bottom:0,width:0,height:0}),{currentX:h,updateOptions:v,onTouchStart:p,onTouchMove:g,onTouchEnd:f}=F();r((()=>l),(e=>{v({disabled:e.value})}));let S=0;const b=async()=>{try{const e=await t(`#${a}`);if(!e)throw new Error("获取滑动条的布局信息失败");S=0,c.left=e.left||0,c.top=e.top||0,c.right=e.right||0,c.bottom=e.bottom||0,c.width=e.width||0,c.height=e.height||0,v({left:c.left,right:c.right,top:c.top,bottom:c.bottom})}catch(e){if(S++,S>10)return void(S=0);setTimeout((()=>{b()}),150)}},y=a=>{if(null===a||Number.isNaN(+a))return 0;a<0?a=0:a>100&&(a=100);const t=100/((e.max-e.min)/e.step);let l=Math.round(a/t)*t*(e.max-e.min)*.01+e.min;return l=Number.parseFloat(l.toFixed(n.value)),l};return{sliderId:a,initSliderNodeInfo:b,onSliderBarTouchStart:p,onSliderBarTouchMove:(e,a)=>{g(e);const t=h.value/c.width*100,l=y(t);o(l,a)},onSliderBarTouchEnd:(e,a)=>{f(e);const t=h.value/c.width*100,l=y(t);m(l,a)},sliderClickEvent:e=>{if(l.value)return;let a=0;a=e.detail.x;const t=(a-c.left)/c.width*100,r=y(t);if("single"===i.value)o(r),m(r);else if("range"===i.value){const e=s.value[0],a=s.value[1];Math.abs(e-r)<Math.abs(a-r)?(o(r,"min"),m(r,"min")):(o(r,"max"),m(r,"max"))}}}})(a),{ns:I,sliderClass:E,sliderStyle:z,activeSliderClass:_,activeSliderStyle:H,sliderBarClass:O,sliderBarStyle:A}=((e,a,t)=>{const l=m("slider"),{size:s,disabled:r}=X(e),[n,o]=c(h(e,"activeColor"),"bg"),[u,d]=c(h(e,"inactiveColor"),"bg"),p=i((()=>"single"===t.value?[(a.value-e.min)/(e.max-e.min)*100+"%","0"]:[(a.value[0]-e.min)/(e.max-e.min)*100+"%",(a.value[1]-e.min)/(e.max-e.min)*100+"%"])),g=i((()=>{const e=[l.b()];return s.value&&e.push(l.m(s.value)),r.value&&e.push(l.m("disabled")),u.value&&e.push(u.value),e.join(" ")})),f=i((()=>{const a={};return e.sliderHeight&&(a.height=v(e.sliderHeight)),u.value||(a.backgroundColor=d.value||"var(--tn-color-grey-light)"),a})),S=i((()=>{const e=[l.e("active")];return n.value&&e.push(n.value),e.join(" ")})),b=i((()=>{const e={};return n.value||(e.backgroundColor=o.value||"var(--tn-color-primary)"),"single"===t.value?e.width=p.value[0]:"range"===t.value&&(e.width=`calc(${p.value[1]} - ${p.value[0]})`,e.left=p.value[0]),e})),y=i((()=>[l.e("bar")].join(" "))),x=i((()=>a=>{const t={};return e.sliderBarSize&&(t.width=t.height=v(e.sliderBarSize)),t.left="min"===a?p.value[0]:p.value[1],t}));return{ns:l,sliderClass:g,sliderStyle:f,activeSliderClass:S,activeSliderStyle:b,sliderBarClass:y,sliderBarStyle:x}})(a,l,s);return g((()=>{n((()=>{p()}))})),(e,a)=>{const l=N;return f(),S(l,{id:M(o),class:C([M(E),M(I).is("form-item",M(t))]),style:T(M(z)),onClick:B(M(k),["stop"])},{default:b((()=>[y(" 激活时的滑动条 "),x(l,{class:C([M(_)]),style:T(M(H)),onClick:B(M(k),["stop"])},null,8,["class","style","onClick"]),y(" 开始滑块 "),x(l,{class:C([M(O)]),style:T(M(A)("min")),onTouchstart:B(M(w),["prevent"]),onTouchmove:a[0]||(a[0]=B((e=>M(V)(e,"min")),["prevent"])),onTouchend:a[1]||(a[1]=B((e=>M(j)(e,"min")),["prevent"]))},null,8,["class","style","onTouchstart"]),y(" 结束滑块 "),"range"===M(s)?(f(),S(l,{key:0,class:C([M(O)]),style:T(M(A)("max")),onTouchstart:B(M(w),["prevent"]),onTouchmove:a[2]||(a[2]=B((e=>M(V)(e,"max")),["prevent"])),onTouchend:a[3]||(a[3]=B((e=>M(j)(e,"max")),["prevent"]))},null,8,["class","style","onTouchstart"])):y("v-if",!0)])),_:1},8,["id","class","style","onClick"])}}}),[["__scopeId","data-v-2ae9a97c"]]);export{A as T};

import{k as S,v as z,u as J,a0 as H,r as f,L as Q,p as W,l as X,E as w,t as l,a6 as Y,x as V,M as Z,D as s,A as t,U as v,O as m,P as ee,y as A,G as ae,B as oe,T as D,F as se,a4 as te,i as ne,_ as re,ah as le}from"./store-mQZkmHj-.js";import{g as b,L as ie,k as ce,S as ue,l as de,m as me,N as pe,n as E,p as fe}from"./index-lw7p-_pG.js";import{a as ge}from"./formatTime-sb5Dmd3Z.js";import{l as _e}from"./logo-mini-gwMegSab.js";import{_ as ye}from"./_plugin-vue_export-helper-x3n3nnut.js";const he={class:"login-content-code"},we=["src"],Ve={class:"font12 mt30 login-animation4 login-msg"},ve={class:"dialog-header"},be=S({name:"loginAccount"}),Ee=S({...be,setup(Ce,{expose:B}){const T=ne(()=>re(()=>import("./dragVerifyImgRotate-fIFo95mn.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),{t:U}=z.useI18n(),p=J(),C=H(),k=f(),I=f(),x=f(),P=f(),R=f(null),e=Q({isShowPassword:!1,ruleForm:{account:"",password:"",code:"",codeId:0},rules:{account:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},loading:{signIn:!1},captchaImage:"",rotateVerifyVisible:!1,rotateVerifyImg:_e,secondVerEnabled:!1,captchaEnabled:!1,isPassRotate:!1});W(async()=>{var o=p.query.token;o!=null&&o!=null&&await y(o);var a=await b(E).apiSysAuthLoginConfigGet();e.secondVerEnabled=a.data.result.secondVerEnabled??!0,e.captchaEnabled=a.data.result.captchaEnabled??!0,g()});const g=async()=>{var a,n;if(e.captchaEnabled){e.ruleForm.code="";var o=await b(E).apiSysAuthCaptchaGet();e.captchaImage="data:text/html;base64,"+((a=o.data.result)==null?void 0:a.img),e.ruleForm.codeId=(n=o.data.result)==null?void 0:n.id}},q=X(()=>ge(new Date)),F=async()=>{k.value.validate(async o=>{var a,n;if(!o)return!1;try{e.loading.signIn=!0;const i=le.doEncrypt(e.ruleForm.password,"0484C7466D950E120E5ECE5DD85D0C90EAA85081A3A2BD7C57AE6DC822EFCCBD66620C67B0103FC8DD280E36C3B282977B722AAEC3C56518EDCEBAFB72C5A05312",1),[c,d]=await fe(b(E).apiSysAuthLoginPost({...e.ruleForm,password:i}));if(c){g();return}if(((a=d.data.result)==null?void 0:a.accessToken)==null){g(),w.error("登录失败，请检查账号！");return}await y((n=d.data.result)==null?void 0:n.accessToken)}finally{e.loading.signIn=!1}})},y=async o=>{ie.set(ce,o),ue.set("token",o);const a=await de();K(a)},K=o=>{var a,n,u,i;if(o)w.warning("抱歉，您没有登录权限"),me();else{let c=q.value;(a=p.query)!=null&&a.redirect?C.push({path:(n=p.query)==null?void 0:n.redirect,query:Object.keys((u=p.query)==null?void 0:u.params).length>0?JSON.parse((i=p.query)==null?void 0:i.params):""}):C.push("/");const d=U("message.signInText");w.success(`${c}，${d}`),pe.start()}},L=()=>{var o;e.rotateVerifyVisible=!0,e.isPassRotate=!1,(o=R.value)==null||o.reset()},N=()=>{e.rotateVerifyVisible=!1,e.isPassRotate=!0,F()},_=()=>{var o,a,n;e.ruleForm.account?e.ruleForm.password?e.captchaEnabled&&!e.ruleForm.code?(n=P.value)==null||n.focus():e.secondVerEnabled?L():F():(a=x.value)==null||a.focus():(o=I.value)==null||o.focus()};return B({saveTokenAndInitRoutes:y}),(o,a)=>{const n=l("ele-User"),u=l("el-icon"),i=l("el-input"),c=l("el-form-item"),d=l("ele-Unlock"),$=l("ele-Position"),h=l("el-col"),M=l("el-button"),O=l("el-form"),G=l("el-dialog"),j=Y("waves");return V(),Z(te,null,[s(O,{ref_key:"ruleFormRef",ref:k,model:e.ruleForm,size:"large",rules:e.rules,class:"login-content-form"},{default:t(()=>[s(c,{class:"login-animation1",prop:"account"},{default:t(()=>[s(i,{ref_key:"accountRef",ref:I,text:"",placeholder:"请输入账号",modelValue:e.ruleForm.account,"onUpdate:modelValue":a[0]||(a[0]=r=>e.ruleForm.account=r),clearable:"",autocomplete:"off",onKeyup:v(_,["enter","native"])},{prefix:t(()=>[s(u,null,{default:t(()=>[s(n)]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(c,{class:"login-animation2",prop:"password"},{default:t(()=>[s(i,{ref_key:"passwordRef",ref:x,type:e.isShowPassword?"text":"password",placeholder:"请输入密码",modelValue:e.ruleForm.password,"onUpdate:modelValue":a[2]||(a[2]=r=>e.ruleForm.password=r),autocomplete:"off",onKeyup:v(_,["enter","native"])},{prefix:t(()=>[s(u,null,{default:t(()=>[s(d)]),_:1})]),suffix:t(()=>[m("i",{class:ee(["iconfont el-input__icon login-content-password",e.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:a[1]||(a[1]=r=>e.isShowPassword=!e.isShowPassword)},null,2)]),_:1},8,["type","modelValue"])]),_:1}),e.captchaEnabled?(V(),A(c,{key:0,class:"login-animation3",prop:"captcha"},{default:t(()=>[s(h,{span:15},{default:t(()=>[s(i,{ref_key:"codeRef",ref:P,text:"",maxlength:"4",placeholder:o.$t("message.account.accountPlaceholder3"),modelValue:e.ruleForm.code,"onUpdate:modelValue":a[3]||(a[3]=r=>e.ruleForm.code=r),clearable:"",autocomplete:"off",onKeyup:v(_,["enter","native"])},{prefix:t(()=>[s(u,null,{default:t(()=>[s($)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),s(h,{span:1}),s(h,{span:8},{default:t(()=>[m("div",he,[m("img",{class:"login-content-code-img",onClick:g,width:"130px",height:"38px",src:e.captchaImage,style:{cursor:"pointer"}},null,8,we)])]),_:1})]),_:1})):ae("",!0),s(c,{class:"login-animation4"},{default:t(()=>[oe((V(),A(M,{type:"primary",class:"login-content-submit",round:"",onClick:_,loading:e.loading.signIn},{default:t(()=>[m("span",null,D(o.$t("message.account.accountBtnText")),1)]),_:1},8,["loading"])),[[j]])]),_:1}),m("div",Ve,D(o.$t("message.mobile.msgText")),1)]),_:1},8,["model","rules"]),m("div",ve,[s(G,{modelValue:e.rotateVerifyVisible,"onUpdate:modelValue":a[5]||(a[5]=r=>e.rotateVerifyVisible=r),"show-close":!1},{default:t(()=>[s(se(T),{ref_key:"dragRef",ref:R,imgsrc:e.rotateVerifyImg,isPassing:e.isPassRotate,"onUpdate:isPassing":a[4]||(a[4]=r=>e.isPassRotate=r),text:"请按住滑块拖动",successText:"验证通过",handlerIcon:"fa fa-angle-double-right",successIcon:"fa fa-hand-peace-o",onPasscallback:N},null,8,["imgsrc","isPassing"])]),_:1},8,["modelValue"])])],64)}}}),Fe=ye(Ee,[["__scopeId","data-v-bafb0662"]]);export{Fe as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./dragVerifyImgRotate-fIFo95mn.js","./store-mQZkmHj-.js","../css/store-dzCp3yyn.css","./_plugin-vue_export-helper-x3n3nnut.js","../css/dragVerifyImgRotate-ooBTKgWN.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}

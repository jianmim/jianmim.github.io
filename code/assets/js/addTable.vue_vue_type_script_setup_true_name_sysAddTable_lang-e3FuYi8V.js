import{k as P,r as Y,L as Z,t as d,x as r,M as b,D as e,A as a,O as D,S as u,a4 as h,a5 as w,F as V,Q as C,y as _,G as F,E as ee}from"./store-dof5ccn5.js";import{g as le}from"./index-zQlakb1H.js";import{S as ae}from"./sys-database-api-8F8NB6RO.js";import{y as N,d as te}from"./database-zhWWLKxD.js";const oe={class:"sys-dbTable-container"},ne={style:{color:"#fff"}},de=D("span",null," 增加表 ",-1),ie={style:{"text-align":"left","margin-top":"10px"}},re={class:"dialog-footer"},ue=P({name:"sysAddTable"}),be=P({...ue,emits:["addTableSubmitted"],setup(se,{expose:E,emit:A}){var p=0;const B=A,v=Y(),o=Z({isShowDialog:!1,ruleForm:{},tableData:[]}),$=i=>{var n;o.ruleForm=i,o.isShowDialog=!0,(n=v.value)==null||n.resetFields()},L=()=>{B("addTableSubmitted",o.ruleForm.tableName??""),o.tableData=[],o.isShowDialog=!1},M=()=>{o.isShowDialog=!1},q=()=>{v.value.validate(async i=>{if(!i)return;if(o.tableData.length===0){ee({type:"error",message:"请添加列!"});return}const n={dbColumnInfoList:o.tableData,...o.ruleForm};await le(ae).apiSysDatabaseAddTablePost(n),L()})};function R(){o.tableData.push({columnDescription:"主键Id",dataType:"bigint",dbColumnName:"Id",decimalDigits:0,isIdentity:0,isNullable:0,isPrimarykey:1,length:0,key:p,editable:!0,isNew:!0}),p++}function z(){o.tableData.push({columnDescription:"",dataType:"varchar",dbColumnName:"",decimalDigits:0,isIdentity:0,isNullable:1,isPrimarykey:0,length:32,key:p,editable:!0,isNew:!0}),p++}function G(){o.tableData.push({columnDescription:"租户Id",dataType:"bigint",dbColumnName:"TenantId",decimalDigits:0,isIdentity:0,isNullable:1,isPrimarykey:0,length:0,key:p,editable:!0,isNew:!0}),p++}function O(){[{dataType:"datetime",name:"CreateTime",desc:"创建时间"},{dataType:"datetime",name:"UpdateTime",desc:"更新时间"},{dataType:"bigint",name:"CreateUserId",desc:"创建者Id"},{dataType:"varchar",name:"CreateUserName",desc:"创建者姓名",length:64},{dataType:"bigint",name:"UpdateUserId",desc:"修改者Id"},{dataType:"varchar",name:"UpdateUserName",desc:"修改者姓名",length:64},{dataType:"bit",name:"IsDelete",desc:"软删除",isNullable:0}].forEach(n=>{o.tableData.push({columnDescription:n.desc,dataType:n.dataType,dbColumnName:n.name,decimalDigits:0,isIdentity:0,isNullable:n.isNullable===0?0:1,isPrimarykey:0,length:n.length||0,key:p,editable:!0,isNew:!0}),p++})}function Q(i){o.tableData.splice(i,1)}function j(i,n){if(i.isNew){var s=T(n,n-1,o.tableData);return s}}function H(i,n){if(i.isNew)return T(n,n+1,o.tableData)}function T(i,n,s){let k=s[i];return s[i]=s[n],s[n]=k,s}return E({openDialog:$}),(i,n)=>{const s=d("ele-Edit"),k=d("el-icon"),U=d("el-divider"),f=d("el-input"),x=d("el-form-item"),I=d("el-col"),J=d("el-row"),K=d("el-form"),m=d("el-table-column"),y=d("el-option"),g=d("el-select"),S=d("el-input-number"),c=d("el-button"),W=d("el-table"),X=d("el-dialog");return r(),b("div",oe,[e(X,{modelValue:o.isShowDialog,"onUpdate:modelValue":n[2]||(n[2]=l=>o.isShowDialog=l),draggable:"","close-on-click-modal":!1,width:"1400px"},{header:a(()=>[D("div",ne,[e(k,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:a(()=>[e(s)]),_:1}),de])]),footer:a(()=>[D("span",re,[e(c,{onClick:M},{default:a(()=>[u("取 消")]),_:1}),e(c,{type:"primary",onClick:q},{default:a(()=>[u("确 定")]),_:1})])]),default:a(()=>[e(U,{"content-position":"left"},{default:a(()=>[u("数据表信息")]),_:1}),e(K,{model:o.ruleForm,ref_key:"ruleFormRef",ref:v,"label-width":"auto"},{default:a(()=>[e(J,{gutter:35},{default:a(()=>[e(I,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[e(x,{label:"表名称",prop:"tableName",rules:[{required:!0,message:"名称不能为空",trigger:"blur"}]},{default:a(()=>[e(f,{modelValue:o.ruleForm.tableName,"onUpdate:modelValue":n[0]||(n[0]=l=>o.ruleForm.tableName=l),placeholder:"表名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(I,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[e(x,{label:"描述",prop:"description",rules:[{required:!0,message:"描述不能为空",trigger:"blur"}]},{default:a(()=>[e(f,{modelValue:o.ruleForm.description,"onUpdate:modelValue":n[1]||(n[1]=l=>o.ruleForm.description=l),placeholder:"描述",clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(U,{"content-position":"left"},{default:a(()=>[u("数据列信息")]),_:1}),e(W,{data:o.tableData,style:{width:"100%"},"max-height":"400"},{default:a(()=>[e(m,{prop:"dbColumnName",label:"字段名",width:"220",fixed:""},{default:a(l=>[e(f,{modelValue:l.row.dbColumnName,"onUpdate:modelValue":t=>l.row.dbColumnName=t,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{prop:"columnDescription",label:"描述",width:"220"},{default:a(l=>[e(f,{modelValue:l.row.columnDescription,"onUpdate:modelValue":t=>l.row.columnDescription=t,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{prop:"isPrimarykey",label:"主键",width:"100"},{default:a(l=>[e(g,{modelValue:l.row.isPrimarykey,"onUpdate:modelValue":t=>l.row.isPrimarykey=t,class:"m-2",placeholder:"Select"},{default:a(()=>[(r(!0),b(h,null,w(V(N),t=>(r(),_(y,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{prop:"isIdentity",label:"自增",width:"100"},{default:a(l=>[e(g,{modelValue:l.row.isIdentity,"onUpdate:modelValue":t=>l.row.isIdentity=t,class:"m-2",placeholder:"Select"},{default:a(()=>[(r(!0),b(h,null,w(V(N),t=>(r(),_(y,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{prop:"dataType",label:"类型",width:"150"},{default:a(l=>[e(g,{modelValue:l.row.dataType,"onUpdate:modelValue":t=>l.row.dataType=t,class:"m-2",placeholder:"Select"},{default:a(()=>[(r(!0),b(h,null,w(V(te),t=>(r(),_(y,{key:t.value,label:t.value,value:t.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{prop:"isNullable",label:"可空",width:"100"},{default:a(l=>[e(g,{modelValue:l.row.isNullable,"onUpdate:modelValue":t=>l.row.isNullable=t,class:"m-2",placeholder:"Select"},{default:a(()=>[(r(!0),b(h,null,w(V(N),t=>(r(),_(y,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{prop:"length",label:"长度",width:"100"},{default:a(l=>[e(S,{modelValue:l.row.length,"onUpdate:modelValue":t=>l.row.length=t,"controls-position":"right",class:"w100"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{prop:"decimalDigits",label:"小数位",width:"100"},{default:a(l=>[e(S,{modelValue:l.row.decimalDigits,"onUpdate:modelValue":t=>l.row.decimalDigits=t,"controls-position":"right",class:"w100"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{label:"操作","min-width":"200",align:"center",fixed:"right"},{default:a(l=>[e(c,{link:"",type:"primary",icon:"el-icon-delete",onClick:C(t=>Q(l.$index),["prevent"])},{default:a(()=>[u("删除")]),_:2},1032,["onClick"]),o.tableData.length>1?(r(),_(c,{key:0,link:"",type:"primary",icon:"ele-Top",onClick:C(t=>j(l.row,l.$index),["prevent"])},{default:a(()=>[u("上移")]),_:2},1032,["onClick"])):F("",!0),o.tableData.length>1?(r(),_(c,{key:1,link:"",type:"primary",icon:"ele-Bottom",onClick:C(t=>H(l.row,l.$index),["prevent"])},{default:a(()=>[u("下移")]),_:2},1032,["onClick"])):F("",!0)]),_:1})]),_:1},8,["data"]),D("div",ie,[e(c,{icon:"ele-Plus",onClick:R},{default:a(()=>[u("新增主键字段")]),_:1}),e(c,{icon:"ele-Plus",onClick:z},{default:a(()=>[u("新增普通字段")]),_:1}),e(c,{icon:"ele-Plus",onClick:G},{default:a(()=>[u("新增租户字段")]),_:1}),e(c,{icon:"ele-Plus",onClick:O},{default:a(()=>[u("新增基础字段")]),_:1})])]),_:1},8,["modelValue"])])}}});export{be as _};

import{k as B,L as O,r as c,p as R,t as s,x as $,M as j,D as l,A as e,O as i,T as z,F as J,S as f,B as X,E as u,X as Y,Y as G,C as H}from"./store-mQZkmHj-.js";import{d as K,i as Q,g as W}from"./licMachineCode-D0t31_8V.js";import{g as Z}from"./index-lw7p-_pG.js";import{S as ee}from"./sys-file-api-F5kUk1jA.js";import{_ as le}from"./_plugin-vue_export-helper-x3n3nnut.js";import"./request--bhxBvPJ.js";const y=n=>(Y("data-v-9f92b59f"),n=n(),G(),n),te={class:"licMachineCode-container"},ae={style:{color:"#fff"}},oe={style:{color:"#fff"}},se=y(()=>i("span",null," 上传文件 ",-1)),ie=y(()=>i("div",{class:"el-upload__text"},[f("将文件拖到此处，或"),i("em",null,"点击上传")],-1)),re=y(()=>i("div",{class:"el-upload__tip"},"请上传大小不超过 10MB 的文件",-1)),ne={class:"dialog-footer"},de=B({__name:"importDialog",props:{title:{type:String,default:""}},emits:["reloadTable"],setup(n,{expose:U,emit:S}){var D=n;const V=(a,t)=>{p.fileList=t},p=O({loading:!1,fileData:[],queryParams:{fileName:void 0,startTime:void 0,endTime:void 0},tableParams:{page:1,pageSize:10,total:0},dialogUploadVisible:!1,diaglogEditFile:!1,fileList:[],dialogDocxVisible:!1,dialogXlsxVisible:!1,dialogPdfVisible:!1,showViewer:!1,docxUrl:"",excelUrl:"",pdfUrl:"",fileName:"",previewList:[]}),C=S,v=c(),d=c(!1),r=c({}),F=c({machineCode:[{required:!0,message:"请输入机器码！",trigger:"blur"}],projectName:[{required:!0,message:"请输入项目名称！",trigger:"blur"}],concurrencyCount:[{required:!0,message:"请输入并发数目！",trigger:"blur"}],userCount:[{required:!0,message:"请输入用户数目！",trigger:"blur"}],systemType:[{required:!0,message:"请选择系统类型！",trigger:"change"}]}),L=async a=>{const t=document.createElement("a");t.href=window.__env__.VITE_API_URL+"/ExcelTemplate/机器码导入模板.xlsx",t.click()},I=async a=>{let t=JSON.parse(JSON.stringify(a));t.id?r.value=(await K(t.id)).data.result:r.value=t,d.value=!0},h=()=>{C("reloadTable"),d.value=!1},T=()=>{d.value=!1},k=async()=>{p.fileList.length<1||await Z(ee).apiSysFileUploadFilePostForm(p.fileList[0].raw).then(a=>{u.success("上传成功"),console.log("上传成功",a),N(a.data.result.id)})},N=async a=>{if(console.log(a),a>0){let t=r.value;console.log("values",t),v.value.validate(async(_,m)=>{_?(Q({FileName:"",Url:"",Id:a}).then(o=>{o.data.code==200?o.data.result.code==0?(u({message:`导入成功${o.data.result.msg}`,type:"success"}),h()):u({message:`导入失败${o.data.result.msg}`,type:"error"}):u({message:`导入失败${o.data.message}`,type:"error"}),console.log("导入成功",o)}),h()):u({message:`表单有${Object.keys(m).length}处验证失败，请修改后再提交`,type:"error"})})}},A=c([]);return(async()=>{let a=await W();A.value=a.data.result??[]})(),R(async()=>{}),U({openDialog:I}),(a,t)=>{const _=s("el-input"),m=s("el-form-item"),o=s("el-button"),w=s("el-col"),x=s("ele-UploadFilled"),b=s("el-icon"),E=s("el-upload"),q=s("el-row"),M=s("el-form"),P=s("el-dialog");return $(),j("div",te,[l(P,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=g=>d.value=g),width:800,draggable:""},{header:e(()=>[i("div",ae,[i("span",null,z(J(D).title),1)])]),footer:e(()=>[i("span",ne,[l(o,{onClick:T},{default:e(()=>[f("取 消")]),_:1}),l(o,{type:"primary",onClick:k},{default:e(()=>[f("确 定")]),_:1})])]),default:e(()=>[l(M,{model:r.value,ref_key:"ruleFormRef",ref:v,"label-width":"auto",rules:F.value},{default:e(()=>[l(q,{gutter:35},{default:e(()=>[X(l(m,null,{default:e(()=>[l(_,{modelValue:r.value.id,"onUpdate:modelValue":t[0]||(t[0]=g=>r.value.id=g)},null,8,["modelValue"])]),_:1},512),[[H,!1]]),l(w,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:e(()=>[l(m,{label:"下载模板"},{default:e(()=>[l(o,{type:"primary",onClick:L},{default:e(()=>[f("导入模板")]),_:1})]),_:1})]),_:1}),l(w,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{header:e(()=>[i("div",oe,[l(b,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:e(()=>[l(x)]),_:1}),se])]),default:e(()=>[i("div",null,[l(E,{ref:"uploadRef",drag:"","auto-upload":!1,limit:1,"file-list":p.fileList,action:"","on-change":V,accept:".jpg,.png,.bmp,.gif,.txt,.pdf,.xlsx,.docx"},{tip:e(()=>[re]),default:e(()=>[l(b,{class:"el-icon--upload"},{default:e(()=>[l(x)]),_:1}),ie]),_:1},8,["file-list"])])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),ye=le(de,[["__scopeId","data-v-9f92b59f"]]);export{ye as default};

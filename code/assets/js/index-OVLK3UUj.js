import{g as Q,a as J}from"./download-0Y1BJycW.js";import{B as X,d as k,g as V}from"./index-xdJ7pE-g.js";import{b as C,k as B,L as $,p as G,t as u,a6 as R,B as x,x as y,M as K,D as t,A as l,y as P,S as w,O as z,T as W,E as Z,X as ee,Y as ae}from"./store-dof5ccn5.js";import{_ as te}from"./_plugin-vue_export-helper-x3n3nnut.js";const q=function(s){return{apiSysLogOpClearPost:async(e={})=>{const o="/api/sysLogOp/clear",n=new URL(o,"https://example.com");let r;s&&(r=s.baseOptions);const i={method:"POST",...r,...e},c={},g={};if(s&&s.accessToken){const h=typeof s.accessToken=="function"?await s.accessToken():await s.accessToken;c.Authorization="Bearer "+h}const _=new URLSearchParams(n.search);for(const h in g)_.set(h,g[h]);for(const h in e.params)_.set(h,e.params[h]);n.search=new URLSearchParams(_).toString();let f=r&&r.headers?r.headers:{};return i.headers={...c,...f,...e.headers},{url:n.pathname+n.search+n.hash,options:i}},apiSysLogOpExportPost:async(e,o={})=>{const n="/api/sysLogOp/export",r=new URL(n,"https://example.com");let i;s&&(i=s.baseOptions);const c={method:"POST",...i,...o},g={},_={};if(s&&s.accessToken){const a=typeof s.accessToken=="function"?await s.accessToken():await s.accessToken;g.Authorization="Bearer "+a}g["Content-Type"]="application/json-patch+json";const f=new URLSearchParams(r.search);for(const a in _)f.set(a,_[a]);for(const a in o.params)f.set(a,o.params[a]);r.search=new URLSearchParams(f).toString();let h=i&&i.headers?i.headers:{};c.headers={...g,...h,...o.headers};const S=typeof e!="string"||c.headers["Content-Type"]==="application/json";return c.data=S?JSON.stringify(e!==void 0?e:{}):e||"",{url:r.pathname+r.search+r.hash,options:c}},apiSysLogOpPagePost:async(e,o={})=>{const n="/api/sysLogOp/page",r=new URL(n,"https://example.com");let i;s&&(i=s.baseOptions);const c={method:"POST",...i,...o},g={},_={};if(s&&s.accessToken){const a=typeof s.accessToken=="function"?await s.accessToken():await s.accessToken;g.Authorization="Bearer "+a}g["Content-Type"]="application/json-patch+json";const f=new URLSearchParams(r.search);for(const a in _)f.set(a,_[a]);for(const a in o.params)f.set(a,o.params[a]);r.search=new URLSearchParams(f).toString();let h=i&&i.headers?i.headers:{};c.headers={...g,...h,...o.headers};const S=typeof e!="string"||c.headers["Content-Type"]==="application/json";return c.data=S?JSON.stringify(e!==void 0?e:{}):e||"",{url:r.pathname+r.search+r.hash,options:c}}}},A=function(s){return{async apiSysLogOpClearPost(e){const o=await q(s).apiSysLogOpClearPost(e);return(n=C,r=k)=>{const i={...o.options,url:r+o.url};return n.request(i)}},async apiSysLogOpExportPost(e,o){const n=await q(s).apiSysLogOpExportPost(e,o);return(r=C,i=k)=>{const c={...n.options,url:i+n.url};return r.request(c)}},async apiSysLogOpPagePost(e,o){const n=await q(s).apiSysLogOpPagePost(e,o);return(r=C,i=k)=>{const c={...n.options,url:i+n.url};return r.request(c)}}}};class D extends X{async apiSysLogOpClearPost(e){return A(this.configuration).apiSysLogOpClearPost(e).then(o=>o(this.axios,this.basePath))}async apiSysLogOpExportPost(e,o){return A(this.configuration).apiSysLogOpExportPost(e,o).then(n=>n(this.axios,this.basePath))}async apiSysLogOpPagePost(e,o){return A(this.configuration).apiSysLogOpPagePost(e,o).then(n=>n(this.axios,this.basePath))}}const oe=s=>(ee("data-v-654d6d62"),s=s(),ae(),s),se={class:"sys-oplog-container"},le={style:{color:"#fff"}},re=oe(()=>z("span",null," 日志详情 ",-1)),ne=B({name:"sysOpLog"}),ie=B({...ne,setup(s){const e=$({loading:!1,queryParams:{startTime:void 0,endTime:void 0},tableParams:{page:1,pageSize:20,field:"createTime",order:"descending",descStr:"descending",total:0},logData:[],dialogVisible:!1,content:""});G(async()=>{o()});const o=async()=>{var O,b;e.queryParams.startTime==null&&(e.queryParams.startTime=void 0),e.queryParams.endTime==null&&(e.queryParams.endTime=void 0),e.loading=!0;let a=Object.assign(e.queryParams,e.tableParams);var m=await V(D).apiSysLogOpPagePost(a);e.logData=((O=m.data.result)==null?void 0:O.items)??[],e.tableParams.total=(b=m.data.result)==null?void 0:b.total,e.loading=!1},n=()=>{e.queryParams.startTime=void 0,e.queryParams.endTime=void 0,o()},r=async()=>{e.loading=!0,await V(D).apiSysLogOpClearPost(),e.loading=!1,Z.success("清空成功"),o()},i=async()=>{e.loading=!0;var a=await V(D).apiSysLogOpExportPost(e.queryParams,{responseType:"blob"});e.loading=!1;var m=Q(a.headers);J(a.data,m)},c=a=>{e.tableParams.pageSize=a,o()},g=a=>{e.tableParams.page=a,o()},_=a=>{e.content=a.message,e.dialogVisible=!0},f=a=>a.row.exception!=null?"warning-row":"",h=[{text:"今天",value:new Date},{text:"昨天",value:()=>{const a=new Date;return a.setTime(a.getTime()-3600*1e3*24),a}},{text:"上周",value:()=>{const a=new Date;return a.setTime(a.getTime()-3600*1e3*24*7),a}}],S=a=>{e.tableParams.field=a.prop,e.tableParams.order=a.order,o()};return(a,m)=>{const O=u("el-date-picker"),b=u("el-form-item"),T=u("el-button"),I=u("el-button-group"),j=u("el-form"),U=u("el-card"),p=u("el-table-column"),v=u("el-tag"),N=u("el-table"),E=u("el-pagination"),F=u("ele-Document"),Y=u("el-icon"),H=u("el-dialog"),L=R("auth"),M=R("loading");return x((y(),K("div",se,[t(U,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:l(()=>[t(j,{model:e.queryParams,ref:"queryForm",inline:!0},{default:l(()=>[t(b,{label:"开始时间"},{default:l(()=>[t(O,{modelValue:e.queryParams.startTime,"onUpdate:modelValue":m[0]||(m[0]=d=>e.queryParams.startTime=d),type:"datetime",placeholder:"开始时间","value-format":"YYYY-MM-DD HH:mm:ss",shortcuts:h},null,8,["modelValue"])]),_:1}),t(b,{label:"结束时间"},{default:l(()=>[t(O,{modelValue:e.queryParams.endTime,"onUpdate:modelValue":m[1]||(m[1]=d=>e.queryParams.endTime=d),type:"datetime",placeholder:"结束时间","value-format":"YYYY-MM-DD HH:mm:ss",shortcuts:h},null,8,["modelValue"])]),_:1}),t(b,null,{default:l(()=>[t(I,null,{default:l(()=>[x((y(),P(T,{type:"primary",icon:"ele-Search",onClick:o},{default:l(()=>[w(" 查询 ")]),_:1})),[[L,"sysOplog:page"]]),t(T,{icon:"ele-Refresh",onClick:n},{default:l(()=>[w(" 重置 ")]),_:1})]),_:1})]),_:1}),t(b,null,{default:l(()=>[x((y(),P(T,{icon:"ele-DeleteFilled",type:"danger",onClick:r},{default:l(()=>[w(" 清空 ")]),_:1})),[[L,"sysOplog:clear"]]),x((y(),P(T,{icon:"ele-FolderOpened",onClick:i},{default:l(()=>[w(" 导出 ")]),_:1})),[[L,"sysOplog:export"]])]),_:1})]),_:1},8,["model"])]),_:1}),t(U,{class:"full-table",shadow:"hover",style:{"margin-top":"8px"}},{default:l(()=>[t(N,{data:e.logData,onSortChange:S,style:{width:"100%"},border:"","row-class-name":f},{default:l(()=>[t(p,{type:"index",label:"序号",width:"55",align:"center"}),t(p,{prop:"controllerName",label:"模块名称",width:"100","header-align":"center","show-overflow-tooltip":""}),t(p,{prop:"displayTitle",label:"显示名称",width:"170","header-align":"center","show-overflow-tooltip":""}),t(p,{prop:"actionName",label:"方法名称",width:"150","header-align":"center","show-overflow-tooltip":""}),t(p,{prop:"httpMethod",label:"请求方式",width:"90",align:"center","show-overflow-tooltip":""}),t(p,{prop:"requestUrl",label:"请求地址",width:"300","header-align":"center","show-overflow-tooltip":""}),t(p,{prop:"logLevel",label:"级别",width:"70",align:"center","show-overflow-tooltip":""},{default:l(d=>[d.row.logLevel===1?(y(),P(v,{key:0},{default:l(()=>[w("调试")]),_:1})):d.row.logLevel===2?(y(),P(v,{key:1},{default:l(()=>[w("消息")]),_:1})):d.row.logLevel===3?(y(),P(v,{key:2},{default:l(()=>[w("警告")]),_:1})):d.row.logLevel===4?(y(),P(v,{key:3},{default:l(()=>[w("错误")]),_:1})):(y(),P(v,{key:4},{default:l(()=>[w("其他")]),_:1}))]),_:1}),t(p,{prop:"eventId",label:"事件Id",width:"70",align:"center","show-overflow-tooltip":""}),t(p,{prop:"threadId",label:"线程Id",sortable:"custom",width:"90",align:"center","show-overflow-tooltip":""}),t(p,{prop:"traceId",label:"请求跟踪Id",width:"150","header-align":"center",sortable:"custom","show-overflow-tooltip":""}),t(p,{prop:"account",label:"账号名称",width:"100",align:"center","show-overflow-tooltip":""}),t(p,{prop:"realName",label:"真实姓名",width:"100",align:"center","show-overflow-tooltip":""}),t(p,{prop:"remoteIp",label:"IP地址",width:"120",align:"center","show-overflow-tooltip":""}),t(p,{prop:"location",label:"登录地点",width:"120",align:"center","show-overflow-tooltip":""}),t(p,{prop:"browser",label:"浏览器",width:"160",align:"center","show-overflow-tooltip":""}),t(p,{prop:"os",label:"操作系统",width:"120",align:"center","show-overflow-tooltip":""}),t(p,{prop:"status",label:"状态",width:"70",align:"center","show-overflow-tooltip":""},{default:l(d=>[d.row.status==="200"?(y(),P(v,{key:0,type:"success"},{default:l(()=>[w("成功")]),_:1})):(y(),P(v,{key:1,type:"danger"},{default:l(()=>[w("失败")]),_:1}))]),_:1}),t(p,{prop:"elapsed",label:"耗时(ms)",width:"90",align:"center","show-overflow-tooltip":""}),t(p,{prop:"logDateTime",label:"日志时间",width:"160",align:"center",fixed:"right","show-overflow-tooltip":""}),t(p,{label:"操作",width:"80",align:"center",fixed:"right","show-overflow-tooltip":""},{default:l(d=>[x((y(),P(T,{icon:"ele-InfoFilled",size:"small",text:"",type:"primary",onClick:pe=>_(d.row)},{default:l(()=>[w("详情 ")]),_:2},1032,["onClick"])),[[L,"sysOplog:page"]])]),_:1})]),_:1},8,["data"]),t(E,{currentPage:e.tableParams.page,"onUpdate:currentPage":m[2]||(m[2]=d=>e.tableParams.page=d),"page-size":e.tableParams.pageSize,"onUpdate:pageSize":m[3]||(m[3]=d=>e.tableParams.pageSize=d),total:e.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:c,onCurrentChange:g,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1}),t(H,{modelValue:e.dialogVisible,"onUpdate:modelValue":m[4]||(m[4]=d=>e.dialogVisible=d),draggable:"",width:"1000px"},{header:l(()=>[z("div",le,[t(Y,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:l(()=>[t(F)]),_:1}),re])]),default:l(()=>[z("pre",null,W(e.content),1)]),_:1},8,["modelValue"])])),[[M,e.loading]])}}}),ue=te(ie,[["__scopeId","data-v-654d6d62"]]);export{ue as default};

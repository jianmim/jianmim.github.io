import{_ as se}from"./editSysfile.vue_vue_type_script_setup_true_name_sysEditFile_lang-JykJEQ3j.js";import{d as re}from"./download-0Y1BJycW.js";import{g as k}from"./index-xdJ7pE-g.js";import{S as F}from"./sys-file-api-d-cf0cgU.js";import{k as B,r as q,L as de,p as ue,t as n,a6 as $,x as u,M as pe,D as e,A as l,B as g,y as c,S as s,T as x,O as y,G as fe,E as U,ai as me}from"./store-dof5ccn5.js";const ce={class:"sys-file-container"},_e={style:{color:"#fff"}},ge=y("span",null," 上传文件 ",-1),ye=y("div",{class:"el-upload__text"},[s("将文件拖到此处，或"),y("em",null,"点击上传")],-1),be=y("div",{class:"el-upload__tip"},"请上传大小不超过 10MB 的文件",-1),ve={class:"dialog-footer"},xe=B({name:"sysFile"}),Ue=B({...xe,setup(we){const L=q(),C=q(),a=de({loading:!1,fileData:[],queryParams:{fileName:void 0,startTime:void 0,endTime:void 0},tableParams:{page:1,pageSize:10,total:0},dialogUploadVisible:!1,diaglogEditFile:!1,fileList:[],dialogDocxVisible:!1,dialogXlsxVisible:!1,dialogPdfVisible:!1,showViewer:!1,docxUrl:"",excelUrl:"",pdfUrl:"",fileName:"",previewList:[]});ue(async()=>{p()});const p=async()=>{var P,f;a.queryParams.startTime==null&&(a.queryParams.startTime=void 0),a.queryParams.endTime==null&&(a.queryParams.endTime=void 0),a.loading=!0;let t=Object.assign(a.queryParams,a.tableParams);var i=await k(F).apiSysFilePagePost(t);a.fileData=((P=i.data.result)==null?void 0:P.items)??[],a.tableParams.total=(f=i.data.result)==null?void 0:f.total,a.loading=!1},M=()=>{a.queryParams.fileName=void 0,a.queryParams.startTime=void 0,a.queryParams.endTime=void 0,p()},Y=()=>{a.fileList=[],a.dialogUploadVisible=!0},E=(t,i)=>{a.fileList=i},j=async()=>{a.fileList.length<1||(await k(F).apiSysFileUploadFilePostForm(a.fileList[0].raw),p(),U.success("上传成功"),a.dialogUploadVisible=!1)},H=async t=>{var i=_(t);re({url:i})},R=t=>{me.confirm(`确定删除文件：【${t.fileName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await k(F).apiSysFileDeletePost({id:t.id}),p(),U.success("删除成功")}).catch(()=>{})},I=async t=>{t.suffix==".pdf"?(a.fileName=`【${t.fileName}${t.suffix}】`,a.pdfUrl=_(t),a.dialogPdfVisible=!0):t.suffix==".docx"?(a.fileName=`【${t.fileName}${t.suffix}】`,a.docxUrl=_(t),a.dialogDocxVisible=!0):t.suffix==".xlsx"?(a.fileName=`【${t.fileName}${t.suffix}】`,a.excelUrl=_(t),a.dialogXlsxVisible=!0):[".jpg",".png",".jpeg",".bmp"].findIndex(i=>i==t.suffix)>-1?(a.previewList=[_(t)],a.showViewer=!0):U.error("此文件格式不支持预览")},A=t=>{a.tableParams.pageSize=t,p()},Q=t=>{a.tableParams.page=t,p()},_=t=>t.bucketName=="Local"?`/${t.filePath}/${t.id}${t.suffix}`:t.url,O=t=>{var i;(i=C.value)==null||i.openDialog(t)};return(t,i)=>{const P=n("el-input"),f=n("el-form-item"),N=n("el-date-picker"),r=n("el-button"),X=n("el-button-group"),G=n("el-form"),T=n("el-card"),d=n("el-table-column"),w=n("el-tag"),K=n("el-image"),J=n("ele-InfoFilled"),m=n("el-icon"),b=n("el-text"),D=n("ele-UserFilled"),h=n("el-descriptions-item"),z=n("ele-Calendar"),W=n("ele-Tickets"),Z=n("el-descriptions"),ee=n("el-popover"),le=n("el-table"),ae=n("el-pagination"),S=n("ele-UploadFilled"),te=n("el-upload"),oe=n("el-dialog"),ie=n("el-image-viewer"),v=$("auth"),ne=$("loading");return u(),pe("div",ce,[e(T,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:l(()=>[e(G,{model:a.queryParams,ref:"queryForm",inline:!0},{default:l(()=>[e(f,{label:"文件名称",prop:"fileName"},{default:l(()=>[e(P,{modelValue:a.queryParams.fileName,"onUpdate:modelValue":i[0]||(i[0]=o=>a.queryParams.fileName=o),placeholder:"文件名称",clearable:""},null,8,["modelValue"])]),_:1}),e(f,{label:"开始时间",prop:"name"},{default:l(()=>[e(N,{modelValue:a.queryParams.startTime,"onUpdate:modelValue":i[1]||(i[1]=o=>a.queryParams.startTime=o),type:"datetime",placeholder:"开始时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(f,{label:"结束时间",prop:"code"},{default:l(()=>[e(N,{modelValue:a.queryParams.endTime,"onUpdate:modelValue":i[2]||(i[2]=o=>a.queryParams.endTime=o),type:"datetime",placeholder:"结束时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(X,null,{default:l(()=>[g((u(),c(r,{type:"primary",icon:"ele-Search",onClick:p},{default:l(()=>[s(" 查询 ")]),_:1})),[[v,"sysFile:page"]]),e(r,{icon:"ele-Refresh",onClick:M},{default:l(()=>[s(" 重置 ")]),_:1})]),_:1})]),_:1}),e(f,null,{default:l(()=>[g((u(),c(r,{type:"primary",icon:"ele-Plus",onClick:Y},{default:l(()=>[s(" 上传 ")]),_:1})),[[v,"sysFile:uploadFile"]])]),_:1})]),_:1},8,["model"])]),_:1}),e(T,{class:"full-table",shadow:"hover",style:{"margin-top":"8px"}},{default:l(()=>[g((u(),c(le,{data:a.fileData,style:{width:"100%"},border:""},{default:l(()=>[e(d,{type:"index",label:"序号",width:"55",align:"center"}),e(d,{prop:"fileName",label:"名称","min-width":"150","header-align":"center","show-overflow-tooltip":""}),e(d,{prop:"suffix",label:"后缀",align:"center","show-overflow-tooltip":""},{default:l(o=>[e(w,{round:""},{default:l(()=>[s(x(o.row.suffix),1)]),_:2},1024)]),_:1}),e(d,{prop:"sizeKb",label:"大小kb",align:"center","show-overflow-tooltip":""}),e(d,{prop:"url",label:"预览",align:"center"},{default:l(o=>[e(K,{style:{width:"60px",height:"60px"},src:_(o.row),alt:"无法预览",lazy:!0,"hide-on-click-modal":!0,"preview-src-list":[_(o.row)],"initial-index":0,fit:"scale-down","preview-teleported":""},{error:l(()=>[]),_:2},1032,["src","preview-src-list"])]),_:1}),e(d,{prop:"bucketName",label:"存储位置",align:"center","show-overflow-tooltip":""}),e(d,{prop:"id",label:"存储标识",align:"center","show-overflow-tooltip":""}),e(d,{label:"修改记录",width:"100",align:"center","show-overflow-tooltip":""},{default:l(o=>[e(ee,{placement:"bottom",width:"280",trigger:"hover"},{reference:l(()=>[e(b,{type:"primary"},{default:l(()=>[e(m,null,{default:l(()=>[e(J)]),_:1}),s("详情 ")]),_:1})]),default:l(()=>[e(Z,{direction:"vertical",column:2,border:""},{default:l(()=>[e(h,{width:"140"},{label:l(()=>[e(b,null,{default:l(()=>[e(m,null,{default:l(()=>[e(D)]),_:1}),s("创建者 ")]),_:1})]),default:l(()=>[e(w,null,{default:l(()=>[s(x(o.row.createUserName??"无"),1)]),_:2},1024)]),_:2},1024),e(h,null,{label:l(()=>[e(b,null,{default:l(()=>[e(m,null,{default:l(()=>[e(z)]),_:1}),s("创建时间 ")]),_:1})]),default:l(()=>[e(w,null,{default:l(()=>[s(x(o.row.createTime??"无"),1)]),_:2},1024)]),_:2},1024),e(h,null,{label:l(()=>[e(b,null,{default:l(()=>[e(m,null,{default:l(()=>[e(D)]),_:1}),s("修改者 ")]),_:1})]),default:l(()=>[e(w,null,{default:l(()=>[s(x(o.row.updateUserName??"无"),1)]),_:2},1024)]),_:2},1024),e(h,null,{label:l(()=>[e(b,null,{default:l(()=>[e(m,null,{default:l(()=>[e(z)]),_:1}),s("修改时间 ")]),_:1})]),default:l(()=>[e(w,null,{default:l(()=>[s(x(o.row.updateTime??"无"),1)]),_:2},1024)]),_:2},1024),e(h,null,{label:l(()=>[e(b,null,{default:l(()=>[e(m,null,{default:l(()=>[e(W)]),_:1}),s("备注 ")]),_:1})]),default:l(()=>[s(" "+x(o.row.remark),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),e(d,{label:"操作",width:"260",fixed:"right",align:"center","show-overflow-tooltip":""},{default:l(o=>[g((u(),c(r,{icon:"ele-View",size:"small",text:"",type:"primary",onClick:V=>I(o.row)},{default:l(()=>[s(" 预览 ")]),_:2},1032,["onClick"])),[[v,"sysFile:delete"]]),g((u(),c(r,{icon:"ele-Download",size:"small",text:"",type:"primary",onClick:V=>H(o.row)},{default:l(()=>[s(" 下载 ")]),_:2},1032,["onClick"])),[[v,"sysFile:downloadFile"]]),g((u(),c(r,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:V=>R(o.row)},{default:l(()=>[s(" 删除 ")]),_:2},1032,["onClick"])),[[v,"sysFile:delete"]]),g((u(),c(r,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:V=>O(o.row)},{default:l(()=>[s(" 编辑 ")]),_:2},1032,["onClick"])),[[v,"sysFile:update"]])]),_:1})]),_:1},8,["data"])),[[ne,a.loading]]),e(ae,{currentPage:a.tableParams.page,"onUpdate:currentPage":i[3]||(i[3]=o=>a.tableParams.page=o),"page-size":a.tableParams.pageSize,"onUpdate:pageSize":i[4]||(i[4]=o=>a.tableParams.pageSize=o),total:a.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:A,onCurrentChange:Q,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1}),e(oe,{modelValue:a.dialogUploadVisible,"onUpdate:modelValue":i[6]||(i[6]=o=>a.dialogUploadVisible=o),"lock-scroll":!1,draggable:"",width:"400px"},{header:l(()=>[y("div",_e,[e(m,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:l(()=>[e(S)]),_:1}),ge])]),footer:l(()=>[y("span",ve,[e(r,{onClick:i[5]||(i[5]=o=>a.dialogUploadVisible=!1)},{default:l(()=>[s("取消")]),_:1}),e(r,{type:"primary",onClick:j},{default:l(()=>[s("确定")]),_:1})])]),default:l(()=>[y("div",null,[e(te,{ref_key:"uploadRef",ref:L,drag:"","auto-upload":!1,limit:1,"file-list":a.fileList,action:"","on-change":E,accept:".jpg,.png,.bmp,.gif,.txt,.pdf,.xlsx,.docx"},{tip:l(()=>[be]),default:l(()=>[e(m,{class:"el-icon--upload"},{default:l(()=>[e(S)]),_:1}),ye]),_:1},8,["file-list"])])]),_:1},8,["modelValue"]),a.showViewer?(u(),c(ie,{key:0,"url-list":a.previewList,onClose:i[7]||(i[7]=o=>a.showViewer=!1)},null,8,["url-list"])):fe("",!0),e(se,{ref_key:"editSysFileRef",ref:C,title:"编辑文件",onHandleQuery:p},null,512)])}}});export{Ue as default};

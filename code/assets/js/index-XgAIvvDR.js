import{a as V}from"./authFunction-Sl3GZ0Ah.js";import ue from"./orgTree-guTnitiD.js";import{_ as ce}from"./editUser.vue_vue_type_script_setup_true_name_sysEditUser_lang-qGOWfOHT.js";import{g as b}from"./index-xdJ7pE-g.js";import{S as pe}from"./sys-org-api-Edv2nJUp.js";import{S as C}from"./sys-user-api-3kl3iOAw.js";import{k as E,r as B,L as _e,p as me,t as n,a6 as $,x as d,M as fe,D as e,A as t,B as P,y as _,S as r,T as g,F,ai as R,E as x}from"./store-dof5ccn5.js";import"./_plugin-vue_export-helper-x3n3nnut.js";import"./sys-pos-api-smmj_3k2.js";import"./sys-role-api-kfGN22Gz.js";const ge={class:"sys-user-container"},we=E({name:"sysUser"}),De=E({...we,setup(ye){const I=B(),T=B(),a=_e({loading:!1,userData:[],orgTreeData:[],queryParams:{orgId:-1,account:void 0,realName:void 0,phone:void 0},tableParams:{page:1,pageSize:20,total:0},editUserTitle:""});me(async()=>{A(),u()});const A=async()=>{a.loading=!0;var o=await b(pe).apiSysOrgListGet(0);a.orgTreeData=o.data.result??[],a.loading=!1},u=async()=>{var w,y;a.loading=!0;let o=Object.assign(a.queryParams,a.tableParams);var s=await b(C).apiSysUserPagePost(o);a.userData=((w=s.data.result)==null?void 0:w.items)??[],a.tableParams.total=(y=s.data.result)==null?void 0:y.total,a.loading=!1},M=()=>{a.queryParams.orgId=-1,a.queryParams.account=void 0,a.queryParams.realName=void 0,a.queryParams.phone=void 0,u()},O=()=>{var o;a.editUserTitle="添加账号",(o=T.value)==null||o.openDialog({id:void 0,birthday:"2000-01-01",sex:1,orderNo:100,cardType:0,cultureLevel:5})},L=o=>{var s;a.editUserTitle="编辑账号",(s=T.value)==null||s.openDialog(o)},Q=o=>{R.confirm(`确定删除账号：【${o.account}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await b(C).apiSysUserDeletePost({id:o.id}),u(),x.success("删除成功")}).catch(()=>{})},j=o=>{a.tableParams.pageSize=o,u()},G=o=>{a.tableParams.page=o,u()},H=o=>{b(C).apiSysUserSetStatusPost({id:o.id,status:o.status}).then(()=>{x.success("账号状态设置成功")}).catch(()=>{o.status=o.status==1?2:1})},J=async o=>{R.confirm(`确定重置密码：【${o.account}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await b(C).apiSysUserResetPwdPost({id:o.id}).then(s=>{x.success(`密码重置成功为：${s.data.result}`)})}).catch(()=>{})},K=async o=>{a.queryParams.orgId=o.id,a.queryParams.account=void 0,a.queryParams.realName=void 0,a.queryParams.phone=void 0,u()};return(o,s)=>{const w=n("el-col"),y=n("el-input"),U=n("el-form-item"),h=n("el-button"),W=n("el-button-group"),X=n("el-form"),S=n("el-card"),i=n("el-table-column"),Y=n("el-avatar"),c=n("el-tag"),Z=n("el-switch"),ee=n("ele-InfoFilled"),m=n("el-icon"),f=n("el-text"),D=n("ele-UserFilled"),v=n("el-descriptions-item"),q=n("ele-Calendar"),te=n("ele-Tickets"),ae=n("el-descriptions"),le=n("el-popover"),N=n("el-dropdown-item"),oe=n("el-dropdown-menu"),ne=n("el-dropdown"),re=n("el-table"),se=n("el-pagination"),ie=n("el-row"),k=$("auth"),de=$("loading");return d(),fe("div",ge,[e(ie,{gutter:8,style:{width:"100%"}},{default:t(()=>[e(w,{span:4,xs:24},{default:t(()=>[e(ue,{ref_key:"orgTreeRef",ref:I,onNodeClick:K},null,512)]),_:1}),e(w,{span:20,xs:24},{default:t(()=>[e(S,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:t(()=>[e(X,{model:a.queryParams,ref:"queryForm",inline:!0},{default:t(()=>[e(U,{label:"账号"},{default:t(()=>[e(y,{modelValue:a.queryParams.account,"onUpdate:modelValue":s[0]||(s[0]=l=>a.queryParams.account=l),placeholder:"账号",clearable:""},null,8,["modelValue"])]),_:1}),e(U,{label:"手机号码"},{default:t(()=>[e(y,{modelValue:a.queryParams.phone,"onUpdate:modelValue":s[1]||(s[1]=l=>a.queryParams.phone=l),placeholder:"手机号码",clearable:""},null,8,["modelValue"])]),_:1}),e(U,null,{default:t(()=>[e(W,null,{default:t(()=>[P((d(),_(h,{type:"primary",icon:"ele-Search",onClick:u},{default:t(()=>[r(" 查询 ")]),_:1})),[[k,"sysUser:page"]]),e(h,{icon:"ele-Refresh",onClick:M},{default:t(()=>[r(" 重置 ")]),_:1})]),_:1})]),_:1}),e(U,null,{default:t(()=>[P((d(),_(h,{type:"primary",icon:"ele-Plus",onClick:O},{default:t(()=>[r(" 新增 ")]),_:1})),[[k,"sysUser:add"]])]),_:1})]),_:1},8,["model"])]),_:1}),e(S,{class:"full-table",shadow:"hover",style:{"margin-top":"8px"}},{default:t(()=>[P((d(),_(re,{data:a.userData,style:{width:"100%"},border:""},{default:t(()=>[e(i,{type:"index",label:"序号",width:"55",align:"center",fixed:""}),e(i,{label:"头像",width:"80",align:"center","show-overflow-tooltip":""},{default:t(l=>[e(Y,{src:l.row.avatar,size:"small"},{default:t(()=>{var p,z;return[r(g(((p=l.row.nickName)==null?void 0:p.slice(0,1))??((z=l.row.realName)==null?void 0:z.slice(0,1))),1)]}),_:2},1032,["src"])]),_:1}),e(i,{prop:"account",label:"账号",width:"120",align:"center","show-overflow-tooltip":""}),e(i,{prop:"realName",label:"姓名",width:"120",align:"center","show-overflow-tooltip":""}),e(i,{prop:"phone",label:"手机号码",width:"120",align:"center","show-overflow-tooltip":""}),e(i,{label:"账号类型",width:"110",align:"center","show-overflow-tooltip":""},{default:t(l=>[l.row.accountType===888?(d(),_(c,{key:0},{default:t(()=>[r(" 系统管理员 ")]),_:1})):l.row.accountType===777?(d(),_(c,{key:1},{default:t(()=>[r(" 普通账号 ")]),_:1})):l.row.accountType===666?(d(),_(c,{key:2},{default:t(()=>[r(" 会员 ")]),_:1})):(d(),_(c,{key:3},{default:t(()=>[r(" 其他 ")]),_:1}))]),_:1}),e(i,{prop:"roleName",label:"角色集合","min-width":"130",align:"center","show-overflow-tooltip":""}),e(i,{prop:"orgName",label:"所属机构","min-width":"120",align:"center","show-overflow-tooltip":""}),e(i,{prop:"posName",label:"职位名称","min-width":"120",align:"center","show-overflow-tooltip":""}),e(i,{label:"状态",width:"70",align:"center","show-overflow-tooltip":""},{default:t(l=>[P(e(Z,{modelValue:l.row.status,"onUpdate:modelValue":p=>l.row.status=p,"active-value":1,"inactive-value":2,size:"small",onChange:p=>H(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),[[k,"sysUser:setStatus"]])]),_:1}),e(i,{prop:"orderNo",label:"排序",width:"70",align:"center","show-overflow-tooltip":""}),e(i,{label:"修改记录",width:"100",align:"center","show-overflow-tooltip":""},{default:t(l=>[e(le,{placement:"bottom",width:"280",trigger:"hover"},{reference:t(()=>[e(f,{type:"primary"},{default:t(()=>[e(m,null,{default:t(()=>[e(ee)]),_:1}),r("详情 ")]),_:1})]),default:t(()=>[e(ae,{direction:"vertical",column:2,border:""},{default:t(()=>[e(v,{width:"140"},{label:t(()=>[e(f,null,{default:t(()=>[e(m,null,{default:t(()=>[e(D)]),_:1}),r("创建者 ")]),_:1})]),default:t(()=>[e(c,null,{default:t(()=>[r(g(l.row.createUserName??"无"),1)]),_:2},1024)]),_:2},1024),e(v,null,{label:t(()=>[e(f,null,{default:t(()=>[e(m,null,{default:t(()=>[e(q)]),_:1}),r("创建时间 ")]),_:1})]),default:t(()=>[e(c,null,{default:t(()=>[r(g(l.row.createTime??"无"),1)]),_:2},1024)]),_:2},1024),e(v,null,{label:t(()=>[e(f,null,{default:t(()=>[e(m,null,{default:t(()=>[e(D)]),_:1}),r("修改者 ")]),_:1})]),default:t(()=>[e(c,null,{default:t(()=>[r(g(l.row.updateUserName??"无"),1)]),_:2},1024)]),_:2},1024),e(v,null,{label:t(()=>[e(f,null,{default:t(()=>[e(m,null,{default:t(()=>[e(q)]),_:1}),r("修改时间 ")]),_:1})]),default:t(()=>[e(c,null,{default:t(()=>[r(g(l.row.updateTime??"无"),1)]),_:2},1024)]),_:2},1024),e(v,null,{label:t(()=>[e(f,null,{default:t(()=>[e(m,null,{default:t(()=>[e(te)]),_:1}),r("备注 ")]),_:1})]),default:t(()=>[r(" "+g(l.row.remark),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),e(i,{label:"操作",width:"110",align:"center",fixed:"right","show-overflow-tooltip":""},{default:t(l=>[P((d(),_(h,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:p=>L(l.row)},{default:t(()=>[r(" 编辑 ")]),_:2},1032,["onClick"])),[[k,"sysUser:update"]]),e(ne,null,{dropdown:t(()=>[e(oe,null,{default:t(()=>[e(N,{icon:"ele-RefreshLeft",onClick:p=>J(l.row),disabled:!F(V)("sysUser:resetPwd")},{default:t(()=>[r(" 重置密码 ")]),_:2},1032,["onClick","disabled"]),e(N,{icon:"ele-Delete",onClick:p=>Q(l.row),divided:"",disabled:!F(V)("sysUser:delete")},{default:t(()=>[r(" 删除账号 ")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),default:t(()=>[e(h,{icon:"ele-MoreFilled",size:"small",text:"",type:"primary",style:{"padding-left":"12px"}})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[de,a.loading]]),e(se,{currentPage:a.tableParams.page,"onUpdate:currentPage":s[2]||(s[2]=l=>a.tableParams.page=l),"page-size":a.tableParams.pageSize,"onUpdate:pageSize":s[3]||(s[3]=l=>a.tableParams.pageSize=l),total:a.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:j,onCurrentChange:G,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1})]),_:1})]),_:1}),e(ce,{ref_key:"editUserRef",ref:T,title:a.editUserTitle,orgData:a.orgTreeData,onHandleQuery:u},null,8,["title","orgData"])])}}});export{De as default};

import{_ as oe}from"./editTenant.vue_vue_type_script_setup_true_name_sysEditTenant_lang--2gRNbAQ.js";import re from"./grantMenu-qFrKpXSQ.js";import{g as T}from"./index-zQlakb1H.js";import{S as v}from"./sys-tenant-api-I9_VUfg0.js";import{k as N,r as $,L as de,p as ie,t as d,a6 as U,x as r,M as se,D as t,A as e,B as k,y as i,S as l,G as g,T as P,ai as z,E as S}from"./store-dof5ccn5.js";import"./_plugin-vue_export-helper-x3n3nnut.js";const ue={class:"sys-tenant-container"},ce=N({name:"sysTenant"}),be=N({...ce,setup(_e){const x=$(),B=$(),o=de({loading:!1,tenantData:[],queryParams:{name:void 0,phone:void 0},tableParams:{page:1,pageSize:10,total:0},editTenantTitle:""});ie(async()=>{_()});const _=async()=>{var b,p;o.loading=!0;let n=Object.assign(o.queryParams,o.tableParams);var u=await T(v).apiSysTenantPagePost(n);o.tenantData=((b=u.data.result)==null?void 0:b.items)??[],o.tableParams.total=(p=u.data.result)==null?void 0:p.total,o.loading=!1},R=()=>{o.queryParams.name=void 0,o.queryParams.phone=void 0,_()},A=()=>{var n;o.editTenantTitle="添加租户",(n=x.value)==null||n.openDialog({tenantType:0,orderNo:100})},E=n=>{var u;o.editTenantTitle="编辑租户",(u=x.value)==null||u.openDialog(n)},F=async n=>{var u;(u=B.value)==null||u.openDialog(n)},G=async n=>{z.confirm(`确定重置密码：【${n.name}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await T(v).apiSysTenantResetPwdPost({userId:n.userId}).then(u=>{S.success(`密码重置成功为：${u.data.result}`)})}).catch(()=>{})},I=n=>{z.confirm(`确定删除租户：【${n.name}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await T(v).apiSysTenantDeletePost({id:n.id}),_(),S.success("删除成功")}).catch(()=>{})},O=n=>{o.tableParams.pageSize=n,_()},Q=n=>{o.tableParams.page=n,_()},H=n=>{z.confirm(`确定创建/更新租户数据库：【${n.name}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await T(v).apiSysTenantCreateDbPost({id:n.id}),S.success("创建/更新租户数据库成功")}).catch(()=>{})},L=n=>{T(v).apiSysTenantSetStatusPost({id:n.id,status:n.status}).then(()=>{S.success("租户状态设置成功")}).catch(()=>{n.status=n.status==1?2:1})};return(n,u)=>{const b=d("el-input"),p=d("el-form-item"),f=d("el-button"),j=d("el-button-group"),K=d("el-form"),q=d("el-card"),c=d("el-table-column"),s=d("el-tag"),J=d("el-switch"),W=d("ele-InfoFilled"),y=d("el-icon"),w=d("el-text"),V=d("ele-UserFilled"),h=d("el-descriptions-item"),M=d("ele-Calendar"),X=d("ele-Tickets"),Y=d("el-descriptions"),Z=d("el-popover"),D=d("el-dropdown-item"),ee=d("el-dropdown-menu"),te=d("el-dropdown"),ae=d("el-table"),le=d("el-pagination"),C=U("auth"),ne=U("loading");return r(),se("div",ue,[t(q,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:e(()=>[t(K,{model:o.queryParams,ref:"queryForm",inline:!0},{default:e(()=>[t(p,{label:"租户名称"},{default:e(()=>[t(b,{modelValue:o.queryParams.name,"onUpdate:modelValue":u[0]||(u[0]=a=>o.queryParams.name=a),placeholder:"租户名称",clearable:""},null,8,["modelValue"])]),_:1}),t(p,{label:"联系电话"},{default:e(()=>[t(b,{modelValue:o.queryParams.phone,"onUpdate:modelValue":u[1]||(u[1]=a=>o.queryParams.phone=a),placeholder:"联系电话",clearable:""},null,8,["modelValue"])]),_:1}),t(p,null,{default:e(()=>[t(j,null,{default:e(()=>[k((r(),i(f,{type:"primary",icon:"ele-Search",onClick:_},{default:e(()=>[l(" 查询 ")]),_:1})),[[C,"sysTenant:page"]]),t(f,{icon:"ele-Refresh",onClick:R},{default:e(()=>[l(" 重置 ")]),_:1})]),_:1})]),_:1}),t(p,null,{default:e(()=>[k((r(),i(f,{type:"primary",icon:"ele-Plus",onClick:A},{default:e(()=>[l(" 新增 ")]),_:1})),[[C,"sysTenant:add"]])]),_:1})]),_:1},8,["model"])]),_:1}),t(q,{class:"full-table",shadow:"hover",style:{"margin-top":"8px"}},{default:e(()=>[k((r(),i(ae,{data:o.tenantData,style:{width:"100%"},border:""},{default:e(()=>[t(c,{type:"index",label:"序号",width:"55",align:"center",fixed:""}),t(c,{prop:"name",label:"租户名称",width:"160",align:"center","show-overflow-tooltip":""}),t(c,{prop:"adminAccount",label:"租管账号",align:"center",width:"120","show-overflow-tooltip":""}),t(c,{prop:"phone",label:"电话",width:"120",align:"center","show-overflow-tooltip":""}),t(c,{prop:"tenantType",label:"租户类型",width:"100",align:"center","show-overflow-tooltip":""},{default:e(a=>[a.row.tenantType===0?(r(),i(s,{key:0},{default:e(()=>[l(" ID隔离 ")]),_:1})):(r(),i(s,{key:1,type:"danger"},{default:e(()=>[l(" 库隔离 ")]),_:1}))]),_:1}),t(c,{label:"状态",width:"70",align:"center","show-overflow-tooltip":""},{default:e(a=>[t(J,{modelValue:a.row.status,"onUpdate:modelValue":m=>a.row.status=m,"active-value":1,"inactive-value":2,size:"small",onChange:m=>L(a.row),disabled:a.row.id==12345678e7},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),t(c,{prop:"dbType",label:"数据库类型",width:"120",align:"center","show-overflow-tooltip":""},{default:e(a=>[a.row.dbType===0?(r(),i(s,{key:0},{default:e(()=>[l(" MySql ")]),_:1})):a.row.dbType===1?(r(),i(s,{key:1},{default:e(()=>[l(" SqlServer ")]),_:1})):g("",!0),a.row.dbType===2?(r(),i(s,{key:2},{default:e(()=>[l(" Sqlite ")]),_:1})):a.row.dbType===3?(r(),i(s,{key:3},{default:e(()=>[l(" Oracle ")]),_:1})):g("",!0),a.row.dbType===4?(r(),i(s,{key:4},{default:e(()=>[l(" PostgreSQL ")]),_:1})):a.row.dbType===5?(r(),i(s,{key:5},{default:e(()=>[l(" Dm ")]),_:1})):g("",!0),a.row.dbType===6?(r(),i(s,{key:6},{default:e(()=>[l(" Kdbndp ")]),_:1})):a.row.dbType===7?(r(),i(s,{key:7},{default:e(()=>[l(" Oscar ")]),_:1})):g("",!0),a.row.dbType===8?(r(),i(s,{key:8},{default:e(()=>[l(" MySqlConnector ")]),_:1})):a.row.dbType===9?(r(),i(s,{key:9},{default:e(()=>[l(" Access ")]),_:1})):g("",!0),a.row.dbType===10?(r(),i(s,{key:10},{default:e(()=>[l(" OpenGauss ")]),_:1})):a.row.dbType===11?(r(),i(s,{key:11},{default:e(()=>[l(" QuestDB ")]),_:1})):a.row.dbType===12?(r(),i(s,{key:12},{default:e(()=>[l(" HG ")]),_:1})):a.row.dbType===13?(r(),i(s,{key:13},{default:e(()=>[l(" ClickHouse ")]),_:1})):a.row.dbType===14?(r(),i(s,{key:14},{default:e(()=>[l(" GBase ")]),_:1})):a.row.dbType===900?(r(),i(s,{key:15},{default:e(()=>[l(" Custom ")]),_:1})):g("",!0)]),_:1}),t(c,{prop:"connection",label:"数据库连接","min-width":"300","header-align":"center","show-overflow-tooltip":""}),t(c,{prop:"slaveConnections",label:"从库连接","min-width":"300","header-align":"center","show-overflow-tooltip":""}),t(c,{prop:"orderNo",label:"排序",width:"70",align:"center","show-overflow-tooltip":""}),t(c,{label:"修改记录",width:"100",align:"center","show-overflow-tooltip":""},{default:e(a=>[t(Z,{placement:"bottom",width:"280",trigger:"hover"},{reference:e(()=>[t(w,{type:"primary"},{default:e(()=>[t(y,null,{default:e(()=>[t(W)]),_:1}),l("详情 ")]),_:1})]),default:e(()=>[t(Y,{direction:"vertical",column:2,border:""},{default:e(()=>[t(h,{width:"140"},{label:e(()=>[t(w,null,{default:e(()=>[t(y,null,{default:e(()=>[t(V)]),_:1}),l("创建者 ")]),_:1})]),default:e(()=>[t(s,null,{default:e(()=>[l(P(a.row.createUserName??"无"),1)]),_:2},1024)]),_:2},1024),t(h,null,{label:e(()=>[t(w,null,{default:e(()=>[t(y,null,{default:e(()=>[t(M)]),_:1}),l("创建时间 ")]),_:1})]),default:e(()=>[t(s,null,{default:e(()=>[l(P(a.row.createTime??"无"),1)]),_:2},1024)]),_:2},1024),t(h,null,{label:e(()=>[t(w,null,{default:e(()=>[t(y,null,{default:e(()=>[t(V)]),_:1}),l("修改者 ")]),_:1})]),default:e(()=>[t(s,null,{default:e(()=>[l(P(a.row.updateUserName??"无"),1)]),_:2},1024)]),_:2},1024),t(h,null,{label:e(()=>[t(w,null,{default:e(()=>[t(y,null,{default:e(()=>[t(M)]),_:1}),l("修改时间 ")]),_:1})]),default:e(()=>[t(s,null,{default:e(()=>[l(P(a.row.updateTime??"无"),1)]),_:2},1024)]),_:2},1024),t(h,null,{label:e(()=>[t(w,null,{default:e(()=>[t(y,null,{default:e(()=>[t(X)]),_:1}),l("备注 ")]),_:1})]),default:e(()=>[l(" "+P(a.row.remark),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),t(c,{label:"操作",width:"180",fixed:"right",align:"center","show-overflow-tooltip":""},{default:e(a=>[k((r(),i(f,{icon:"ele-Coin",size:"small",text:"",type:"danger",onClick:m=>H(a.row),disabled:a.row.tenantType==0},{default:e(()=>[l(" 创建库 ")]),_:2},1032,["onClick","disabled"])),[[C,"sysTenant:createDb"]]),k((r(),i(f,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:m=>E(a.row)},{default:e(()=>[l(" 编辑 ")]),_:2},1032,["onClick"])),[[C,"sysTenant:update"]]),t(te,null,{dropdown:e(()=>[t(ee,null,{default:e(()=>[t(D,{icon:"ele-OfficeBuilding",onClick:m=>F(a.row),"v-auth":"sysTenant:grantMenu"},{default:e(()=>[l(" 授权菜单 ")]),_:2},1032,["onClick"]),t(D,{icon:"ele-RefreshLeft",onClick:m=>G(a.row),"v-auth":"sysTenant:resetPwd"},{default:e(()=>[l(" 重置密码 ")]),_:2},1032,["onClick"]),t(D,{icon:"ele-Delete",onClick:m=>I(a.row),"v-auth":"sysTenant:delete"},{default:e(()=>[l(" 删除租户 ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:e(()=>[t(f,{icon:"ele-MoreFilled",size:"small",text:"",type:"primary",style:{"padding-left":"12px"}})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ne,o.loading]]),t(le,{currentPage:o.tableParams.page,"onUpdate:currentPage":u[2]||(u[2]=a=>o.tableParams.page=a),"page-size":o.tableParams.pageSize,"onUpdate:pageSize":u[3]||(u[3]=a=>o.tableParams.pageSize=a),total:o.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:O,onCurrentChange:Q,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1}),t(oe,{ref_key:"editTenantRef",ref:x,title:o.editTenantTitle,onHandleQuery:_},null,8,["title"]),t(re,{ref_key:"grantMenuRef",ref:B},null,512)])}}});export{be as default};

import{_ as K}from"./editTable.vue_vue_type_script_setup_true_name_sysEditTable_lang-hr4zljtC.js";import{_ as O}from"./editColumn.vue_vue_type_script_setup_true_name_sysEditColumn_lang-H79QZa-c.js";import{_ as W}from"./addTable.vue_vue_type_script_setup_true_name_sysAddTable_lang-OkeLpaPg.js";import{_ as X}from"./addColumn.vue_vue_type_script_setup_true_name_sysAddColumn_lang-cfk-NbOp.js";import{_ as Y}from"./genEntity.vue_vue_type_script_setup_true_name_sysGenEntity_lang-BuO9jBbi.js";import{_ as Z}from"./genSeedData.vue_vue_type_script_setup_true_name_sysGenEntity_lang-nQStyZF2.js";import{g as f}from"./index-xdJ7pE-g.js";import{S as ee}from"./sys-code-gen-api-JhrPjZzh.js";import{S as y}from"./sys-database-api-YLh-8THg.js";import{k as V,r as b,L as ae,p as le,t as c,a6 as te,x as s,M as w,D as a,A as t,B as P,y as d,a4 as B,a5 as E,S as i,E as D,ai as $}from"./store-dof5ccn5.js";import"./database-zhWWLKxD.js";const oe={class:"sys-database-container"},ne=V({name:"sysDatabase"}),ye=V({...ne,setup(ie){const C=b(),h=b(),I=b(),k=b(),T=b(),S=b(),e=ae({loading:!1,loading1:!1,dbData:[],configId:"",tableData:[],tableName:"",columnData:[],queryParams:{name:void 0,code:void 0},editPosTitle:"",appNamespaces:[]});le(async()=>{e.loading=!0;var l=await f(y).apiSysDatabaseListGet();e.dbData=l.data.result,e.loading=!1;let o=await f(ee).apiSysCodeGenApplicationNamespacesGet();e.appNamespaces=o.data.result});const A=l=>{_(),e.tableName=l,g()},_=async()=>{e.tableName="",e.columnData=[],e.loading=!0;var l=await f(y).apiSysDatabaseTableListConfigIdGet(e.configId);e.tableData=l.data.result??[],e.loading=!1},g=async()=>{if(e.columnData=[],e.tableName!=""){e.loading1=!0;var l=await f(y).apiSysDatabaseColumnListTableNameConfigIdGet(e.tableName,e.configId);e.columnData=l.data.result??[],e.loading1=!1}},G=()=>{var m;if(!(e.configId==""||e.tableName=="")){var l=e.tableData.filter(N=>N.name==e.tableName),o={configId:e.configId,tableName:e.tableName,oldTableName:e.tableName,description:l[0].description};(m=C.value)==null||m.openDialog(o)}},Q=()=>{var o;if(!(e.configId==""||e.tableName=="")){var l={configId:e.configId,tableName:e.tableName,position:e.appNamespaces[0]};(o=T.value)==null||o.openDialog(l)}},L=()=>{var o;if(!(e.configId==""||e.tableName=="")){var l={configId:e.configId,tableName:e.tableName,position:e.appNamespaces[0]};(o=S.value)==null||o.openDialog(l)}},H=()=>{var o;if(e.configId==""){D({type:"error",message:"请选择库名!"});return}var l={configId:e.configId,tableName:"",oldTableName:"",description:""};(o=I.value)==null||o.openDialog(l)},M=l=>{var m;var o={configId:e.configId,tableName:l.tableName,columnName:l.dbColumnName,oldColumnName:l.dbColumnName,description:l.columnDescription};(m=h.value)==null||m.openDialog(o)},q=()=>{var o;if(e.configId==""||e.tableName==""){D({type:"error",message:"请选择库名和表名!"});return}const l={configId:e.configId,tableName:e.tableName,columnDescription:"",dataType:"",dbColumnName:"",decimalDigits:0,isIdentity:0,isNullable:0,isPrimarykey:0,length:0};(o=k.value)==null||o.openDialog(l)},z=()=>{$.confirm(`确定删除表：【${e.tableName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const l={configId:e.configId,tableName:e.tableName};await f(y).apiSysDatabaseDeleteTablePost(l),_(),D.success("表删除成功")}).catch(()=>{})},F=l=>{$.confirm(`确定删除列：【${l.dbColumnName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const o={configId:e.configId,tableName:e.tableName,dbColumnName:l.dbColumnName};await f(y).apiSysDatabaseDeleteColumnPost(o),_(),D.success("列删除成功")}).catch(()=>{})};return(l,o)=>{const m=c("el-option"),N=c("el-select"),v=c("el-form-item"),p=c("el-button"),U=c("el-form"),x=c("el-card"),r=c("el-table-column"),u=c("el-tag"),j=c("el-table"),R=te("loading");return s(),w("div",oe,[a(x,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:t(()=>[P((s(),d(U,{model:e.queryParams,ref:"queryForm",inline:!0},{default:t(()=>[a(v,{label:"库名"},{default:t(()=>[a(N,{modelValue:e.configId,"onUpdate:modelValue":o[0]||(o[0]=n=>e.configId=n),placeholder:"库名",filterable:"",onChange:_},{default:t(()=>[(s(!0),w(B,null,E(e.dbData,n=>(s(),d(m,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"表名"},{default:t(()=>[a(N,{modelValue:e.tableName,"onUpdate:modelValue":o[1]||(o[1]=n=>e.tableName=n),placeholder:"表名",filterable:"",clearable:"",onChange:g},{default:t(()=>[(s(!0),w(B,null,E(e.tableData,n=>(s(),d(m,{key:n.name,label:n.name+"["+n.description+"]",value:n.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,null,{default:t(()=>[a(p,{icon:"ele-Edit",type:"primary",onClick:G},{default:t(()=>[i(" 编辑表 ")]),_:1}),a(p,{icon:"ele-Delete",type:"danger",onClick:z},{default:t(()=>[i(" 删除表 ")]),_:1}),a(p,{icon:"ele-Plus",onClick:H},{default:t(()=>[i(" 增加表 ")]),_:1}),a(p,{icon:"ele-Plus",onClick:q},{default:t(()=>[i(" 增加列 ")]),_:1}),a(p,{icon:"ele-Plus",onClick:Q},{default:t(()=>[i(" 生成实体 ")]),_:1}),a(p,{icon:"ele-Plus",onClick:L},{default:t(()=>[i(" 生成种子数据 ")]),_:1})]),_:1})]),_:1},8,["model"])),[[R,e.loading]])]),_:1}),a(x,{class:"full-table",shadow:"hover",style:{"margin-top":"8px"}},{default:t(()=>[P((s(),d(j,{data:e.columnData,style:{width:"100%"},border:""},{default:t(()=>[a(r,{type:"index",label:"序号",width:"55",align:"center"}),a(r,{prop:"dbColumnName",label:"字段名",align:"center","show-overflow-tooltip":""}),a(r,{prop:"dataType",label:"数据类型",align:"center","show-overflow-tooltip":""}),a(r,{prop:"isPrimarykey",label:"主键",width:"70",align:"center","show-overflow-tooltip":""},{default:t(n=>[n.row.isPrimarykey===!0?(s(),d(u,{key:0,type:"success"},{default:t(()=>[i("是")]),_:1})):(s(),d(u,{key:1,type:"info"},{default:t(()=>[i("否")]),_:1}))]),_:1}),a(r,{prop:"isIdentity",label:"自增",width:"70",align:"center","show-overflow-tooltip":""},{default:t(n=>[n.row.isIdentity===!0?(s(),d(u,{key:0,type:"success"},{default:t(()=>[i("是")]),_:1})):(s(),d(u,{key:1,type:"info"},{default:t(()=>[i("否")]),_:1}))]),_:1}),a(r,{prop:"isNullable",label:"可空",width:"70",align:"center","show-overflow-tooltip":""},{default:t(n=>[n.row.isNullable===!0?(s(),d(u,{key:0},{default:t(()=>[i("是")]),_:1})):(s(),d(u,{key:1,type:"info"},{default:t(()=>[i("否")]),_:1}))]),_:1}),a(r,{prop:"length",label:"长度",width:"70",align:"center","show-overflow-tooltip":""}),a(r,{prop:"decimalDigits",label:"精度",width:"70",align:"center","show-overflow-tooltip":""}),a(r,{prop:"defaultValue",label:"默认值",align:"center","show-overflow-tooltip":""}),a(r,{prop:"columnDescription",label:"描述","header-align":"center","show-overflow-tooltip":""}),a(r,{label:"操作",width:"140",fixed:"right",align:"center","show-overflow-tooltip":""},{default:t(n=>[a(p,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:J=>M(n.row)},{default:t(()=>[i(" 编辑 ")]),_:2},1032,["onClick"]),a(p,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:J=>F(n.row)},{default:t(()=>[i(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,e.loading1]])]),_:1}),a(K,{ref_key:"editTableRef",ref:C,onHandleQueryTable:_},null,512),a(O,{ref_key:"editColumnRef",ref:h,onHandleQueryColumn:g},null,512),a(W,{ref_key:"addTableRef",ref:I,onAddTableSubmitted:A},null,512),a(X,{ref_key:"addColumnRef",ref:k,onHandleQueryColumn:g},null,512),a(Y,{ref_key:"genEntityRef",ref:T,onHandleQueryColumn:g,"application-namespaces":e.appNamespaces},null,8,["application-namespaces"]),a(Z,{ref_key:"genSeedDataRef",ref:S,"application-namespaces":e.appNamespaces},null,8,["application-namespaces"])])}}});export{ye as default};

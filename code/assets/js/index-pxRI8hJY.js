import{B as R,d as v,g as T}from"./index-xdJ7pE-g.js";import{b as L,k as V,L as Y,p as j,t as h,a6 as k,x as P,M as H,D as t,A as p,B as _,y as b,S as w,E as M}from"./store-dof5ccn5.js";import{_ as F}from"./_plugin-vue_export-helper-x3n3nnut.js";const q=function(o){return{apiSysLogDiffClearPost:async(e={})=>{const a="/api/sysLogDiff/clear",n=new URL(a,"https://example.com");let r;o&&(r=o.baseOptions);const c={method:"POST",...r,...e},m={},f={};if(o&&o.accessToken){const i=typeof o.accessToken=="function"?await o.accessToken():await o.accessToken;m.Authorization="Bearer "+i}const s=new URLSearchParams(n.search);for(const i in f)s.set(i,f[i]);for(const i in e.params)s.set(i,e.params[i]);n.search=new URLSearchParams(s).toString();let l=r&&r.headers?r.headers:{};return c.headers={...m,...l,...e.headers},{url:n.pathname+n.search+n.hash,options:c}},apiSysLogDiffPagePost:async(e,a={})=>{const n="/api/sysLogDiff/page",r=new URL(n,"https://example.com");let c;o&&(c=o.baseOptions);const m={method:"POST",...c,...a},f={},s={};if(o&&o.accessToken){const d=typeof o.accessToken=="function"?await o.accessToken():await o.accessToken;f.Authorization="Bearer "+d}f["Content-Type"]="application/json-patch+json";const l=new URLSearchParams(r.search);for(const d in s)l.set(d,s[d]);for(const d in a.params)l.set(d,a.params[d]);r.search=new URLSearchParams(l).toString();let i=c&&c.headers?c.headers:{};m.headers={...f,...i,...a.headers};const g=typeof e!="string"||m.headers["Content-Type"]==="application/json";return m.data=g?JSON.stringify(e!==void 0?e:{}):e||"",{url:r.pathname+r.search+r.hash,options:m}}}},x=function(o){return{async apiSysLogDiffClearPost(e){const a=await q(o).apiSysLogDiffClearPost(e);return(n=L,r=v)=>{const c={...a.options,url:r+a.url};return n.request(c)}},async apiSysLogDiffPagePost(e,a){const n=await q(o).apiSysLogDiffPagePost(e,a);return(r=L,c=v)=>{const m={...n.options,url:c+n.url};return r.request(m)}}}};class C extends R{async apiSysLogDiffClearPost(e){return x(this.configuration).apiSysLogDiffClearPost(e).then(a=>a(this.axios,this.basePath))}async apiSysLogDiffPagePost(e,a){return x(this.configuration).apiSysLogDiffPagePost(e,a).then(n=>n(this.axios,this.basePath))}}const E={class:"sys-difflog-container"},Q=V({name:"sysDiffLog"}),I=V({...Q,setup(o){const e=Y({loading:!1,queryParams:{startTime:void 0,endTime:void 0},tableParams:{page:1,pageSize:10,total:0},logData:[]});j(async()=>{a()});const a=async()=>{var i,g;e.queryParams.startTime==null&&(e.queryParams.startTime=void 0),e.queryParams.endTime==null&&(e.queryParams.endTime=void 0),e.loading=!0;let s=Object.assign(e.queryParams,e.tableParams);var l=await T(C).apiSysLogDiffPagePost(s);e.logData=((i=l.data.result)==null?void 0:i.items)??[],e.tableParams.total=(g=l.data.result)==null?void 0:g.total,e.loading=!1},n=()=>{e.queryParams.startTime=void 0,e.queryParams.endTime=void 0,a()},r=async()=>{e.loading=!0,await T(C).apiSysLogDiffClearPost(),e.loading=!1,M.success("清空成功"),a()},c=s=>{e.tableParams.pageSize=s,a()},m=s=>{e.tableParams.page=s,a()},f=[{text:"今天",value:new Date},{text:"昨天",value:()=>{const s=new Date;return s.setTime(s.getTime()-3600*1e3*24),s}},{text:"上周",value:()=>{const s=new Date;return s.setTime(s.getTime()-3600*1e3*24*7),s}}];return(s,l)=>{const i=h("el-date-picker"),g=h("el-form-item"),d=h("el-button"),A=h("el-button-group"),z=h("el-form"),D=h("el-card"),u=h("el-table-column"),O=h("el-table"),B=h("el-pagination"),S=k("auth"),U=k("loading");return P(),H("div",E,[t(D,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:p(()=>[t(z,{model:e.queryParams,ref:"queryForm",inline:!0},{default:p(()=>[t(g,{label:"开始时间"},{default:p(()=>[t(i,{modelValue:e.queryParams.startTime,"onUpdate:modelValue":l[0]||(l[0]=y=>e.queryParams.startTime=y),type:"datetime",placeholder:"开始时间","value-format":"YYYY-MM-DD HH:mm:ss",shortcuts:f},null,8,["modelValue"])]),_:1}),t(g,{label:"结束时间"},{default:p(()=>[t(i,{modelValue:e.queryParams.endTime,"onUpdate:modelValue":l[1]||(l[1]=y=>e.queryParams.endTime=y),type:"datetime",placeholder:"结束时间","value-format":"YYYY-MM-DD HH:mm:ss",shortcuts:f},null,8,["modelValue"])]),_:1}),t(g,null,{default:p(()=>[t(A,null,{default:p(()=>[_((P(),b(d,{type:"primary",icon:"ele-Search",onClick:a},{default:p(()=>[w(" 查询 ")]),_:1})),[[S,"sysDifflog:page"]]),t(d,{icon:"ele-Refresh",onClick:n},{default:p(()=>[w(" 重置 ")]),_:1})]),_:1})]),_:1}),t(g,null,{default:p(()=>[_((P(),b(d,{icon:"ele-DeleteFilled",type:"danger",onClick:r},{default:p(()=>[w(" 清空 ")]),_:1})),[[S,"sysDifflog:clear"]])]),_:1})]),_:1},8,["model"])]),_:1}),t(D,{class:"full-table",shadow:"hover",style:{"margin-top":"8px"}},{default:p(()=>[_((P(),b(O,{data:e.logData,style:{width:"100%"},border:""},{default:p(()=>[t(u,{type:"index",label:"序号",width:"55",align:"center"}),t(u,{prop:"diffType",label:"差异操作","header-align":"center","show-overflow-tooltip":""}),t(u,{prop:"sql",label:"Sql语句","header-align":"center","show-overflow-tooltip":""}),t(u,{prop:"parameters",label:"参数","header-align":"center","show-overflow-tooltip":""}),t(u,{prop:"elapsed",label:"耗时(ms)","header-align":"center","show-overflow-tooltip":""}),t(u,{prop:"message",label:"日志消息","header-align":"center","show-overflow-tooltip":""}),t(u,{prop:"beforeData",label:"操作前记录","header-align":"center","show-overflow-tooltip":""}),t(u,{prop:"afterData",label:"操作后记录","header-align":"center","show-overflow-tooltip":""}),t(u,{prop:"businessData",label:"业务对象","header-align":"center","show-overflow-tooltip":""}),t(u,{prop:"createTime",label:"操作时间",align:"center","show-overflow-tooltip":""})]),_:1},8,["data"])),[[U,e.loading]]),t(B,{currentPage:e.tableParams.page,"onUpdate:currentPage":l[2]||(l[2]=y=>e.tableParams.page=y),"page-size":e.tableParams.pageSize,"onUpdate:pageSize":l[3]||(l[3]=y=>e.tableParams.pageSize=y),total:e.tableParams.total,"page-sizes":[10,20,50,100],small:"",background:"",onSizeChange:c,onCurrentChange:m,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])]),_:1})])}}}),K=F(I,[["__scopeId","data-v-7f2ec50b"]]);export{K as default};

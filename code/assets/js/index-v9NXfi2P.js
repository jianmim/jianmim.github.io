import{aK as q,k as ae,r as te,w as ze,aL as Ne,x as d,y as w,F as $e,s as Oe,L as Te,l as X,p as Ee,t as C,a6 as Le,M as $,O as B,ap as Z,B as Q,G as T,A as k,D as z,S as G,a4 as R,a5 as W,C as Ve,aj as j,ak as ne,aM as se,Z as ie,T as ce,E as ee,ab as Ae,n as De,al as Je,X as Pe,Y as Re}from"./store-dof5ccn5.js";import{u as je}from"./index-zQlakb1H.js";import{_ as Be}from"./_plugin-vue_export-helper-x3n3nnut.js";function Fe(c,m,y,o){var S=new Array,E=new Array;const D={top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}};let L=pe(y),V=fe(y),e=new Array(L);for(let t=0;t<e.length;t++)e[t]=new Array(V);let O=0;for(let t=0;t<y.length;t++){let p=y[t],a=fe([p]),i=pe([p]);for(let b=0;b<a;b++){O=O+b;for(let P=0;P<i;P++)F(P,O,b,p,e)}O++}for(let t=0;t<e.length;t++){let p=e[t];for(let a=0;a<p.length;a++)e[t][a]==null&&(e[t][a]=e[t-1][a])}function F(t,p,a,i,b){t>0?i.children?F(t,O,a,i.children,b):b[t][p]=i[a]:b[t][p]=i}for(let t=0;t<e.length;t++){var U=new Array;let p=e[t];for(let a=0;a<p.length;a++){let i=p[a],b=200;i.width&&!isNaN(i.width)&&(b=parseInt(i.width)*.7),E.push({wpx:b}),U.push({v:i.label,t:"s",s:{font:{bold:!0},alignment:{wrapText:!0,horizontal:i.headerAlign?i.headerAlign:i.align?i.align:"",vertical:"center"},border:D}})}S.push(U)}var v=[],g=!1,n={s:{r:0,c:0},e:{r:0,c:0}};for(let t=0;t<V;t++){let p=e[0][t];for(let a=0;a<L;a++){let i=e[a][t];i==p&&g==!1?(g=!0,n.s={r:a,c:t}):i!=p&&g==!0?(n.e={r:a-1,c:t},n.s.r!=n.e.r?(v.push(JSON.parse(JSON.stringify(n))),g=!1,n={s:{r:0,c:0},e:{r:0,c:0}}):a==L-1&&g==!0?(n.e={r:a,c:t},n.s.r!=n.e.r&&i==p&&v.push(JSON.parse(JSON.stringify(n))),g=!1,n={s:{r:0,c:0},e:{r:0,c:0}}):(p=i,g=!0,n.s={r:a,c:t})):a==L-1&&g==!0&&(n.e={r:a,c:t},n.s.r!=n.e.r&&i==p&&v.push(JSON.parse(JSON.stringify(n))),g=!1,n={s:{r:0,c:0},e:{r:0,c:0}})}}for(let t=0;t<L;t++){let p=e[t][0];for(let a=0;a<V;a++){let i=e[t][a];i==p&&g==!1?(g=!0,n.s={r:t,c:a}):i!=p&&g==!0?(n.e={r:t,c:a-1},n.s.c!=n.e.c?(v.push(JSON.parse(JSON.stringify(n))),g=!1,n={s:{r:0,c:0},e:{r:0,c:0}}):a==V-1&&g==!0?(n.e={r:t,c:a},n.s.r!=n.e.r&&i==p&&v.push(JSON.parse(JSON.stringify(n))),g=!1,n={s:{r:0,c:0},e:{r:0,c:0}}):(p=i,g=!0,n.s={r:t,c:a})):a==V-1&&g==!0&&(n.e={r:t,c:a},n.s.c!=n.e.c&&i==p&&v.push(JSON.parse(JSON.stringify(n))),g=!1,n={s:{r:0,c:0},e:{r:0,c:0}})}}c.forEach(t=>{var p=new Array;e[e.length-1].forEach(a=>{if(t.hasOwnProperty(a.prop)){let b="";if(t[a.prop]!=null)if(a.formatter){var i=a.formatter(t);b=ue(i)}else b=t[a.prop];p.push({v:b,t:"s",s:{alignment:{wrapText:!0,horizontal:a.align?a.align:"",vertical:"center"},border:D}})}}),S.push(p)});const J=q.utils.aoa_to_sheet(S),H=q.utils.book_new();J["!cols"]=E,J["!merges"]=v,q.utils.book_append_sheet(H,J,o),q.writeFile(H,m+".xlsx")}function ue(c){let m="";return c.children?c.children.default?m=c.children.default():c.children.forEach(y=>{m=m+ue(y)}):m=c,m}function pe(c){let m=1;function y(o,S){o.children&&o.children.length>0&&(S++,S>m&&(m=S),o.children.forEach(E=>y(E,S)))}return c.forEach(o=>y(o,1)),m}function fe(c){let m=0;function y(o){o.children&&o.children.length>0?o.children.forEach(S=>y(S)):m++}return c.forEach(o=>y(o)),m}const K=ae({__name:"formatter",props:{fn:{}},setup(c){const m=c,y=te();return ze(m,async()=>{y.value=Ne("div",null,m.fn)},{deep:!0,immediate:!0}),(o,S)=>(d(),w($e(y)))}}),Ue=c=>(Pe("data-v-a882e880"),c=c(),Re(),c),He={class:"table-container"},Me={class:"table-header mb15"},Ie={class:"table-footer-tool"},qe={class:"tool-box"},Xe=["data-key"],Ge=Ue(()=>B("i",{class:"fa fa-arrows-alt handle cursor-pointer"},null,-1)),Ke={key:0,class:"table-footer mt15"},Ye=ae({name:"netxTable"}),Ze=ae({...Ye,props:{getData:{type:Function,required:!0},columns:{type:Array,default:()=>[]},config:{type:Object,default:()=>{}},param:{type:Object,default:()=>{}},defaultSort:{type:Object,default:()=>{}},exportChangeData:{type:Function},printName:{type:String,default:()=>""}},emits:["pageChange","selectionChange","sortHeader"],setup(c,{expose:m,emit:y}){const o=c,S=y,E=te(),D=te(),L=je(),{themeConfig:V}=Oe(L),e=Te({data:[],loading:!1,exportLoading:!1,total:0,page:{page:1,pageSize:10,field:"",order:""},showPagination:!0,selectlist:[],checkListAll:!0,checkListIndeterminate:!1}),O=(l,r)=>{const f=r.split(".");let h=l;for(const _ of f)h=h[_];return h},F=X(()=>!!o.config.isBorder),U=X(()=>!!o.config.isStripe),v=X(()=>o.config),g=X(()=>o.columns.filter(l=>l.isCheck)),n=l=>{l?o.columns.forEach(r=>r.isCheck=!0):o.columns.forEach(r=>r.isCheck=!1),e.checkListIndeterminate=!1},J=()=>{const l=o.columns.filter(r=>r.isCheck).length;e.checkListAll=l===o.columns.length,e.checkListIndeterminate=l>0&&l<o.columns.length},H=l=>{e.selectlist=l,S("selectionChange",e.selectlist)},t=l=>{e.page.pageSize=l,A(),S("pageChange",e.page)},p=l=>{e.page.page=l,A(),S("pageChange",e.page)},a=l=>{e.page.field=l.prop,e.page.order=l.order,A()},i=()=>{D.value.clearSelection(),e.page.page=1,A()},b=()=>{if(g.value.length<=0)return ee.error("没有勾选要导出的列");le(e.data)},P=async()=>{var h;if(g.value.length<=0)return ee.error("没有勾选要导出的列");e.exportLoading=!0;const l=Object.assign({},o.param,{page:1,pageSize:9999999}),r=await o.getData(l);e.exportLoading=!1;const f=((h=r.result)==null?void 0:h.items)??[];le(f)},le=l=>{if(l.length<=0)return ee.error("没有数据可以导出");e.exportLoading=!0;let r=JSON.parse(JSON.stringify(l));o.exportChangeData&&(r=o.exportChangeData(r)),Fe(r,`${o.config.exportFileName?o.config.exportFileName:V.value.globalTitle}_${new Date().toLocaleString()}`,g.value.filter(f=>f.type!="action"),"导出数据"),e.exportLoading=!1},de=()=>{let l="",r="",f={};g.value.forEach(h=>{h.prop!=="action"&&(l+=`<th class="table-th">${h.label}</th>`)}),e.data.forEach((h,_)=>{f[_]||(f[_]=[]),g.value.forEach(N=>{N.prop!=="action"&&(N.type==="text"?f[_].push(`<td class="table-th table-center">${h[N.prop]}</td>`):N.type==="image"?f[_].push(`<td class="table-th table-center"><img src="${h[N.prop]}" style="width:${N.width}px;height:${N.height}px;"/></td>`):f[_].push(`<td class="table-th table-center">${h[N.prop]}</td>`))}),r+=`<tr>${f[_].join("")}</tr>`}),Ae({printable:`<div style=display:flex;flex-direction:column;text-align:center><h3>${o.printName}</h3></div><table border=1 cellspacing=0><tr>${l}${r}</table>`,type:"raw-html",css:["//at.alicdn.com/t/c/font_2298093_rnp72ifj3ba.css","//unpkg.com/element-plus/dist/index.css"],style:"@media print{.mb15{margin-bottom:15px;}.el-button--small i.iconfont{font-size: 12px !important;margin-right: 5px;}}; .table-th{word-break: break-all;white-space: pre-wrap;}.table-center{text-align: center;}"})},ge=()=>{A()},he=()=>{De(()=>{const l=Je.create(E.value,{handle:".handle",dataIdAttr:"data-key",animation:150,onEnd:()=>{const r=[];l.toArray().forEach(f=>{o.columns.forEach(h=>{h.prop===f&&r.push({...h})})}),S("sortHeader",r)}})})},A=async()=>{var f,h;e.loading=!0;let l=Object.assign({},o.param,{...e.page});Object.keys(l).forEach(_=>l[_]===void 0&&delete l[_]);const r=await o.getData(l);e.loading=!1,r&&r.result&&r.result.items?(e.showPagination=!0,e.data=((f=r.result)==null?void 0:f.items)??[],e.total=((h=r.result)==null?void 0:h.total)??0):(e.showPagination=!1,e.data=r&&r.result?r.result:[])},me=(l,r)=>{D.value.toggleRowSelection(l,r)},ye=()=>e.data,be=(l,r=!1)=>{if(r){var f=!1;for(let h of l){f=!1;for(let _ of e.data)if(h.id===_.id){f=!0;break}f||e.data.push(h)}}else e.data=l};return Ee(()=>{o.defaultSort&&(e.page.field=o.defaultSort.prop,e.page.order=o.defaultSort.order),e.page.pageSize=o.config.pageSize,A()}),m({pageReset:i,handleList:A,toggleSelection:me,getTableData:ye,setTableData:be}),(l,r)=>{const f=C("SvgIcon"),h=C("el-dropdown-item"),_=C("el-dropdown-menu"),N=C("el-dropdown"),we=C("el-tooltip"),M=C("el-checkbox"),Se=C("el-scrollbar"),ke=C("el-popover"),I=C("el-table-column"),re=C("el-image"),_e=C("el-empty"),ve=C("el-table"),xe=C("el-pagination"),oe=Le("loading");return d(),$("div",He,[B("div",Me,[B("div",null,[Z(l.$slots,"command",{},void 0,!0)]),Q((d(),$("div",Ie,[c.config.hideRefresh?T("",!0):(d(),w(f,{key:0,name:"iconfont icon-shuaxin",size:22,title:"刷新",onClick:ge})),c.config.hideExport?T("",!0):(d(),w(N,{key:1,trigger:"click"},{dropdown:k(()=>[z(_,null,{default:k(()=>[z(h,{onClick:b},{default:k(()=>[G("导出本页数据")]),_:1}),z(h,{onClick:P},{default:k(()=>[G("导出全部数据")]),_:1})]),_:1})]),default:k(()=>[z(f,{name:"iconfont icon-yunxiazai_o",size:22,title:"导出"})]),_:1})),c.config.hidePrint?T("",!0):(d(),w(f,{key:2,name:"iconfont icon-dayin",size:19,title:"打印",onClick:de})),c.config.hideSet?T("",!0):(d(),w(ke,{key:3,placement:"bottom-end",trigger:"click",transition:"el-zoom-in-top","popper-class":"table-tool-popper",width:300,persistent:!1,onShow:he},{reference:k(()=>[z(f,{name:"iconfont icon-quanjushezhi_o",size:22,title:"设置"})]),default:k(()=>[B("div",qe,[z(we,{content:"拖动进行排序",placement:"top-start"},{default:k(()=>[z(f,{name:"fa fa-question-circle-o",size:17,class:"ml11",color:"#909399"})]),_:1}),z(M,{modelValue:e.checkListAll,"onUpdate:modelValue":r[0]||(r[0]=s=>e.checkListAll=s),indeterminate:e.checkListIndeterminate,class:"ml10 mr1",label:"列显示",onChange:n},null,8,["modelValue","indeterminate"]),z(M,{modelValue:v.value.isSerialNo,"onUpdate:modelValue":r[1]||(r[1]=s=>v.value.isSerialNo=s),class:"ml12 mr1",label:"序号"},null,8,["modelValue"]),v.value.showSelection?(d(),w(M,{key:0,modelValue:v.value.isSelection,"onUpdate:modelValue":r[2]||(r[2]=s=>v.value.isSelection=s),class:"ml12 mr1",label:"多选"},null,8,["modelValue"])):T("",!0)]),z(Se,null,{default:k(()=>[B("div",{ref_key:"toolSetRef",ref:E,class:"tool-sortable"},[(d(!0),$(R,null,W(c.columns,s=>Q((d(),$("div",{class:"tool-sortable-item",key:s.prop,"data-key":s.prop},[Ge,z(M,{modelValue:s.isCheck,"onUpdate:modelValue":Y=>s.isCheck=Y,size:"default",class:"ml12 mr8",label:s.label,onChange:J},null,8,["modelValue","onUpdate:modelValue","label"])],8,Xe)),[[Ve,!s.hideCheck&&!s.fixed]])),128))],512)]),_:1})]),_:1}))])),[[oe,e.importLoading]])]),Q((d(),w(ve,j({ref_key:"tableRef",ref:D,data:e.data,border:F.value,stripe:U.value},l.$attrs,{"row-key":"id","default-expand-all":"",style:{width:"100%"},"default-sort":c.defaultSort,onSelectionChange:H,onSortChange:a}),{empty:k(()=>[z(_e,{description:"暂无数据"})]),default:k(()=>[c.config.isSelection&&c.config.showSelection?(d(),w(I,{key:0,type:"selection","reserve-selection":!0,width:30})):T("",!0),c.config.isSerialNo?(d(),w(I,{key:1,type:"index",label:"序号",align:"center",width:60})):T("",!0),(d(!0),$(R,null,W(g.value,(s,Y)=>(d(),w(I,j({key:Y},s),ne({default:k(()=>[(d(!0),$(R,null,W(s.children,(u,Ce)=>(d(),w(I,j({key:Ce},u),ne({_:2},[l.$slots[u.prop]?{name:"default",fn:k(x=>[u.formatter?(d(),w(K,{key:0,fn:u.formatter(x.row,x.column,x.cellValue,x.index)},null,8,["fn"])):Z(l.$slots,u.prop,se(j({key:1},x)),void 0,!0)]),key:"0"}:{name:"default",fn:k(x=>[u.formatter?(d(),w(K,{key:0,fn:u.formatter(x.row,x.column,x.cellValue,x.index)},null,8,["fn"])):u.type==="image"?(d(),w(re,{key:1,style:ie({width:`${u.width}px`,height:`${u.height}px`}),src:x.row[u.prop],"zoom-rate":1.2,"preview-src-list":[x.row[u.prop]],"preview-teleported":"",fit:"cover"},null,8,["style","src","preview-src-list"])):(d(),$(R,{key:2},[G(ce(O(x.row,u.prop)),1)],64))]),key:"1"}]),1040))),128))]),_:2},[!s.children&&l.$slots[s.prop]?{name:"default",fn:k(u=>[s.formatter?(d(),w(K,{key:0,fn:s.formatter(u.row,u.column,u.cellValue,u.index)},null,8,["fn"])):Z(l.$slots,s.prop,se(j({key:1},u)),void 0,!0)]),key:"0"}:s.children?void 0:{name:"default",fn:k(u=>[s.formatter?(d(),w(K,{key:0,fn:s.formatter(u.row,u.column,u.cellValue,u.index)},null,8,["fn"])):s.type==="image"?(d(),w(re,{key:1,style:ie({width:`${s.width}px`,height:`${s.height}px`}),src:u.row[s.prop],"zoom-rate":1.2,"preview-src-list":[u.row[s.prop]],"preview-teleported":"",fit:"cover"},null,8,["style","src","preview-src-list"])):(d(),$(R,{key:2},[G(ce(O(u.row,s.prop)),1)],64))]),key:"1"}]),1040))),128))]),_:3},16,["data","border","stripe","default-sort"])),[[oe,e.loading]]),!c.config.hidePagination&&e.showPagination?(d(),$("div",Ke,[z(xe,{"current-page":e.page.page,"onUpdate:currentPage":r[3]||(r[3]=s=>e.page.page=s),"page-size":e.page.pageSize,"onUpdate:pageSize":r[4]||(r[4]=s=>e.page.pageSize=s),small:"","pager-count":5,"page-sizes":c.config.pageSizes,total:e.total,layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:t,onCurrentChange:p},null,8,["current-page","page-size","page-sizes","total"])])):T("",!0)])}}}),tt=Be(Ze,[["__scopeId","data-v-a882e880"]]);export{tt as default};

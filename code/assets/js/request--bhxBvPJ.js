import{b as m,E as c}from"./store-mQZkmHj-.js";import{L as a,S as v}from"./index-lw7p-_pG.js";const d=m.create({baseURL:window.__env__.VITE_API_URL,timeout:5e4,headers:{"Content-Type":"application/json"}}),f="access-token",u=`x-${f}`,l=()=>{a.remove(f),a.remove(u),v.clear(),window.location.reload()};d.interceptors.request.use(e=>{var s;const t=a.get(f);if(t){e.headers.Authorization=`Bearer ${t}`;const o=h(t),n=y(o.exp);if(new Date>=n){const r=a.get(u);r&&(e.headers["X-Authorization"]=`Bearer ${r}`)}if(((s=e.method)==null?void 0:s.toLowerCase())==="get"&&e.data){let r=e.url+"?"+w(e.data);r=r.slice(0,-1),e.data={},e.url=r}}return e},e=>Promise.reject(e));d.interceptors.response.use(e=>{var t=e.status,s=e.data;if(t===401&&l(),t>=400)throw new Error(e.statusText||"Request Error.");if(s&&s.hasOwnProperty("errors")&&s.errors)throw new Error(JSON.stringify(s.errors||"Request Error."));var o=e.headers[f],n=e.headers[u];if(o==="invalid_token"?l():n&&o&&o!=="invalid_token"&&(a.set(f,o),a.set(u,n)),s.code===401)l();else{if(s.code===void 0)return Promise.resolve(e);if(s.code!==200){var r;throw s.message&&typeof s.message=="object"?r=JSON.stringify(s.message):r=s.message,c.error(r),new Error(r)}}return e},e=>(e.response&&e.response.status===401&&l(),e.message.indexOf("timeout")!=-1?c.error("网络超时"):e.message=="Network Error"?c.error("网络连接错误"):e.response.data?c.error(e.response.statusText):c.error("接口路径找不到"),Promise.reject(e)));function w(e){let t="";for(const n of Object.keys(e)){const r=e[n];var s=encodeURIComponent(n)+"=";if(r!==null&&r!==""&&typeof r<"u")if(typeof r=="object"){for(const i of Object.keys(r))if(r[i]!==null&&r[i]!==""&&typeof r[i]<"u"){let p=n+"["+i+"]";var o=encodeURIComponent(p)+"=";t+=o+encodeURIComponent(r[i])+"&"}}else t+=s+encodeURIComponent(r)+"&"}return t}function h(e){e=e.replace(/_/g,"/").replace(/-/g,"+");var t=decodeURIComponent(escape(window.atob(e.split(".")[1])));return JSON.parse(t)}function y(e){return new Date(e*1e3)}export{d as s};

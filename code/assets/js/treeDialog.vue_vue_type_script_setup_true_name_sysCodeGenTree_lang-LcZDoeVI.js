import{g as C}from"./index-xdJ7pE-g.js";import{S as y}from"./sys-code-gen-api-JhrPjZzh.js";import{k as N,r as z,L as O,p as P,t as m,x as u,M as r,D as o,A as a,O as v,S as D,a4 as p,a5 as b,y as _}from"./store-dof5ccn5.js";const j={class:"sys-codeGenTree-container"},q={style:{color:"#fff"}},H=v("span",null," 树选择配置 ",-1),J={class:"dialog-footer"},K=N({name:"sysCodeGenTree"}),Z=N({...K,emits:["submitRefreshFk"],setup(Q,{expose:w,emit:V}){var s={};const x=V,g=z(),e=O({isShowDialog:!1,ruleForm:{},dbData:[],tableData:[],columnData:[]});P(async()=>{await S()});const k=async()=>{e.tableData=[],e.columnData=[],await G()},I=async()=>{e.columnData=[],await T()},S=async()=>{var n=await C(y).apiSysCodeGenDatabaseListGet();e.dbData=n.data.result},G=async()=>{if(e.ruleForm.configId!=""){var n=await C(y).apiSysCodeGenTableListConfigIdGet(e.ruleForm.configId);e.tableData=n.data.result}},T=async()=>{if(!(e.ruleForm.configId==""||e.ruleForm.tableName=="")){var n=await C(y).apiSysCodeGenColumnListByTableNameTableNameConfigIdGet(e.ruleForm.tableName,e.ruleForm.configId);e.columnData=n.data.result}},h=n=>{var t;s=n,e.isShowDialog=!0,(t=g.value)==null||t.resetFields()},L=()=>{s.fkTableName=e.ruleForm.tableName;let n=e.tableData.filter(t=>t.tableName==e.ruleForm.tableName);s.fkEntityName=n.length==0?"":n[0].entityName,s.displayColumn=e.ruleForm.displayColumn,s.valueColumn=e.ruleForm.valueColumn,s.pidColumn=e.ruleForm.pidColumn,x("submitRefreshFk",s),e.isShowDialog=!1},U=()=>{e.isShowDialog=!1},B=()=>{g.value.validate(async n=>{n&&L()})};return w({openDialog:h}),(n,t)=>{const E=m("ele-Edit"),R=m("el-icon"),d=m("el-option"),i=m("el-select"),c=m("el-form-item"),f=m("el-col"),A=m("el-row"),M=m("el-form"),F=m("el-button"),$=m("el-dialog");return u(),r("div",j,[o($,{modelValue:e.isShowDialog,"onUpdate:modelValue":t[7]||(t[7]=l=>e.isShowDialog=l),draggable:"","close-on-click-modal":!1,width:"700px"},{header:a(()=>[v("div",q,[o(R,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:a(()=>[o(E)]),_:1}),H])]),footer:a(()=>[v("span",J,[o(F,{onClick:U},{default:a(()=>[D("取 消")]),_:1}),o(F,{type:"primary",onClick:B},{default:a(()=>[D("确 定")]),_:1})])]),default:a(()=>[o(M,{model:e.ruleForm,ref_key:"ruleFormRef",ref:g,"label-width":"auto"},{default:a(()=>[o(A,{gutter:35},{default:a(()=>[o(f,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(c,{label:"库定位器",prop:"configId"},{default:a(()=>[o(i,{clearable:"",modelValue:e.ruleForm.configId,"onUpdate:modelValue":t[0]||(t[0]=l=>e.ruleForm.configId=l),placeholder:"库名",filterable:"",onChange:t[1]||(t[1]=l=>k()),class:"w100"},{default:a(()=>[(u(!0),r(p,null,b(e.dbData,l=>(u(),_(d,{key:l.configId,label:l.configId,value:l.configId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(f,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(c,{label:"数据库表",prop:"tableName"},{default:a(()=>[o(i,{modelValue:e.ruleForm.tableName,"onUpdate:modelValue":t[2]||(t[2]=l=>e.ruleForm.tableName=l),class:"w100",filterable:"",clearable:"",onChange:t[3]||(t[3]=l=>I())},{default:a(()=>[(u(!0),r(p,null,b(e.tableData,l=>(u(),_(d,{key:l.entityName,label:l.tableName+" ["+l.tableComment+"]",value:l.tableName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(f,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(c,{label:"显示字段",prop:"displayColumn"},{default:a(()=>[o(i,{modelValue:e.ruleForm.displayColumn,"onUpdate:modelValue":t[4]||(t[4]=l=>e.ruleForm.displayColumn=l),class:"w100"},{default:a(()=>[(u(!0),r(p,null,b(e.columnData,l=>(u(),_(d,{key:l.columnName,label:l.columnName+" ["+l.columnComment+"]",value:l.columnName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(f,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(c,{label:"选择值字段",prop:"valueColumn"},{default:a(()=>[o(i,{modelValue:e.ruleForm.valueColumn,"onUpdate:modelValue":t[5]||(t[5]=l=>e.ruleForm.valueColumn=l),class:"w100"},{default:a(()=>[(u(!0),r(p,null,b(e.columnData,l=>(u(),_(d,{key:l.columnName,label:l.columnName+" ["+l.columnComment+"]",value:l.columnName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(f,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:a(()=>[o(c,{label:"父级字段",prop:"pidColumn"},{default:a(()=>[o(i,{modelValue:e.ruleForm.pidColumn,"onUpdate:modelValue":t[6]||(t[6]=l=>e.ruleForm.pidColumn=l),class:"w100"},{default:a(()=>[(u(!0),r(p,null,b(e.columnData,l=>(u(),_(d,{key:l.columnName,label:l.columnName+" ["+l.columnComment+"]",value:l.columnName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Z as _};
